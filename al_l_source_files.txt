# .htaccess
# path: .\.htaccess

# .htaccess
php_flag log_errors on
php_value error_log /home/kuplyuta/appliances/logs/php_errors.log


================================================================================

# config.php
# path: .\config\config.php

<?php
// Basic paths and app settings
define('BASE_PATH', dirname(__DIR__));
define('BASE_URL', 'https://test.kuplyu-tashkent.uz');

define('UPLOAD_PATH', BASE_PATH . '/public/uploads/');
define('UPLOAD_URL', BASE_URL . '/uploads/');
define('MAX_UPLOAD_SIZE', 5 * 1024 * 1024); // 5MB

define('SUPPORTED_LANGUAGES', ['ru', 'uz']);
define('DEFAULT_LANGUAGE', 'ru');

date_default_timezone_set('Asia/Tashkent');


================================================================================

# database.php
# path: .\config\database.php

<?php
define('DB_HOST', getenv('DB_HOST') ?: 'localhost');
define('DB_NAME', getenv('DB_NAME') ?: 'kuplyuta_db');
define('DB_USER', getenv('DB_USER') ?: 'kuplyuta_admin');
define('DB_PASS', getenv('DB_PASS') ?: '=@iX?z~gukWg');
define('DB_CHARSET', getenv('DB_CHARSET') ?: 'utf8mb4');



================================================================================

# init.php
# path: .\config\init.php

<?php
require_once __DIR__ . '/config.php';
require_once __DIR__ . '/database.php';
require_once __DIR__ . '/security.php';

if (session_status() === PHP_SESSION_NONE) session_start();

if (!isset($_SESSION['last_regeneration'])) {
    $_SESSION['last_regeneration'] = time();
} elseif (time() - $_SESSION['last_regeneration'] > 1800) {
    session_regenerate_id(true);
    $_SESSION['last_regeneration'] = time();
}

// Session timeout (1 hour)
$timeout = 1800;
if (isset($_SESSION['last_activity']) && (time() - $_SESSION['last_activity']) > $timeout) {
    session_unset();
    session_destroy();
    header('Location: ' . BASE_URL . '/admin/login?timeout=1');
    exit;
}
$_SESSION['last_activity'] = time();


================================================================================

# security.php
# path: .\config\security.php

<?php

define('IS_PRODUCTION', !in_array($_SERVER['HTTP_HOST'] ?? '', ['localhost', '127.0.0.1', 'test.kuplyu-tashkent.uz']));

// --------------------
// Security Headers
// --------------------
header('X-Frame-Options: SAMEORIGIN');
header('X-Content-Type-Options: nosniff');
header('X-XSS-Protection: 1; mode=block');
header('Referrer-Policy: strict-origin-when-cross-origin');
if (IS_PRODUCTION) {
    header('Strict-Transport-Security: max-age=31536000; includeSubDomains');
}
$csp = [
    "default-src 'self'",
    "script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://unpkg.com",
    "style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com",
    "style-src-elem 'self' 'unsafe-inline' https://cdnjs.cloudflare.com", // TinyMCE styles
    "img-src 'self' data: https:",
    "font-src 'self' data: https://cdnjs.cloudflare.com", // TinyMCE fonts
    "connect-src 'self' https://unpkg.com https://cdnjs.cloudflare.com", // TinyMCE resources
    "frame-ancestors 'self'"
];


header('Content-Security-Policy: ' . implode('; ', $csp));

// --------------------
// CSRF
// --------------------
function generateCSRFToken() {
    if (!isset($_SESSION['csrf_token'])) {
        $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
    }
    return $_SESSION['csrf_token'];
}

function validateCSRFToken($token) {
    return isset($_SESSION['csrf_token']) && hash_equals($_SESSION['csrf_token'], $token);
}

function csrfField() {
    $token = generateCSRFToken();
    return '<input type="hidden" name="csrf_token" value="' . htmlspecialchars($token) . '">';
}

// --------------------
// RateLimiter
// --------------------
class RateLimiter {
    private $max_attempts = 5;
    private $time_window = 300; // 5 minutes

    public function check($identifier, $action = 'default') {
        $key = "ratelimit_{$action}_{$identifier}";
        $attempts = $_SESSION[$key] ?? ['count' => 0, 'timestamp' => time()];

        if (time() - $attempts['timestamp'] > $this->time_window) {
            $attempts = ['count' => 0, 'timestamp' => time()];
        }

        $attempts['count']++;
        $_SESSION[$key] = $attempts;

        if ($attempts['count'] > $this->max_attempts) {
            http_response_code(429);
            die('Too many attempts. Please try again later.');
        }

        return true;
    }

    public function reset($identifier, $action = 'default') {
        $key = "ratelimit_{$action}_{$identifier}";
        unset($_SESSION[$key]);
    }
}

// --------------------
// Upload validation
// --------------------
function validateUpload($file) {
    if (!isset($file['tmp_name']) || !is_uploaded_file($file['tmp_name'])) {
        return ['success' => false, 'message' => 'Invalid file upload'];
    }
    
    if ($file['size'] > MAX_UPLOAD_SIZE) {
        return ['success' => false, 'message' => 'File too large'];
    }
    
    $finfo = finfo_open(FILEINFO_MIME_TYPE);
    $mime = finfo_file($finfo, $file['tmp_name']);
    finfo_close($finfo);
    
    $allowed_mimes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
    if (!in_array($mime, $allowed_mimes)) {
        return ['success' => false, 'message' => 'Invalid file type'];
    }
    
    $ext = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));
    $allowed_exts = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
    if (!in_array($ext, $allowed_exts)) {
        return ['success' => false, 'message' => 'Invalid file extension'];
    }
    
    $image_info = getimagesize($file['tmp_name']);
    if ($image_info === false) {
        return ['success' => false, 'message' => 'Not a valid image'];
    }
    
    return ['success' => true];
}

// --------------------
// Password hash
// --------------------
function hashPassword($password) {
    return password_hash($password, PASSWORD_DEFAULT);
}

// --------------------
// Security log
// --------------------
function securityLog($message, $level = 'INFO') {
    $log_file = BASE_PATH . '/logs/security.log';
    $timestamp = date('Y-m-d H:i:s');
    $ip = $_SERVER['REMOTE_ADDR'] ?? 'unknown';
    $user = $_SESSION['username'] ?? 'guest';

    $log_message = "[{$timestamp}] [{$level}] [{$user}@{$ip}] {$message}\n";

    $log_dir = dirname($log_file);
    if (!is_dir($log_dir)) mkdir($log_dir, 0750, true);

    file_put_contents($log_file, $log_message, FILE_APPEND | LOCK_EX);
}


================================================================================

# PageController.php
# path: .\controllers\PageController.php

<?php
// path: ./controllers/PageController.php

require_once BASE_PATH . '/models/Page.php';
require_once BASE_PATH . '/models/SEO.php';
require_once BASE_PATH . '/models/FAQ.php';
require_once BASE_PATH . '/models/ContentRotation.php';
require_once BASE_PATH . '/models/Analytics.php';

class PageController extends Controller {
    private $pageModel;
    private $seoModel;
    private $faqModel;
    private $rotationModel;
    private $analyticsModel;

    public function __construct() {
        parent::__construct();
        $this->pageModel = new Page();
        $this->seoModel = new SEO();
        $this->faqModel = new FAQ();
        $this->rotationModel = new ContentRotation();
        $this->analyticsModel = new Analytics();
    }

    public function show($slug = 'home', $lang = null) {
        // Set language
        if ($lang) {
            setLanguage($lang);
        }
        
        $currentLang = getCurrentLanguage();
        
        // Get page data
        $page = $this->pageModel->getBySlug($slug);
        
        if (!$page) {
            showError(404);
        }
        
        // Track which content is being shown
        $rotationUsed = false;
        $activeMonth = null;
        
        // Get content rotation if enabled AND apply SEO from rotation
        if ($page['enable_rotation']) {
            $rotationContent = $this->rotationModel->getCurrentMonth($page['id']);
            if ($rotationContent) {
                // Override title and description if provided
                if (!empty($rotationContent["title_$currentLang"])) {
                    $page["title_$currentLang"] = $rotationContent["title_$currentLang"];
                }
                
                // Override content
                $page["content_$currentLang"] = $rotationContent["content_$currentLang"];
                
                $rotationUsed = true;
                $activeMonth = $rotationContent['active_month'];
                
                // Override SEO settings if rotation has them
                $seoFields = [
                    'meta_title', 'meta_description', 'meta_keywords',
                    'og_title', 'og_description', 'og_image',
                    'jsonld'
                ];
                
                foreach ($seoFields as $field) {
                    if ($field === 'og_image') {
                        if (!empty($rotationContent[$field])) {
                            $page[$field] = $rotationContent[$field];
                        }
                    } else {
                        $fieldWithLang = "{$field}_{$currentLang}";
                        if (!empty($rotationContent[$fieldWithLang])) {
                            $page[$fieldWithLang] = $rotationContent[$fieldWithLang];
                        }
                    }
                }
                
                // Track that this rotation was shown
                $this->analyticsModel->trackRotationShown($slug, $activeMonth, $currentLang);
            }
        }
        
        // Get global SEO settings
        $seoSettings = $this->seoModel->getSettings();
        
        // Get FAQs for this page
        $faqs = $this->faqModel->getBySlug($slug);
        
        // Track visit
        trackVisit($slug, $currentLang);
        
        // Build template data with full access to all info
        $templateData = [
            'page' => [
                'title' => $page["title_$currentLang"],
                'slug' => $page['slug'],
                'content' => $page["content_$currentLang"],
                'meta_title' => $page["meta_title_$currentLang"],
                'meta_description' => $page["meta_description_$currentLang"],
            ],
            'global' => [
                'phone' => $seoSettings['phone'] ?? '',
                'email' => $seoSettings['email'] ?? '',
                'address' => $seoSettings["address_$currentLang"] ?? '',
                'working_hours' => $seoSettings["working_hours_$currentLang"] ?? '',
                'site_name' => $seoSettings["site_name_$currentLang"] ?? '',
            ],
            'seo' => $seoSettings,
            'faqs' => $faqs,
            'lang' => $currentLang,
            'date' => [
                'year' => date('Y'),
                'month' => date('n'),
                'month_name' => date('F'),
                'day' => date('j'),
            ],
            'rotation' => [
                'active' => $rotationUsed,
                'month' => $activeMonth
            ]
        ];
        
        // Render content with template engine
        $page["content_$currentLang"] = renderTemplate($page["content_$currentLang"], $templateData);
        
        // Prepare data for view
        $data = [
            'page' => $page,
            'seo' => $seoSettings,
            'faqs' => $faqs,
            'lang' => $currentLang,
            'templateData' => $templateData
        ];
        
        $this->view('templates/page', $data);
    }

    public function trackClick() {
        $slug = $_POST['slug'] ?? '';
        $lang = $_POST['lang'] ?? getCurrentLanguage();
        
        if ($slug) {
            trackClick($slug, $lang);
            $this->json(['success' => true]);
        }
        
        $this->json(['success' => false], 400);
    }

    /**
     * Track internal link navigation
     */
    public function trackInternalLink() {
        $fromSlug = $_POST['from'] ?? '';
        $toSlug = $_POST['to'] ?? '';
        $lang = $_POST['lang'] ?? getCurrentLanguage();
        
        if ($fromSlug && $toSlug) {
            trackInternalLink($fromSlug, $toSlug, $lang);
            $this->json(['success' => true]);
        }
        
        $this->json(['success' => false], 400);
    }
}

================================================================================

# SitemapController.php
# path: .\controllers\SitemapController.php

<?php
// path: ./controllers/SitemapController.php
// IMPLEMENTATION: Place in controllers/SitemapController.php

require_once BASE_PATH . '/models/Page.php';

class SitemapController extends Controller {
    private $pageModel;

    public function __construct() {
        parent::__construct();
        $this->pageModel = new Page();
    }

    /**
     * Generate sitemap.xml
     * URL: /sitemap.xml
     */
    public function generateXML() {
        header('Content-Type: application/xml; charset=utf-8');
        
        $pages = $this->pageModel->getAll(false); // Only published
        
        echo '<?xml version="1.0" encoding="UTF-8"?>' . "\n";
        echo '<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" 
                      xmlns:xhtml="http://www.w3.org/1999/xhtml">' . "\n";
        
        foreach ($pages as $page) {
            $slug = $page['slug'];
            $updated = $page['updated_at'];
            
            // Priority based on slug
            $priority = $slug === 'home' ? '1.0' : '0.8';
            
            // Change frequency based on rotation
            $changefreq = $page['enable_rotation'] ? 'monthly' : 'yearly';
            
            // Russian version (default)
            echo '  <url>' . "\n";
            echo '    <loc>' . BASE_URL . '/' . htmlspecialchars($slug) . '</loc>' . "\n";
            echo '    <lastmod>' . date('Y-m-d', strtotime($updated)) . '</lastmod>' . "\n";
            echo '    <changefreq>' . $changefreq . '</changefreq>' . "\n";
            echo '    <priority>' . $priority . '</priority>' . "\n";
            
            // Alternate language links
            echo '    <xhtml:link rel="alternate" hreflang="ru" href="' . BASE_URL . '/' . htmlspecialchars($slug) . '" />' . "\n";
            echo '    <xhtml:link rel="alternate" hreflang="uz" href="' . BASE_URL . '/' . htmlspecialchars($slug) . '/uz" />' . "\n";
            
            echo '  </url>' . "\n";
            
            // Uzbek version
            echo '  <url>' . "\n";
            echo '    <loc>' . BASE_URL . '/' . htmlspecialchars($slug) . '/uz</loc>' . "\n";
            echo '    <lastmod>' . date('Y-m-d', strtotime($updated)) . '</lastmod>' . "\n";
            echo '    <changefreq>' . $changefreq . '</changefreq>' . "\n";
            echo '    <priority>' . $priority . '</priority>' . "\n";
            
            echo '    <xhtml:link rel="alternate" hreflang="ru" href="' . BASE_URL . '/' . htmlspecialchars($slug) . '" />' . "\n";
            echo '    <xhtml:link rel="alternate" hreflang="uz" href="' . BASE_URL . '/' . htmlspecialchars($slug) . '/uz" />' . "\n";
            
            echo '  </url>' . "\n";
        }
        
        echo '</urlset>';
        exit;
    }

    /**
     * Generate robots.txt
     * URL: /robots.txt
     */
    public function generateRobotsTxt() {
        header('Content-Type: text/plain; charset=utf-8');
        
        $isProduction = IS_PRODUCTION;
        
        if ($isProduction) {
            // Production: Allow all bots
            echo "User-agent: *\n";
            echo "Allow: /\n";
            echo "\n";
            
            // Block admin area
            echo "Disallow: /admin/\n";
            echo "Disallow: /config/\n";
            echo "Disallow: /logs/\n";
            echo "Disallow: /database/\n";
            echo "\n";
            
            // Sitemap location
            echo "Sitemap: " . BASE_URL . "/sitemap.xml\n";
            
        } else {
            // Development/Test: Block all bots
            echo "User-agent: *\n";
            echo "Disallow: /\n";
        }
        
        exit;
    }

    /**
     * Admin interface for sitemap management
     */
    public function adminPanel() {
        $this->requireAuth();
        
        $pages = $this->pageModel->getAll(false);
        $totalUrls = count($pages) * 2; // Each page has 2 language versions
        
        $data = [
            'totalPages' => count($pages),
            'totalUrls' => $totalUrls,
            'sitemapUrl' => BASE_URL . '/sitemap.xml',
            'robotsUrl' => BASE_URL . '/robots.txt',
            'pages' => $pages,
            'isProduction' => IS_PRODUCTION
        ];
        
        $this->view('admin/seo/sitemap', $data);
    }

    /**
     * Ping search engines about sitemap update
     */
    public function pingSearchEngines() {
        $this->requireAuth();
        
        if (!IS_PRODUCTION) {
            $_SESSION['error'] = 'Cannot ping search engines in development mode';
            $this->redirect('/admin/seo/sitemap');
            return;
        }
        
        $sitemapUrl = urlencode(BASE_URL . '/sitemap.xml');
        $results = [];
        
        // Google
        $googleUrl = "https://www.google.com/ping?sitemap=$sitemapUrl";
        $googleResult = @file_get_contents($googleUrl);
        $results['google'] = $googleResult !== false;
        
        // Bing
        $bingUrl = "https://www.bing.com/ping?sitemap=$sitemapUrl";
        $bingResult = @file_get_contents($bingUrl);
        $results['bing'] = $bingResult !== false;
        
        if ($results['google'] || $results['bing']) {
            $_SESSION['success'] = 'Successfully pinged search engines!';
        } else {
            $_SESSION['error'] = 'Failed to ping search engines';
        }
        
        $this->redirect('/admin/seo/sitemap');
    }
}

================================================================================

# AnalyticsController.php
# path: .\controllers\admin\AnalyticsController.php

<?php
// path: ./controllers/admin/AnalyticsController.php

require_once BASE_PATH . '/models/Analytics.php';
require_once BASE_PATH . '/models/Page.php';

class AnalyticsController extends Controller {
    private $analyticsModel;
    private $pageModel;

    public function __construct() {
        parent::__construct();
        $this->analyticsModel = new Analytics();
        $this->pageModel = new Page();
    }

    public function index() {
        $this->requireAuth();
        
        $months = $_GET['months'] ?? 6;
        $view = $_GET['view'] ?? 'overview';
        
        $stats = [
            'total' => $this->analyticsModel->getTotalStats(),
            'current_month' => $this->analyticsModel->getCurrentMonthStats(),
            'page_stats' => $this->analyticsModel->getPageStats($months),
            'visits_chart' => $this->analyticsModel->getChartData('visits', $months),
            'clicks_chart' => $this->analyticsModel->getChartData('clicks', $months),
            'trends' => $this->analyticsModel->getPerformanceTrends(),
            'top_performers' => $this->analyticsModel->getTopPerformers($months),
            'language_stats' => $this->analyticsModel->getLanguageStats($months),
            'months' => $months,
            'view' => $view
        ];
        
        $this->view('admin/analytics/index', ['stats' => $stats]);
    }

    /**
     * Rotation-specific analytics
     */
    public function rotationAnalytics() {
        $this->requireAuth();
        
        $months = $_GET['months'] ?? 3;
        
        $data = [
            'effectiveness' => $this->analyticsModel->getRotationEffectiveness($months),
            'months' => $months
        ];
        
        $this->view('admin/analytics/rotation', $data);
    }

    /**
     * Crawl frequency analysis
     */
    public function crawlAnalysis() {
        $this->requireAuth();
        
        $days = $_GET['days'] ?? 30;
        
        $data = [
            'crawl_frequency' => $this->analyticsModel->getCrawlFrequency($days),
            'days' => $days
        ];
        
        $this->view('admin/analytics/crawl', $data);
    }

    /**
     * Page-specific detailed analytics
     */
    public function pageDetail($slug) {
        $this->requireAuth();
        
        $page = $this->pageModel->getBySlug($slug);
        if (!$page) {
            $_SESSION['error'] = 'Page not found';
            $this->redirect('/admin/analytics');
            return;
        }
        
        $months = $_GET['months'] ?? 3;
        
        $data = [
            'page' => $page,
            'trends' => $this->analyticsModel->getPerformanceTrends($slug),
            'rotation_comparison' => $this->analyticsModel->getRotationComparison($slug, $months),
            'daily_activity' => $this->analyticsModel->getDailyActivity($slug, 30),
            'months' => $months
        ];
        
        $this->view('admin/analytics/page_detail', $data);
    }

    public function getData() {
        $this->requireAuth();
        
        $type = $_GET['type'] ?? 'visits';
        $months = $_GET['months'] ?? 6;
        
        $data = $this->analyticsModel->getChartData($type, $months);
        $this->json($data);
    }

    /**
     * Export analytics data as CSV
     */
    public function export() {
        $this->requireAuth();
        
        $months = $_GET['months'] ?? 6;
        $stats = $this->analyticsModel->getPageStats($months);
        
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment; filename="analytics_' . date('Y-m-d') . '.csv"');
        
        $output = fopen('php://output', 'w');
        
        // Headers
        fputcsv($output, ['Page', 'Language', 'Visits', 'Clicks', 'CTR %', 'Period']);
        
        // Data
        foreach ($stats as $row) {
            $ctr = $row['visits'] > 0 ? round(($row['clicks'] / $row['visits']) * 100, 2) : 0;
            fputcsv($output, [
                $row['page_slug'],
                strtoupper($row['language']),
                $row['visits'],
                $row['clicks'],
                $ctr,
                $months . ' months'
            ]);
        }
        
        fclose($output);
        exit;
    }
    public function navigationAnalytics() {
        $this->requireAuth();
        
        $months = $_GET['months'] ?? 3;
        
        $data = [
            'navigation_flow' => $this->analyticsModel->getNavigationFlow(30),
            'popular_paths' => $this->analyticsModel->getPopularPaths($months, 20),
            'link_effectiveness' => $this->analyticsModel->getLinkEffectiveness($months),
            'navigation_funnels' => $this->analyticsModel->getNavigationFunnels($months),
            'months' => $months
        ];
        
        $this->view('admin/analytics/navigation', $data);
    }
}

================================================================================

# AuthController.php
# path: .\controllers\admin\AuthController.php

<?php
require_once BASE_PATH . '/models/User.php';

class AuthController extends Controller {
    private $userModel;

    public function __construct() {
        parent::__construct();
        $this->userModel = new User();
    }

    public function showLogin() {
        if (isset($_SESSION['user_id'])) {
            $this->redirect('/admin/dashboard');
        }
        $this->view('admin/login');
    }

    public function login() {
        if (!validateCSRFToken($_POST['csrf_token'] ?? '')) {
            $_SESSION['error'] = 'Invalid security token';
            $this->redirect('/admin/login');
        }
        $username = $_POST['username'] ?? '';
        $password = $_POST['password'] ?? '';

        $user = $this->userModel->authenticate($username, $password);

        if ($user) {
            $_SESSION['user_id'] = $user['id'];
            $_SESSION['username'] = $user['username'];
            $this->redirect('/admin/dashboard');
        } else {
            $_SESSION['error'] = 'Invalid credentials';
            $this->redirect('/admin/login');
        }
    }

    public function logout() {
        session_destroy();
        $this->redirect('/admin/login');
    }
}

================================================================================

# DashboardController.php
# path: .\controllers\admin\DashboardController.php

<?php
class DashboardController extends Controller {
    public function index() {
        $this->requireAuth();
        
        // Get basic stats
        $stats = [
            'total_pages' => $this->db->fetchOne("SELECT COUNT(*) as count FROM pages")['count'],
            'published_pages' => $this->db->fetchOne("SELECT COUNT(*) as count FROM pages WHERE is_published = 1")['count'],
            'total_media' => $this->db->fetchOne("SELECT COUNT(*) as count FROM media")['count'],
        ];
        
        $this->view('admin/dashboard', ['stats' => $stats]);
    }
}


================================================================================

# FAQAdminController.php
# path: .\controllers\admin\FAQAdminController.php

    <?php

require_once BASE_PATH . '/models/FAQ.php';
require_once BASE_PATH . '/models/Page.php';

class FAQAdminController extends Controller {
    private $faqModel;
    private $pageModel;

    public function __construct() {
        parent::__construct();
        $this->faqModel = new FAQ();
        $this->pageModel = new Page();
    }

    public function index() {
        $this->requireAuth();
        
        $faqs = $this->faqModel->getAll();
        $pages = $this->pageModel->getAll(true);
        
        $this->view('admin/faqs/list', ['faqs' => $faqs, 'pages' => $pages]);
    }

    public function edit($id = null) {
        $this->requireAuth();
        
        $faq = null;
        if ($id) {
            $faq = $this->faqModel->getById($id);
            if (!$faq) {
                $_SESSION['error'] = 'FAQ not found';
                $this->redirect('/admin/faqs');
            }
        }
        
        $pages = $this->pageModel->getAll(true);
        $this->view('admin/faqs/edit', ['faq' => $faq, 'pages' => $pages]);
    }

    public function save() {
        $this->requireAuth();
        
        $id = $_POST['id'] ?? null;
        $data = [
            'page_slug' => trim($_POST['page_slug']),
            'question_ru' => trim($_POST['question_ru']),
            'question_uz' => trim($_POST['question_uz']),
            'answer_ru' => trim($_POST['answer_ru']),
            'answer_uz' => trim($_POST['answer_uz']),
            'sort_order' => intval($_POST['sort_order'] ?? 0),
            'is_active' => isset($_POST['is_active']) ? 1 : 0
        ];
        
        if ($id) {
            $this->faqModel->update($id, $data);
            $_SESSION['success'] = 'FAQ updated successfully';
        } else {
            $this->faqModel->create($data);
            $_SESSION['success'] = 'FAQ created successfully';
        }
        
        $this->redirect('/admin/faqs');
    }

    public function delete() {
        $this->requireAuth();
        
        $id = $_POST['id'] ?? null;
        if ($id) {
            $this->faqModel->delete($id);
            $_SESSION['success'] = 'FAQ deleted successfully';
        }
        
        $this->redirect('/admin/faqs');
    }
    public function bulkUpload() {
        $this->requireAuth();
        
        if (!isset($_FILES['file'])) {
            $_SESSION['error'] = 'No file uploaded';
            $this->redirect('/admin/faqs');
            return;
        }
        
        $file = $_FILES['file'];
        $ext = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));
        
        if (!in_array($ext, ['csv', 'json'])) {
            $_SESSION['error'] = 'Only CSV and JSON files are supported';
            $this->redirect('/admin/faqs');
            return;
        }
        
        try {
            $data = [];
            
            if ($ext === 'csv') {
                $data = $this->parseCSV($file['tmp_name']);
            } else {
                $content = file_get_contents($file['tmp_name']);
                $data = json_decode($content, true);
                if (json_last_error() !== JSON_ERROR_NONE) {
                    throw new Exception('Invalid JSON format');
                }
            }
            
            $created = 0;
            $errors = [];
            
            foreach ($data as $index => $row) {
                // Validate required fields
                if (empty($row['page_slug']) || empty($row['question_ru']) || empty($row['answer_ru'])) {
                    $errors[] = "Row " . ($index + 1) . ": Missing required fields";
                    continue;
                }
                
                // Prepare data
                $insertData = [
                    'page_slug' => trim($row['page_slug']),
                    'question_ru' => trim($row['question_ru']),
                    'question_uz' => trim($row['question_uz'] ?? ''),
                    'answer_ru' => trim($row['answer_ru']),
                    'answer_uz' => trim($row['answer_uz'] ?? ''),
                    'sort_order' => isset($row['sort_order']) ? (int)$row['sort_order'] : 0,
                    'is_active' => isset($row['is_active']) ? (int)$row['is_active'] : 1
                ];
                
                if ($this->faqModel->create($insertData)) {
                    $created++;
                } else {
                    $errors[] = "Row " . ($index + 1) . ": Failed to create FAQ";
                }
            }
            
            $message = "Created $created FAQ(s)";
            if (!empty($errors)) {
                $message .= ". Errors: " . implode(', ', array_slice($errors, 0, 5));
            }
            
            $_SESSION['success'] = $message;
            
        } catch (Exception $e) {
            $_SESSION['error'] = 'Upload failed: ' . $e->getMessage();
        }
        
        $this->redirect('/admin/faqs');
    }

    private function parseCSV($filepath) {
        $data = [];
        $handle = fopen($filepath, 'r');
        
        // Get headers from first row
        $headers = fgetcsv($handle);
        $headers = array_map('trim', $headers);
        
        while (($row = fgetcsv($handle)) !== false) {
            $data[] = array_combine($headers, $row);
        }
        
        fclose($handle);
        return $data;
    }

    public function downloadTemplate() {
        $this->requireAuth();
        
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment; filename="faq_template.csv"');
        
        $output = fopen('php://output', 'w');
        
        // Headers
        fputcsv($output, [
            'page_slug', 'question_ru', 'question_uz', 
            'answer_ru', 'answer_uz', 'sort_order', 'is_active'
        ]);
        
        // Example row
        fputcsv($output, [
            'home', 
            'Какой вопрос?', 
            'Qanday savol?',
            'Это ответ на русском языке', 
            'Bu o\'zbekcha javob',
            '0', 
            '1'
        ]);
        
        fclose($output);
        exit;
    }
}

================================================================================

# MediaController.php
# path: .\controllers\admin\MediaController.php

<?php
require_once BASE_PATH . '/models/Media.php';

class MediaController extends Controller {
    private $mediaModel;

    public function __construct() {
        parent::__construct();
        $this->mediaModel = new Media();
    }

    public function index() {
        $this->requireAuth();
        $media = $this->mediaModel->getAll();
        $this->view('admin/media/manager', ['media' => $media]);
    }

    public function upload() {
        $this->requireAuth();
        
        if (!isset($_FILES['file'])) {
            $this->json(['success' => false, 'message' => 'No file uploaded'], 400);
        }
        
        $file = $_FILES['file'];
        
        // Validate file
        $allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
        if (!in_array($file['type'], $allowedTypes)) {
            $this->json(['success' => false, 'message' => 'Invalid file type'], 400);
        }
        
        if ($file['size'] > MAX_UPLOAD_SIZE) {
            $this->json(['success' => false, 'message' => 'File too large'], 400);
        }
        
        // Generate unique filename
        $ext = pathinfo($file['name'], PATHINFO_EXTENSION);
        $filename = uniqid() . '_' . time() . '.' . $ext;
        $filepath = UPLOAD_PATH . $filename;
        
        // Create upload directory if not exists
        if (!is_dir(UPLOAD_PATH)) {
            mkdir(UPLOAD_PATH, 0755, true);
        }
        
        // Move file
        if (move_uploaded_file($file['tmp_name'], $filepath)) {
            $data = [
                'filename' => $filename,
                'original_name' => $file['name'],
                'file_size' => $file['size'],
                'mime_type' => $file['type']
            ];
            
            $id = $this->mediaModel->create($data);
            
            $this->json([
                'success' => true,
                'id' => $id,
                'filename' => $filename,
                'url' => UPLOAD_URL . $filename
            ]);
        } else {
            $this->json(['success' => false, 'message' => 'Upload failed'], 500);
        }
    }

    public function delete() {
        $this->requireAuth();
        
        $id = $_POST['id'] ?? null;
        if ($id && $this->mediaModel->delete($id)) {
            $this->json(['success' => true]);
        } else {
            $this->json(['success' => false, 'message' => 'Delete failed'], 400);
        }
    }
    public function bulkUpload() {
        $this->requireAuth();
        
        if (!isset($_FILES['files'])) {
            $this->json(['success' => false, 'message' => 'No files uploaded'], 400);
        }
        
        $files = $_FILES['files'];
        $uploaded = 0;
        $errors = [];
        
        // Allowed types
        $allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
        
        // Create upload directory if not exists
        if (!is_dir(UPLOAD_PATH)) {
            mkdir(UPLOAD_PATH, 0755, true);
        }
        
        // Handle multiple files
        $fileCount = count($files['name']);
        
        for ($i = 0; $i < $fileCount; $i++) {
            $fileName = $files['name'][$i];
            $fileTmpName = $files['tmp_name'][$i];
            $fileSize = $files['size'][$i];
            $fileType = $files['type'][$i];
            $fileError = $files['error'][$i];
            
            // Skip if upload error
            if ($fileError !== UPLOAD_ERR_OK) {
                $errors[] = "$fileName: Upload error";
                continue;
            }
            
            // Validate file type
            if (!in_array($fileType, $allowedTypes)) {
                $errors[] = "$fileName: Invalid file type";
                continue;
            }
            
            // Validate file size
            if ($fileSize > MAX_UPLOAD_SIZE) {
                $errors[] = "$fileName: File too large";
                continue;
            }
            
            // Generate unique filename
            $ext = pathinfo($fileName, PATHINFO_EXTENSION);
            $newFileName = uniqid() . '_' . time() . '_' . $i . '.' . $ext;
            $filepath = UPLOAD_PATH . $newFileName;
            
            // Move file
            if (move_uploaded_file($fileTmpName, $filepath)) {
                $data = [
                    'filename' => $newFileName,
                    'original_name' => $fileName,
                    'file_size' => $fileSize,
                    'mime_type' => $fileType
                ];
                
                if ($this->mediaModel->create($data)) {
                    $uploaded++;
                } else {
                    $errors[] = "$fileName: Database insert failed";
                }
            } else {
                $errors[] = "$fileName: Failed to move file";
            }
        }
        
        $message = "Uploaded $uploaded file(s)";
        if (!empty($errors)) {
            $message .= ". Errors: " . implode(', ', array_slice($errors, 0, 5));
        }
        
        $_SESSION['success'] = $message;
        header('Location: ' . BASE_URL . '/admin/media');
        exit;
    }
}


================================================================================

# PageAdminController.php
# path: .\controllers\admin\PageAdminController.php

<?php
// path: ./controllers/admin/PageAdminController.php

require_once BASE_PATH . '/models/Page.php';

class PageAdminController extends Controller {
    private $pageModel;

    public function __construct() {
        parent::__construct();
        $this->pageModel = new Page();
    }

    public function index() {
        $this->requireAuth();
        $pages = $this->pageModel->getAll(true);
        $this->view('admin/pages/list', ['pages' => $pages]);
    }

    public function edit($id = null) {
        $this->requireAuth();
        
        $page = null;
        if ($id) {
            $page = $this->pageModel->getById($id);
            if (!$page) {
                $_SESSION['error'] = 'Page not found';
                $this->redirect('/admin/pages');
            }
        }
        
        $this->view('admin/pages/edit', ['page' => $page]);
    }

    public function save() {
        $this->requireAuth();
        
        $id = $_POST['id'] ?? null;
        $data = [
            'slug' => trim($_POST['slug']),
            'title_ru' => trim($_POST['title_ru']),
            'title_uz' => trim($_POST['title_uz']),
            'content_ru' => $_POST['content_ru'] ?? '',
            'content_uz' => $_POST['content_uz'] ?? '',
            'meta_title_ru' => trim($_POST['meta_title_ru']) ?: null,
            'meta_title_uz' => trim($_POST['meta_title_uz']) ?: null,
            'meta_keywords_ru' => trim($_POST['meta_keywords_ru']) ?: null,
            'meta_keywords_uz' => trim($_POST['meta_keywords_uz']) ?: null,
            'meta_description_ru' => trim($_POST['meta_description_ru']) ?: null,
            'meta_description_uz' => trim($_POST['meta_description_uz']) ?: null,
            'og_title_ru' => trim($_POST['og_title_ru']) ?: null,
            'og_title_uz' => trim($_POST['og_title_uz']) ?: null,
            'og_description_ru' => trim($_POST['og_description_ru']) ?: null,
            'og_description_uz' => trim($_POST['og_description_uz']) ?: null,
            'og_image' => trim($_POST['og_image']) ?: null,
            'canonical_url' => trim($_POST['canonical_url']) ?: null,
            'jsonld_ru' => trim($_POST['jsonld_ru']) ?: null,
            'jsonld_uz' => trim($_POST['jsonld_uz']) ?: null,
            'is_published' => isset($_POST['is_published']) ? 1 : 0,
            'enable_rotation' => isset($_POST['enable_rotation']) ? 1 : 0,
            'sort_order' => intval($_POST['sort_order'] ?? 0)
        ];
        
        if ($id) {
            $this->pageModel->update($id, $data);
            $_SESSION['success'] = 'Page updated successfully';
        } else {
            $this->pageModel->create($data);
            $_SESSION['success'] = 'Page created successfully';
        }
        
        $this->redirect('/admin/pages');
    }

    public function delete() {
        $this->requireAuth();
        
        $id = $_POST['id'] ?? null;
        if ($id) {
            $this->pageModel->delete($id);
            $_SESSION['success'] = 'Page deleted successfully';
        }
        
        $this->redirect('/admin/pages');
    }
}

================================================================================

# PreviewController.php
# path: .\controllers\admin\PreviewController.php

<?php
// path: ./controllers/admin/PreviewController.php
// IMPLEMENTATION: Place in controllers/admin/PreviewController.php

require_once BASE_PATH . '/models/Page.php';
require_once BASE_PATH . '/models/ContentRotation.php';
require_once BASE_PATH . '/models/SEO.php';
require_once BASE_PATH . '/models/FAQ.php';

class PreviewController extends Controller {
    private $pageModel;
    private $rotationModel;
    private $seoModel;
    private $faqModel;

    public function __construct() {
        parent::__construct();
        $this->pageModel = new Page();
        $this->rotationModel = new ContentRotation();
        $this->seoModel = new SEO();
        $this->faqModel = new FAQ();
    }

    /**
     * Preview page with specific rotation month
     * URL: /admin/preview/{pageId}?month={1-12}&lang={ru|uz}
     */
    public function show($pageId) {
        $this->requireAuth();
        
        $month = isset($_GET['month']) ? intval($_GET['month']) : date('n');
        $lang = isset($_GET['lang']) ? $_GET['lang'] : 'ru';
        
        if (!in_array($lang, ['ru', 'uz']) || $month < 1 || $month > 12) {
            $_SESSION['error'] = 'Invalid parameters';
            $this->redirect('/admin/pages');
            return;
        }
        
        // Get page
        $page = $this->pageModel->getById($pageId);
        if (!$page) {
            $_SESSION['error'] = 'Page not found';
            $this->redirect('/admin/pages');
            return;
        }
        
        // Get rotation for this month if enabled
        $rotationContent = null;
        if ($page['enable_rotation']) {
            $sql = "SELECT * FROM content_rotations WHERE page_id = ? AND active_month = ? LIMIT 1";
            $rotationContent = $this->db->fetchOne($sql, [$pageId, $month]);
            
            if ($rotationContent) {
                // Override page content with rotation
                if (!empty($rotationContent["title_$lang"])) {
                    $page["title_$lang"] = $rotationContent["title_$lang"];
                }
                $page["content_$lang"] = $rotationContent["content_$lang"];
                
                // Override SEO if rotation has it
                $seoFields = [
                    'meta_title', 'meta_description', 'meta_keywords',
                    'og_title', 'og_description', 'og_image', 'jsonld'
                ];
                
                foreach ($seoFields as $field) {
                    if ($field === 'og_image') {
                        if (!empty($rotationContent[$field])) {
                            $page[$field] = $rotationContent[$field];
                        }
                    } else {
                        $fieldWithLang = "{$field}_{$lang}";
                        if (!empty($rotationContent[$fieldWithLang])) {
                            $page[$fieldWithLang] = $rotationContent[$fieldWithLang];
                        }
                    }
                }
            }
        }
        
        // Get global SEO settings
        $seoSettings = $this->seoModel->getSettings();
        
        // Get FAQs
        $faqs = $this->faqModel->getBySlug($page['slug']);
        
        // Build template data with preview date
        $previewDate = new DateTime();
        $previewDate->setDate(date('Y'), $month, 1);
        
        $templateData = [
            'page' => [
                'title' => $page["title_$lang"],
                'slug' => $page['slug'],
                'content' => $page["content_$lang"],
                'meta_title' => $page["meta_title_$lang"],
                'meta_description' => $page["meta_description_$lang"],
            ],
            'global' => [
                'phone' => $seoSettings['phone'] ?? '',
                'email' => $seoSettings['email'] ?? '',
                'address' => $seoSettings["address_$lang"] ?? '',
                'working_hours' => $seoSettings["working_hours_$lang"] ?? '',
                'site_name' => $seoSettings["site_name_$lang"] ?? '',
            ],
            'seo' => $seoSettings,
            'faqs' => $faqs,
            'lang' => $lang,
            'date' => [
                'year' => $previewDate->format('Y'),
                'month' => $month,
                'month_name' => $previewDate->format('F'),
                'day' => $previewDate->format('j'),
            ],
            'rotation' => [
                'active' => !empty($rotationContent),
                'month' => $month
            ]
        ];
        
        // Render content with template engine
        $page["content_$lang"] = renderTemplate($page["content_$lang"], $templateData);
        
        // Prepare data for view
        $data = [
            'page' => $page,
            'seo' => $seoSettings,
            'faqs' => $faqs,
            'lang' => $lang,
            'templateData' => $templateData,
            'previewMode' => true,
            'previewMonth' => $month,
            'hasRotation' => !empty($rotationContent)
        ];
        
        $this->view('templates/preview', $data);
    }
    
    /**
     * API endpoint to get preview content
     * Returns JSON for inline preview
     */
    public function getPreviewContent($pageId) {
        $this->requireAuth();
        
        $month = isset($_GET['month']) ? intval($_GET['month']) : date('n');
        $lang = isset($_GET['lang']) ? $_GET['lang'] : 'ru';
        
        $page = $this->pageModel->getById($pageId);
        if (!$page) {
            $this->json(['error' => 'Page not found'], 404);
            return;
        }
        
        // Get rotation
        $rotationContent = null;
        if ($page['enable_rotation']) {
            $sql = "SELECT * FROM content_rotations WHERE page_id = ? AND active_month = ? LIMIT 1";
            $rotationContent = $this->db->fetchOne($sql, [$pageId, $month]);
        }
        
        // Process content
        $seoSettings = $this->seoModel->getSettings();
        $faqs = $this->faqModel->getBySlug($page['slug']);
        
        $previewDate = new DateTime();
        $previewDate->setDate(date('Y'), $month, 1);
        
        $templateData = [
            'page' => [
                'title' => $rotationContent["title_$lang"] ?? $page["title_$lang"],
                'slug' => $page['slug'],
            ],
            'global' => [
                'phone' => $seoSettings['phone'] ?? '',
                'email' => $seoSettings['email'] ?? '',
                'address' => $seoSettings["address_$lang"] ?? '',
                'working_hours' => $seoSettings["working_hours_$lang"] ?? '',
                'site_name' => $seoSettings["site_name_$lang"] ?? '',
            ],
            'date' => [
                'year' => $previewDate->format('Y'),
                'month' => $month,
                'month_name' => $previewDate->format('F'),
                'day' => $previewDate->format('j'),
            ]
        ];
        
        $content = $rotationContent["content_$lang"] ?? $page["content_$lang"];
        $content = renderTemplate($content, $templateData);
        
        $this->json([
            'success' => true,
            'content' => $content,
            'title' => $templateData['page']['title'],
            'hasRotation' => !empty($rotationContent),
            'month' => $month
        ]);
    }
}

================================================================================

# RotationAdminController.php
# path: .\controllers\admin\RotationAdminController.php

<?php
// path: ./controllers/admin/RotationAdminController.php

require_once BASE_PATH . '/models/ContentRotation.php';
require_once BASE_PATH . '/models/Page.php';

class RotationAdminController extends Controller {
    private $rotationModel;
    private $pageModel;

    public function __construct() {
        parent::__construct();
        $this->rotationModel = new ContentRotation();
        $this->pageModel = new Page();
    }

    /**
     * Overview of all pages with rotation status
     */
    public function overview() {
        $this->requireAuth();
        
        $pages = $this->pageModel->getAll(true);
        $rotationStatus = [];
        
        foreach ($pages as $page) {
            if ($page['enable_rotation']) {
                $stats = $this->rotationModel->getCoverageStats($page['id']);
                $rotationStatus[] = [
                    'page' => $page,
                    'stats' => $stats
                ];
            }
        }
        
        // Get pages with incomplete rotation
        $incompletePages = $this->rotationModel->getPagesWithIncompleteRotation();
        
        $this->view('admin/rotations/overview', [
            'rotationStatus' => $rotationStatus,
            'incompletePages' => $incompletePages
        ]);
    }

    public function manage($pageId) {
        $this->requireAuth();
        
        $page = $this->pageModel->getById($pageId);
        if (!$page) {
            $_SESSION['error'] = 'Page not found';
            $this->redirect('/admin/pages');
        }
        
        $rotations = $this->rotationModel->getByPageId($pageId);
        $months = $this->rotationModel->getMonths();
        $stats = $this->rotationModel->getCoverageStats($pageId);
        
        $this->view('admin/rotations/manage', [
            'page' => $page,
            'rotations' => $rotations,
            'months' => $months,
            'stats' => $stats
        ]);
    }

    public function edit($id = null, $pageId = null) {
        $this->requireAuth();
        
        $rotation = null;
        $page = null;
        $suggestedMonth = $_GET['month'] ?? null;
        
        if ($id) {
            $rotation = $this->rotationModel->getById($id);
            if (!$rotation) {
                $_SESSION['error'] = 'Rotation not found';
                $this->redirect('/admin/pages');
            }
            $page = $this->pageModel->getById($rotation['page_id']);
        } else if ($pageId) {
            $page = $this->pageModel->getById($pageId);
        }
        
        if (!$page) {
            $_SESSION['error'] = 'Page not found';
            $this->redirect('/admin/pages');
        }
        
        $months = $this->rotationModel->getMonths();
        $stats = $this->rotationModel->getCoverageStats($page['id']);
        
        $this->view('admin/rotations/edit', [
            'rotation' => $rotation,
            'page' => $page,
            'months' => $months,
            'stats' => $stats,
            'suggestedMonth' => $suggestedMonth
        ]);
    }

    public function save() {
        $this->requireAuth();
        
        $id = $_POST['id'] ?? null;
        $pageId = intval($_POST['page_id']);
        $activeMonth = intval($_POST['active_month']);
        $defaultFromPage = isset($_POST['default_from_page']);
        
        // If "default from page" button was clicked
        if (!$id && $defaultFromPage) {
            $result = $this->rotationModel->createDefaultFromPage($pageId, $activeMonth);
            if ($result) {
                $_SESSION['success'] = 'Content rotation created with page defaults';
            } else {
                $_SESSION['error'] = 'Failed to create rotation with defaults';
            }
            $this->redirect('/admin/rotations/manage/' . $pageId);
            return;
        }
        
        // Check for duplicate month
        if (!$id || ($id && $this->rotationModel->getById($id)['active_month'] != $activeMonth)) {
            if ($this->rotationModel->monthHasContent($pageId, $activeMonth)) {
                $_SESSION['error'] = 'This month already has content. Please edit the existing entry or choose a different month.';
                $this->redirect('/admin/rotations/manage/' . $pageId);
                return;
            }
        }
        
        $data = [
            'page_id' => $pageId,
            'title_ru' => trim($_POST['title_ru'] ?? ''),
            'title_uz' => trim($_POST['title_uz'] ?? ''),
            'content_ru' => $_POST['content_ru'] ?? '',
            'content_uz' => $_POST['content_uz'] ?? '',
            'description_ru' => trim($_POST['description_ru'] ?? ''),
            'description_uz' => trim($_POST['description_uz'] ?? ''),
            'active_month' => $activeMonth,
            'is_active' => isset($_POST['is_active']) ? 1 : 0,
            'meta_title_ru' => trim($_POST['meta_title_ru'] ?? '') ?: null,
            'meta_title_uz' => trim($_POST['meta_title_uz'] ?? '') ?: null,
            'meta_description_ru' => trim($_POST['meta_description_ru'] ?? '') ?: null,
            'meta_description_uz' => trim($_POST['meta_description_uz'] ?? '') ?: null,
            'meta_keywords_ru' => trim($_POST['meta_keywords_ru'] ?? '') ?: null,
            'meta_keywords_uz' => trim($_POST['meta_keywords_uz'] ?? '') ?: null,
            'og_title_ru' => trim($_POST['og_title_ru'] ?? '') ?: null,
            'og_title_uz' => trim($_POST['og_title_uz'] ?? '') ?: null,
            'og_description_ru' => trim($_POST['og_description_ru'] ?? '') ?: null,
            'og_description_uz' => trim($_POST['og_description_uz'] ?? '') ?: null,
            'og_image' => trim($_POST['og_image'] ?? '') ?: null,
            'jsonld_ru' => trim($_POST['jsonld_ru'] ?? '') ?: null,
            'jsonld_uz' => trim($_POST['jsonld_uz'] ?? '') ?: null
        ];
        
        if ($id) {
            $this->rotationModel->update($id, $data);
            $_SESSION['success'] = 'Content rotation updated successfully';
        } else {
            $this->rotationModel->create($data);
            $_SESSION['success'] = 'Content rotation created successfully';
        }
        
        $this->redirect('/admin/rotations/manage/' . $pageId);
    }

    /**
     * Clone rotation content to another month
     */
    public function clone() {
        $this->requireAuth();
        
        $sourceId = intval($_POST['source_id'] ?? 0);
        $targetMonth = intval($_POST['target_month'] ?? 0);
        
        if (!$sourceId || !$targetMonth) {
            $_SESSION['error'] = 'Invalid parameters';
            $this->redirect('/admin/rotations/overview');
            return;
        }
        
        $source = $this->rotationModel->getById($sourceId);
        if (!$source) {
            $_SESSION['error'] = 'Source rotation not found';
            $this->redirect('/admin/rotations/overview');
            return;
        }
        
        $result = $this->rotationModel->cloneToMonth($sourceId, $targetMonth);
        
        if ($result) {
            $_SESSION['success'] = 'Content cloned successfully to ' . $this->rotationModel->getMonthNameRu($targetMonth);
        } else {
            $_SESSION['error'] = 'Failed to clone content. Target month may already have content.';
        }
        
        $this->redirect('/admin/rotations/manage/' . $source['page_id']);
    }

    /**
     * Bulk operations
     */
    public function bulkAction() {
        $this->requireAuth();
        
        $action = $_POST['action'] ?? '';
        $ids = $_POST['ids'] ?? [];
        $pageId = $_POST['page_id'] ?? null;
        
        if (empty($ids) || !is_array($ids)) {
            $_SESSION['error'] = 'No items selected';
            $this->redirect($pageId ? '/admin/rotations/manage/' . $pageId : '/admin/rotations/overview');
            return;
        }
        
        $ids = array_map('intval', $ids);
        
        switch ($action) {
            case 'activate':
                $this->rotationModel->bulkUpdateStatus($ids, 1);
                $_SESSION['success'] = count($ids) . ' rotation(s) activated';
                break;
                
            case 'deactivate':
                $this->rotationModel->bulkUpdateStatus($ids, 0);
                $_SESSION['success'] = count($ids) . ' rotation(s) deactivated';
                break;
                
            case 'delete':
                $this->rotationModel->bulkDelete($ids);
                $_SESSION['success'] = count($ids) . ' rotation(s) deleted';
                break;
                
            default:
                $_SESSION['error'] = 'Invalid action';
        }
        
        $this->redirect($pageId ? '/admin/rotations/manage/' . $pageId : '/admin/rotations/overview');
    }

    public function delete() {
        $this->requireAuth();
        
        $id = $_POST['id'] ?? null;
        $pageId = $_POST['page_id'] ?? null;
        
        if ($id) {
            $this->rotationModel->delete($id);
            $_SESSION['success'] = 'Content rotation deleted successfully';
        }
        
        if ($pageId) {
            $this->redirect('/admin/rotations/manage/' . $pageId);
        } else {
            $this->redirect('/admin/pages');
        }
    }

    /**
     * Preview rotation content without saving
     */
    public function preview() {
        $this->requireAuth();
        
        $contentRu = $_POST['content_ru'] ?? '';
        $contentUz = $_POST['content_uz'] ?? '';
        $lang = $_POST['lang'] ?? 'ru';
        
        // Simple preview rendering
        $content = $lang === 'uz' ? $contentUz : $contentRu;
        
        echo '<html><head><meta charset="UTF-8"><style>
            body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
            h1, h2, h3 { color: #303034; }
        </style></head><body>';
        echo $content;
        echo '</body></html>';
        exit;
    }
        public function bulkUpload() {
            $this->requireAuth();
            
            if (!isset($_FILES['file'])) {
                $_SESSION['error'] = 'No file uploaded';
                $this->redirect('/admin/rotations/overview');
                return;
            }
            
            $file = $_FILES['file'];
            $ext = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));
            
            if (!in_array($ext, ['csv', 'json'])) {
                $_SESSION['error'] = 'Only CSV and JSON files are supported';
                $this->redirect('/admin/rotations/overview');
                return;
            }
            
            try {
                $data = [];
                
                if ($ext === 'csv') {
                    $data = $this->parseCSV($file['tmp_name']);
                } else {
                    $content = file_get_contents($file['tmp_name']);
                    $data = json_decode($content, true);
                    if (json_last_error() !== JSON_ERROR_NONE) {
                        throw new Exception('Invalid JSON format');
                    }
                }
                
                $created = 0;
                $errors = [];
                
                foreach ($data as $index => $row) {
                    // Validate required fields
                    if (empty($row['page_id']) || empty($row['active_month'])) {
                        $errors[] = "Row " . ($index + 1) . ": Missing page_id or active_month";
                        continue;
                    }
                    
                    // Check if month already has content
                    if ($this->rotationModel->monthHasContent($row['page_id'], $row['active_month'])) {
                        $errors[] = "Row " . ($index + 1) . ": Month {$row['active_month']} already has content";
                        continue;
                    }
                    
                    // Prepare data with new fields
                    $insertData = [
                        'page_id' => (int)$row['page_id'],
                        'active_month' => (int)$row['active_month'],
                        'title_ru' => $row['title_ru'] ?? null,
                        'title_uz' => $row['title_uz'] ?? null,
                        'description_ru' => $row['description_ru'] ?? null,
                        'description_uz' => $row['description_uz'] ?? null,
                        'content_ru' => $row['content_ru'] ?? '',
                        'content_uz' => $row['content_uz'] ?? '',
                        'is_active' => isset($row['is_active']) ? (int)$row['is_active'] : 1,
                        'meta_title_ru' => $row['meta_title_ru'] ?? null,
                        'meta_title_uz' => $row['meta_title_uz'] ?? null,
                        'meta_description_ru' => $row['meta_description_ru'] ?? null,
                        'meta_description_uz' => $row['meta_description_uz'] ?? null,
                        'meta_keywords_ru' => $row['meta_keywords_ru'] ?? null,
                        'meta_keywords_uz' => $row['meta_keywords_uz'] ?? null,
                        'og_title_ru' => $row['og_title_ru'] ?? null,
                        'og_title_uz' => $row['og_title_uz'] ?? null,
                        'og_description_ru' => $row['og_description_ru'] ?? null,
                        'og_description_uz' => $row['og_description_uz'] ?? null,
                        'og_image' => $row['og_image'] ?? null,
                        'jsonld_ru' => $row['jsonld_ru'] ?? null,
                        'jsonld_uz' => $row['jsonld_uz'] ?? null
                    ];
                    
                    if ($this->rotationModel->create($insertData)) {
                        $created++;
                    } else {
                        $errors[] = "Row " . ($index + 1) . ": Failed to create rotation";
                    }
                }
                
                $message = "Created $created rotation(s)";
                if (!empty($errors)) {
                    $message .= ". Errors: " . implode(', ', array_slice($errors, 0, 5));
                }
                
                $_SESSION['success'] = $message;
                
            } catch (Exception $e) {
                $_SESSION['error'] = 'Upload failed: ' . $e->getMessage();
            }
            
            $this->redirect('/admin/rotations/overview');
        }

    private function parseCSV($filepath) {
        $data = [];
        $handle = fopen($filepath, 'r');
        
        // Get headers from first row
        $headers = fgetcsv($handle);
        $headers = array_map('trim', $headers);
        
        while (($row = fgetcsv($handle)) !== false) {
            $data[] = array_combine($headers, $row);
        }
        
        fclose($handle);
        return $data;
    }

    public function downloadTemplate() {
        $this->requireAuth();
        
        header('Content-Type: text/csv');
        header('Content-Disposition: attachment; filename="rotation_template.csv"');
        
        $output = fopen('php://output', 'w');
        
        // Headers with keywords included
        fputcsv($output, [
            'page_id', 'active_month', 'title_ru', 'title_uz', 
            'description_ru', 'description_uz', 'content_ru', 'content_uz', 
            'is_active', 'meta_title_ru', 'meta_title_uz', 
            'meta_description_ru', 'meta_description_uz',
            'meta_keywords_ru', 'meta_keywords_uz'  // ADD THESE
        ]);
        
        // Example row with keywords
        fputcsv($output, [
            '1', '1', 'January Title RU', 'January Title UZ',
            'Brief description RU', 'Brief description UZ',
            'Full content RU', 'Full content UZ',
            '1', 'Meta title RU', 'Meta title UZ',
            'Meta description RU', 'Meta description UZ',
            'keyword1, keyword2, keyword3', 'kalit1, kalit2, kalit3'  // ADD THESE
        ]);
        
        fclose($output);
        exit;
    }
}

================================================================================

# SEOController.php
# path: .\controllers\admin\SEOController.php

<?php
require_once BASE_PATH . '/models/SEO.php';

class SEOController extends Controller {
    private $seoModel;

    public function __construct() {
        parent::__construct();
        $this->seoModel = new SEO();
    }

    public function index() {
        $this->requireAuth();
        $settings = $this->seoModel->getSettings();
        $this->view('admin/seo/settings', ['settings' => $settings]);
    }

    public function save() {
        $this->requireAuth();
        
        $data = [
            'site_name_ru' => trim($_POST['site_name_ru']),
            'site_name_uz' => trim($_POST['site_name_uz']),
            'meta_keywords_ru' => trim($_POST['meta_keywords_ru']),
            'meta_keywords_uz' => trim($_POST['meta_keywords_uz']),
            'meta_description_ru' => trim($_POST['meta_description_ru']),
            'meta_description_uz' => trim($_POST['meta_description_uz']),
            'phone' => trim($_POST['phone']),
            'email' => trim($_POST['email']),
            'address_ru' => trim($_POST['address_ru']),
            'address_uz' => trim($_POST['address_uz']),
            'working_hours_ru' => trim($_POST['working_hours_ru']),
            'working_hours_uz' => trim($_POST['working_hours_uz'])
        ];
        
        $this->seoModel->updateSettings($data);
        $_SESSION['success'] = 'SEO settings updated successfully';
        
        $this->redirect('/admin/seo');
    }
}

================================================================================

# Controller.php
# path: .\core\Controller.php

<?php
class Controller {
    protected $db;

    public function __construct() {
        $this->db = Database::getInstance();
    }

    protected function view($file, $data = []) {
        extract($data);
        require BASE_PATH . '/views/' . $file . '.php';
    }

    protected function redirect($url) {
        header("Location: " . BASE_URL . $url);
        exit;
    }

    protected function json($data, $code = 200) {
        http_response_code($code);
        header('Content-Type: application/json');
        echo json_encode($data);
        exit;
    }

    protected function requireAuth() {
        if (!isset($_SESSION['user_id'])) {
            $this->redirect('/admin/login');
        }
    }
}


================================================================================

# Database.php
# path: .\core\Database.php

<?php
class Database {
    private static $instance = null;
    private $pdo;

    private function __construct() {
        try {
            $dsn = "mysql:host=" . DB_HOST . ";dbname=" . DB_NAME . ";charset=" . DB_CHARSET;
            $options = [
                PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,
                PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
                PDO::ATTR_EMULATE_PREPARES => false,
            ];
            $this->pdo = new PDO($dsn, DB_USER, DB_PASS, $options);
        } catch (PDOException $e) {
            die("Database connection failed: " . $e->getMessage());
        }
    }

    public static function getInstance() {
        if (self::$instance === null) {
            self::$instance = new self();
        }
        return self::$instance;
    }

    public function getConnection() {
        return $this->pdo;
    }

    public function query($sql, $params = []) {
        $stmt = $this->pdo->prepare($sql);
        $stmt->execute($params);
        return $stmt;
    }

    public function fetchOne($sql, $params = []) {
        return $this->query($sql, $params)->fetch();
    }

    public function fetchAll($sql, $params = []) {
        return $this->query($sql, $params)->fetchAll();
    }

    public function lastInsertId() {
        return $this->pdo->lastInsertId();
    }
}

================================================================================

# Router.php
# path: .\core\Router.php

<?php
class Router {
    private $routes = [];
    private $notFound;

    public function get($pattern, $callback) {
        $this->routes['GET'][$pattern] = $callback;
    }

    public function post($pattern, $callback) {
        $this->routes['POST'][$pattern] = $callback;
    }

    public function notFound($callback) {
        $this->notFound = $callback;
    }
    public function error(int $code = 500) {
        http_response_code($code);
        $_GET['code'] = $code;
        require BASE_PATH . '/views/error.php';
        exit;
    }


    public function dispatch() {
        try {
            $method = $_SERVER['REQUEST_METHOD'];
            $uri = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);

            $base = dirname($_SERVER['SCRIPT_NAME']);
            if ($base !== '/' && strpos($uri, $base) === 0) {
                $uri = substr($uri, strlen($base));
            }

            $uri = '/' . trim($uri, '/');

            if (isset($this->routes[$method])) {

                uksort($this->routes[$method], function ($a, $b) {
                    return (strpos($a, '{') !== false) <=> (strpos($b, '{') !== false);
                });

                foreach ($this->routes[$method] as $pattern => $callback) {

                    $pattern = '/' . ltrim($pattern, '/');
                    $pattern = preg_replace(
                        '/\{([a-zA-Z0-9_]+)\}/',
                        '(?P<$1>[^/]+)',
                        $pattern
                    );

                    $pattern = '#^' . $pattern . '$#';

                    if (preg_match($pattern, $uri, $matches)) {
                        $params = array_filter($matches, 'is_string', ARRAY_FILTER_USE_KEY);
                        return call_user_func_array($callback, $params);
                    }
                }
            }

            $this->error(404);

        } catch (\Throwable $e) {
            error_log($e);
            $this->error(500);
        }
    }
}

================================================================================

# helpers.php
# path: .\core\helpers.php

<?php
// path: ./core/helpers.php

function e($string) {
    return htmlspecialchars($string, ENT_QUOTES, 'UTF-8');
}

function getCurrentLanguage() {
    return $_SESSION['language'] ?? DEFAULT_LANGUAGE;
}

function setLanguage($lang) {
    if (in_array($lang, SUPPORTED_LANGUAGES)) {
        $_SESSION['language'] = $lang;
    }
}

function showError(int $code = 500) {
    // Check if $router exists in this scope
    global $router;

    if (isset($router) && method_exists($router, 'error')) {
        $router->error($code);
    } else {
        // fallback if router is unavailable
        http_response_code($code);
        echo "Error $code";
        exit;
    }
}
/**
 * Enhanced template engine with Jinja-like syntax
 * Supports: {{variable}}, {{object.property}}, {{array.0}}, loops, conditionals
 */
function renderTemplate($text, $data = []) {
    if (empty($text)) return $text;
    
    // Process loops: {% for item in items %}...{% endfor %}
    $text = preg_replace_callback(
        '/\{%\s*for\s+(\w+)\s+in\s+([\w\.]+)\s*%\}(.*?)\{%\s*endfor\s*%\}/s',
        function($matches) use ($data) {
            $itemName = $matches[1];
            $arrayPath = $matches[2];
            $template = $matches[3];
            
            $items = getNestedValue($data, $arrayPath);
            if (!is_array($items)) return '';
            
            $output = '';
            foreach ($items as $index => $item) {
                $loopData = array_merge($data, [
                    $itemName => $item,
                    'loop' => ['index' => $index, 'first' => $index === 0, 'last' => $index === count($items) - 1]
                ]);
                $output .= renderTemplate($template, $loopData);
            }
            return $output;
        },
        $text
    );
    
    // Process conditionals: {% if condition %}...{% endif %}
    $text = preg_replace_callback(
        '/\{%\s*if\s+([\w\.]+)\s*%\}(.*?)(?:\{%\s*else\s*%\}(.*?))?\{%\s*endif\s*%\}/s',
        function($matches) use ($data) {
            $condition = $matches[1];
            $ifContent = $matches[2];
            $elseContent = $matches[3] ?? '';
            
            $value = getNestedValue($data, $condition);
            return $value ? renderTemplate($ifContent, $data) : renderTemplate($elseContent, $data);
        },
        $text
    );
    
    // Process variables: {{variable}} or {{object.property}}
    $text = preg_replace_callback(
        '/\{\{\s*([\w\.]+)\s*\}\}/',
        function($matches) use ($data) {
            $key = $matches[1];
            $value = getNestedValue($data, $key);
            return $value !== null ? (is_array($value) ? json_encode($value) : $value) : '';
        },
        $text
    );
    
    return $text;
}

/**
 * Get nested value from array using dot notation
 */
function getNestedValue($array, $key, $default = null) {
    if (strpos($key, '.') === false) {
        return $array[$key] ?? $default;
    }
    
    $keys = explode('.', $key);
    $value = $array;
    
    foreach ($keys as $k) {
        if (is_array($value) && isset($value[$k])) {
            $value = $value[$k];
        } else {
            return $default;
        }
    }
    
    return $value;
}

/**
 * Legacy function - kept for backwards compatibility
 */
function replacePlaceholders($text, $page, $seo) {
    $lang = getCurrentLanguage();
    
    // Build comprehensive data array
    $data = [
        'page' => [
            'title' => $page["title_$lang"] ?? '',
            'slug' => $page['slug'] ?? '',
            'content' => $page["content_$lang"] ?? '',
        ],
        'global' => [
            'phone' => $seo['phone'] ?? '',
            'email' => $seo['email'] ?? '',
            'address' => $seo["address_$lang"] ?? '',
            'working_hours' => $seo["working_hours_$lang"] ?? '',
            'site_name' => $seo["site_name_$lang"] ?? '',
        ],
        'seo' => $seo,
        'lang' => $lang,
        'date' => [
            'year' => date('Y'),
            'month' => date('n'),
            'day' => date('j'),
        ]
    ];
    
    return renderTemplate($text, $data);
}

function trackVisit($slug, $language) {
    try {
        $db = Database::getInstance();
        $date = date('Y-m-d');
        
        $sql = "INSERT INTO analytics (page_slug, language, visits, clicks, date) 
                VALUES (?, ?, 1, 0, ?) 
                ON DUPLICATE KEY UPDATE visits = visits + 1";
        
        $db->query($sql, [$slug, $language, $date]);
        
        // Update monthly summary
        updateMonthlySummary($slug, $language);
    } catch (Exception $e) {
        error_log("Analytics error: " . $e->getMessage());
    }
}

function trackClick($slug, $language) {
    try {
        $db = Database::getInstance();
        $date = date('Y-m-d');
        
        $sql = "UPDATE analytics SET clicks = clicks + 1 
                WHERE page_slug = ? AND language = ? AND date = ?";
        
        $db->query($sql, [$slug, $language, $date]);
        
        updateMonthlySummary($slug, $language);
    } catch (Exception $e) {
        error_log("Click tracking error: " . $e->getMessage());
    }
}

/**
 * Track internal link navigation
 * Records when users click from one page to another
 */
function trackInternalLink($fromSlug, $toSlug, $language) {
    try {
        $db = Database::getInstance();
        $date = date('Y-m-d');
        
        $sql = "INSERT INTO analytics_internal_links (from_slug, to_slug, language, clicks, date) 
                VALUES (?, ?, ?, 1, ?) 
                ON DUPLICATE KEY UPDATE clicks = clicks + 1";
        
        $db->query($sql, [$fromSlug, $toSlug, $language, $date]);
        
        // Update monthly summary
        updateInternalLinkMonthlySummary($fromSlug, $toSlug, $language);
    } catch (Exception $e) {
        error_log("Internal link tracking error: " . $e->getMessage());
    }
}

function updateMonthlySummary($slug, $language) {
    try {
        $db = Database::getInstance();
        $year = date('Y');
        $month = date('n');
        
        $sql = "INSERT INTO analytics_monthly (page_slug, language, year, month, total_visits, total_clicks, unique_days)
                SELECT page_slug, language, YEAR(date), MONTH(date), 
                       SUM(visits), SUM(clicks), COUNT(DISTINCT date)
                FROM analytics
                WHERE page_slug = ? AND language = ? AND YEAR(date) = ? AND MONTH(date) = ?
                GROUP BY page_slug, language, YEAR(date), MONTH(date)
                ON DUPLICATE KEY UPDATE 
                    total_visits = VALUES(total_visits),
                    total_clicks = VALUES(total_clicks),
                    unique_days = VALUES(unique_days)";
        
        $db->query($sql, [$slug, $language, $year, $month]);
    } catch (Exception $e) {
        error_log("Monthly summary error: " . $e->getMessage());
    }
}

/**
 * Update monthly summary for internal link tracking
 */
function updateInternalLinkMonthlySummary($fromSlug, $toSlug, $language) {
    try {
        $db = Database::getInstance();
        $year = date('Y');
        $month = date('n');
        
        $sql = "INSERT INTO analytics_internal_links_monthly 
                (from_slug, to_slug, language, year, month, total_clicks, unique_days)
                SELECT from_slug, to_slug, language, YEAR(date), MONTH(date), 
                       SUM(clicks), COUNT(DISTINCT date)
                FROM analytics_internal_links
                WHERE from_slug = ? AND to_slug = ? AND language = ? 
                  AND YEAR(date) = ? AND MONTH(date) = ?
                GROUP BY from_slug, to_slug, language, YEAR(date), MONTH(date)
                ON DUPLICATE KEY UPDATE 
                    total_clicks = VALUES(total_clicks),
                    unique_days = VALUES(unique_days)";
        
        $db->query($sql, [$fromSlug, $toSlug, $language, $year, $month]);
    } catch (Exception $e) {
        error_log("Internal link monthly summary error: " . $e->getMessage());
    }
}

function getCurrentMonthContent($pageId, $lang) {
    $db = Database::getInstance();
    $currentMonth = date('n');
    
    $sql = "SELECT content_ru, content_uz FROM content_rotations 
            WHERE page_id = ? AND active_month = ? AND is_active = 1 
            LIMIT 1";
    
    $rotation = $db->fetchOne($sql, [$pageId, $currentMonth]);
    
    return $rotation ? $rotation["content_$lang"] : null;
}

function generateFAQSchema($faqs, $lang) {
    if (empty($faqs)) return '';
    
    $faqItems = [];
    foreach ($faqs as $faq) {
        $faqItems[] = [
            '@type' => 'Question',
            'name' => $faq["question_$lang"],
            'acceptedAnswer' => [
                '@type' => 'Answer',
                'text' => $faq["answer_$lang"]
            ]
        ];
    }
    
    $schema = [
        '@context' => 'https://schema.org',
        '@type' => 'FAQPage',
        'mainEntity' => $faqItems
    ];
    
    return json_encode($schema, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT);
}

================================================================================

# schema.sql
# path: .\database\schema.sql

-- phpMyAdmin SQL Dump
-- version 5.2.1
-- https://www.phpmyadmin.net/
--
-- Host: localhost:3306
-- Generation Time: Jan 01, 2026 at 09:32 PM
-- Server version: 10.3.39-MariaDB-log-cll-lve
-- PHP Version: 8.1.30

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `kuplyuta_db`
--

-- --------------------------------------------------------

--
-- Table structure for table `analytics`
--

CREATE TABLE `analytics` (
  `id` int(11) NOT NULL,
  `page_slug` varchar(100) DEFAULT NULL,
  `language` varchar(5) DEFAULT NULL,
  `visits` int(11) DEFAULT 0,
  `clicks` int(11) DEFAULT 0,
  `bounce_rate` decimal(5,2) DEFAULT 0.00,
  `avg_time_seconds` int(11) DEFAULT 0,
  `date` date NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `analytics_internal_links`
--

CREATE TABLE `analytics_internal_links` (
  `id` int(11) NOT NULL,
  `from_slug` varchar(100) NOT NULL,
  `to_slug` varchar(100) NOT NULL,
  `language` varchar(5) DEFAULT 'ru',
  `clicks` int(11) DEFAULT 1,
  `date` date NOT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `analytics_internal_links_monthly`
--

CREATE TABLE `analytics_internal_links_monthly` (
  `id` int(11) NOT NULL,
  `from_slug` varchar(100) NOT NULL,
  `to_slug` varchar(100) NOT NULL,
  `language` varchar(5) DEFAULT 'ru',
  `year` int(11) NOT NULL,
  `month` int(11) NOT NULL,
  `total_clicks` int(11) DEFAULT 0,
  `unique_days` int(11) DEFAULT 0
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `analytics_monthly`
--

CREATE TABLE `analytics_monthly` (
  `id` int(11) NOT NULL,
  `page_slug` varchar(100) DEFAULT NULL,
  `language` varchar(5) DEFAULT NULL,
  `year` int(11) NOT NULL,
  `month` int(11) NOT NULL,
  `total_visits` int(11) DEFAULT 0,
  `total_clicks` int(11) DEFAULT 0,
  `avg_time_seconds` int(11) DEFAULT 0,
  `unique_days` int(11) DEFAULT 0
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `analytics_rotations`
--

CREATE TABLE `analytics_rotations` (
  `id` int(11) NOT NULL,
  `page_slug` varchar(100) NOT NULL,
  `year` int(11) NOT NULL,
  `rotation_month` int(11) NOT NULL,
  `language` varchar(5) DEFAULT 'ru',
  `times_shown` int(11) DEFAULT 1,
  `unique_days` int(11) DEFAULT 1,
  `last_shown` date NOT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `content_rotations`
--

CREATE TABLE `content_rotations` (
  `id` int(11) NOT NULL,
  `page_id` int(11) NOT NULL,
  `content_ru` longtext DEFAULT NULL,
  `content_uz` longtext DEFAULT NULL,
  `meta_title_ru` varchar(200) DEFAULT NULL,
  `meta_title_uz` varchar(200) DEFAULT NULL,
  `meta_description_ru` text DEFAULT NULL,
  `meta_description_uz` text DEFAULT NULL,
  `meta_keywords_ru` text DEFAULT NULL,
  `meta_keywords_uz` text DEFAULT NULL,
  `og_title_ru` varchar(200) DEFAULT NULL,
  `og_title_uz` varchar(200) DEFAULT NULL,
  `og_description_ru` text DEFAULT NULL,
  `og_description_uz` text DEFAULT NULL,
  `og_image` varchar(500) DEFAULT NULL,
  `jsonld_ru` longtext DEFAULT NULL,
  `jsonld_uz` longtext DEFAULT NULL,
  `active_month` int(11) NOT NULL COMMENT '1-12 for Jan-Dec',
  `is_active` tinyint(1) DEFAULT 1,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `faqs`
--

CREATE TABLE `faqs` (
  `id` int(11) NOT NULL,
  `page_slug` varchar(100) NOT NULL,
  `question_ru` text NOT NULL,
  `question_uz` text NOT NULL,
  `answer_ru` text NOT NULL,
  `answer_uz` text NOT NULL,
  `sort_order` int(11) DEFAULT 0,
  `is_active` tinyint(1) DEFAULT 1,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `media`
--

CREATE TABLE `media` (
  `id` int(11) NOT NULL,
  `filename` varchar(255) NOT NULL,
  `original_name` varchar(255) NOT NULL,
  `file_size` int(11) NOT NULL,
  `mime_type` varchar(100) NOT NULL,
  `uploaded_at` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `pages`
--

CREATE TABLE `pages` (
  `id` int(11) NOT NULL,
  `slug` varchar(100) NOT NULL,
  `title_ru` varchar(200) NOT NULL,
  `title_uz` varchar(200) NOT NULL,
  `content_ru` longtext DEFAULT NULL,
  `content_uz` longtext DEFAULT NULL,
  `meta_title_ru` varchar(200) DEFAULT NULL,
  `meta_title_uz` varchar(200) DEFAULT NULL,
  `meta_keywords_ru` text DEFAULT NULL,
  `meta_keywords_uz` text DEFAULT NULL,
  `meta_description_ru` text DEFAULT NULL,
  `meta_description_uz` text DEFAULT NULL,
  `og_title_ru` varchar(200) DEFAULT NULL,
  `og_title_uz` varchar(200) DEFAULT NULL,
  `og_description_ru` text DEFAULT NULL,
  `og_description_uz` text DEFAULT NULL,
  `og_image` varchar(500) DEFAULT NULL,
  `canonical_url` varchar(500) DEFAULT NULL,
  `enable_rotation` tinyint(1) DEFAULT 0,
  `jsonld_ru` longtext DEFAULT NULL,
  `jsonld_uz` longtext DEFAULT NULL,
  `is_published` tinyint(1) DEFAULT 1,
  `sort_order` int(11) DEFAULT 0,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `seo_settings`
--

CREATE TABLE `seo_settings` (
  `id` int(11) NOT NULL,
  `site_name_ru` varchar(200) NOT NULL,
  `site_name_uz` varchar(200) NOT NULL,
  `meta_keywords_ru` text DEFAULT NULL,
  `meta_keywords_uz` text DEFAULT NULL,
  `meta_description_ru` text DEFAULT NULL,
  `meta_description_uz` text DEFAULT NULL,
  `phone` varchar(20) DEFAULT NULL,
  `email` varchar(100) DEFAULT NULL,
  `address_ru` text DEFAULT NULL,
  `address_uz` text DEFAULT NULL,
  `working_hours_ru` varchar(200) DEFAULT NULL,
  `working_hours_uz` varchar(200) DEFAULT NULL,
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `users`
--

CREATE TABLE `users` (
  `id` int(11) NOT NULL,
  `username` varchar(50) NOT NULL,
  `password` varchar(255) NOT NULL,
  `email` varchar(100) NOT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Stand-in structure for view `v_crawl_frequency`
-- (See below for the actual view)
--
CREATE TABLE `v_crawl_frequency` (
`page_slug` varchar(100)
,`total_days_tracked` bigint(21)
,`total_visits` decimal(32,0)
,`avg_daily_visits` decimal(14,4)
,`last_crawl_date` date
,`days_since_last_crawl` int(7)
,`crawl_frequency_category` varchar(7)
);

-- --------------------------------------------------------

--
-- Stand-in structure for view `v_navigation_flow`
-- (See below for the actual view)
--
CREATE TABLE `v_navigation_flow` (
`from_slug` varchar(100)
,`to_slug` varchar(100)
,`language` varchar(5)
,`total_clicks` decimal(32,0)
,`active_days` bigint(21)
,`last_click_date` date
,`days_since_last_click` int(7)
);

-- --------------------------------------------------------

--
-- Stand-in structure for view `v_popular_paths`
-- (See below for the actual view)
--
CREATE TABLE `v_popular_paths` (
`from_slug` varchar(100)
,`to_slug` varchar(100)
,`clicks` decimal(32,0)
,`active_months` bigint(21)
);

-- --------------------------------------------------------

--
-- Stand-in structure for view `v_rotation_effectiveness`
-- (See below for the actual view)
--
CREATE TABLE `v_rotation_effectiveness` (
`slug` varchar(100)
,`title_ru` varchar(200)
,`enable_rotation` tinyint(1)
,`months_with_content` bigint(21)
,`active_rotations` decimal(22,0)
,`total_times_shown` decimal(32,0)
,`last_rotation_shown` date
);

-- --------------------------------------------------------

--
-- Structure for view `v_crawl_frequency`
--
DROP TABLE IF EXISTS `v_crawl_frequency`;

CREATE ALGORITHM=UNDEFINED DEFINER=`kuplyuta`@`localhost` SQL SECURITY DEFINER VIEW `v_crawl_frequency`  AS SELECT `analytics`.`page_slug` AS `page_slug`, count(distinct `analytics`.`date`) AS `total_days_tracked`, sum(`analytics`.`visits`) AS `total_visits`, avg(`analytics`.`visits`) AS `avg_daily_visits`, max(`analytics`.`date`) AS `last_crawl_date`, to_days(curdate()) - to_days(max(`analytics`.`date`)) AS `days_since_last_crawl`, CASE WHEN to_days(curdate()) - to_days(max(`analytics`.`date`)) <= 1 THEN 'Daily' WHEN to_days(curdate()) - to_days(max(`analytics`.`date`)) <= 7 THEN 'Weekly' WHEN to_days(curdate()) - to_days(max(`analytics`.`date`)) <= 30 THEN 'Monthly' ELSE 'Rare' END AS `crawl_frequency_category` FROM `analytics` WHERE `analytics`.`date` >= curdate() - interval 90 day GROUP BY `analytics`.`page_slug` ;

-- --------------------------------------------------------

--
-- Structure for view `v_navigation_flow`
--
DROP TABLE IF EXISTS `v_navigation_flow`;

CREATE ALGORITHM=UNDEFINED DEFINER=`kuplyuta`@`localhost` SQL SECURITY DEFINER VIEW `v_navigation_flow`  AS SELECT `analytics_internal_links`.`from_slug` AS `from_slug`, `analytics_internal_links`.`to_slug` AS `to_slug`, `analytics_internal_links`.`language` AS `language`, sum(`analytics_internal_links`.`clicks`) AS `total_clicks`, count(distinct `analytics_internal_links`.`date`) AS `active_days`, max(`analytics_internal_links`.`date`) AS `last_click_date`, to_days(curdate()) - to_days(max(`analytics_internal_links`.`date`)) AS `days_since_last_click` FROM `analytics_internal_links` WHERE `analytics_internal_links`.`date` >= curdate() - interval 90 day GROUP BY `analytics_internal_links`.`from_slug`, `analytics_internal_links`.`to_slug`, `analytics_internal_links`.`language` ORDER BY sum(`analytics_internal_links`.`clicks`) DESC ;

-- --------------------------------------------------------

--
-- Structure for view `v_popular_paths`
--
DROP TABLE IF EXISTS `v_popular_paths`;

CREATE ALGORITHM=UNDEFINED DEFINER=`kuplyuta`@`localhost` SQL SECURITY DEFINER VIEW `v_popular_paths`  AS SELECT `analytics_internal_links_monthly`.`from_slug` AS `from_slug`, `analytics_internal_links_monthly`.`to_slug` AS `to_slug`, sum(`analytics_internal_links_monthly`.`total_clicks`) AS `clicks`, count(distinct concat(`analytics_internal_links_monthly`.`year`,'-',`analytics_internal_links_monthly`.`month`)) AS `active_months` FROM `analytics_internal_links_monthly` WHERE cast(concat(`analytics_internal_links_monthly`.`year`,'-',`analytics_internal_links_monthly`.`month`,'-01') as date) >= curdate() - interval 6 month GROUP BY `analytics_internal_links_monthly`.`from_slug`, `analytics_internal_links_monthly`.`to_slug` HAVING `clicks` > 5 ORDER BY sum(`analytics_internal_links_monthly`.`total_clicks`) DESC LIMIT 0, 50 ;

-- --------------------------------------------------------

--
-- Structure for view `v_rotation_effectiveness`
--
DROP TABLE IF EXISTS `v_rotation_effectiveness`;

CREATE ALGORITHM=UNDEFINED DEFINER=`kuplyuta`@`localhost` SQL SECURITY DEFINER VIEW `v_rotation_effectiveness`  AS SELECT `p`.`slug` AS `slug`, `p`.`title_ru` AS `title_ru`, `p`.`enable_rotation` AS `enable_rotation`, count(distinct `cr`.`active_month`) AS `months_with_content`, sum(case when `cr`.`is_active` = 1 then 1 else 0 end) AS `active_rotations`, coalesce(sum(`ar`.`times_shown`),0) AS `total_times_shown`, max(`ar`.`last_shown`) AS `last_rotation_shown` FROM ((`pages` `p` left join `content_rotations` `cr` on(`p`.`id` = `cr`.`page_id`)) left join `analytics_rotations` `ar` on(`p`.`slug` = `ar`.`page_slug`)) WHERE `p`.`enable_rotation` = 1 GROUP BY `p`.`id`, `p`.`slug`, `p`.`title_ru`, `p`.`enable_rotation` ;

--
-- Indexes for dumped tables
--

--
-- Indexes for table `analytics`
--
ALTER TABLE `analytics`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `unique_daily` (`page_slug`,`language`,`date`),
  ADD KEY `idx_analytics_date_slug` (`date`,`page_slug`);

--
-- Indexes for table `analytics_internal_links`
--
ALTER TABLE `analytics_internal_links`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `unique_daily_link` (`from_slug`,`to_slug`,`language`,`date`),
  ADD KEY `idx_from_slug` (`from_slug`),
  ADD KEY `idx_to_slug` (`to_slug`),
  ADD KEY `idx_date` (`date`);

--
-- Indexes for table `analytics_internal_links_monthly`
--
ALTER TABLE `analytics_internal_links_monthly`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `unique_monthly_link` (`from_slug`,`to_slug`,`language`,`year`,`month`),
  ADD KEY `idx_year_month` (`year`,`month`);

--
-- Indexes for table `analytics_monthly`
--
ALTER TABLE `analytics_monthly`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `unique_monthly` (`page_slug`,`language`,`year`,`month`),
  ADD KEY `idx_year_month` (`year`,`month`),
  ADD KEY `idx_analytics_monthly_date` (`year`,`month`);

--
-- Indexes for table `analytics_rotations`
--
ALTER TABLE `analytics_rotations`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `unique_rotation_tracking` (`page_slug`,`year`,`rotation_month`,`language`),
  ADD KEY `idx_page_date` (`page_slug`,`year`,`rotation_month`),
  ADD KEY `idx_last_shown` (`last_shown`);

--
-- Indexes for table `content_rotations`
--
ALTER TABLE `content_rotations`
  ADD PRIMARY KEY (`id`),
  ADD KEY `idx_page_month` (`page_id`,`active_month`),
  ADD KEY `idx_active` (`is_active`);

--
-- Indexes for table `faqs`
--
ALTER TABLE `faqs`
  ADD PRIMARY KEY (`id`),
  ADD KEY `idx_slug` (`page_slug`),
  ADD KEY `idx_active` (`is_active`);

--
-- Indexes for table `media`
--
ALTER TABLE `media`
  ADD PRIMARY KEY (`id`),
  ADD KEY `idx_filename` (`filename`);

--
-- Indexes for table `pages`
--
ALTER TABLE `pages`
  ADD PRIMARY KEY (`id`),
  ADD KEY `idx_slug` (`slug`),
  ADD KEY `idx_published` (`is_published`);

--
-- Indexes for table `seo_settings`
--
ALTER TABLE `seo_settings`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `users`
--
ALTER TABLE `users`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `username` (`username`),
  ADD UNIQUE KEY `email` (`email`);

--
-- AUTO_INCREMENT for dumped tables
--

--
-- AUTO_INCREMENT for table `analytics`
--
ALTER TABLE `analytics`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `analytics_internal_links`
--
ALTER TABLE `analytics_internal_links`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `analytics_internal_links_monthly`
--
ALTER TABLE `analytics_internal_links_monthly`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `analytics_monthly`
--
ALTER TABLE `analytics_monthly`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `analytics_rotations`
--
ALTER TABLE `analytics_rotations`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `content_rotations`
--
ALTER TABLE `content_rotations`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `faqs`
--
ALTER TABLE `faqs`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `media`
--
ALTER TABLE `media`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `pages`
--
ALTER TABLE `pages`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `seo_settings`
--
ALTER TABLE `seo_settings`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `users`
--
ALTER TABLE `users`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;

--
-- Constraints for dumped tables
--

--
-- Constraints for table `content_rotations`
--
ALTER TABLE `content_rotations`
  ADD CONSTRAINT `content_rotations_ibfk_1` FOREIGN KEY (`page_id`) REFERENCES `pages` (`id`) ON DELETE CASCADE;
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;

ALTER TABLE `content_rotations` 
ADD COLUMN `title_ru` VARCHAR(200) NULL AFTER `page_id`,
ADD COLUMN `title_uz` VARCHAR(200) NULL AFTER `title_ru`,
ADD COLUMN `description_ru` TEXT NULL AFTER `content_uz`,
ADD COLUMN `description_uz` TEXT NULL AFTER `description_ru`;

================================================================================

# Analytics.php
# path: .\models\Analytics.php

<?php
// path: ./models/Analytics.php

class Analytics {
    private $db;

    public function __construct() {
        $this->db = Database::getInstance();
    }

    public function getMonthlyData($months = 6) {
        $months = (int)$months;

        $sql = "SELECT year, month, SUM(total_visits) as visits, SUM(total_clicks) as clicks
                FROM analytics_monthly
                WHERE DATE(CONCAT(year, '-', month, '-01')) >= DATE_SUB(CURDATE(), INTERVAL $months MONTH)
                GROUP BY year, month
                ORDER BY year DESC, month DESC";

        return $this->db->fetchAll($sql);
    }

    public function getPageStats($months = 6) {
        $months = (int)$months;

        $sql = "SELECT page_slug, language, SUM(total_visits) as visits, SUM(total_clicks) as clicks
                FROM analytics_monthly
                WHERE DATE(CONCAT(year, '-', month, '-01')) >= DATE_SUB(CURDATE(), INTERVAL $months MONTH)
                GROUP BY page_slug, language
                ORDER BY visits DESC";

        return $this->db->fetchAll($sql);
    }

    public function getTotalStats() {
        $sql = "SELECT 
                    SUM(total_visits) as total_visits,
                    SUM(total_clicks) as total_clicks,
                    COUNT(DISTINCT page_slug) as unique_pages
                FROM analytics_monthly";
        
        return $this->db->fetchOne($sql);
    }

    public function getCurrentMonthStats() {
        $year = date('Y');
        $month = date('n');
        
        $sql = "SELECT 
                    SUM(total_visits) as visits,
                    SUM(total_clicks) as clicks
                FROM analytics_monthly
                WHERE year = ? AND month = ?";
        
        return $this->db->fetchOne($sql, [$year, $month]);
    }

    public function getChartData($type = 'visits', $months = 6) {
        $data = $this->getMonthlyData($months);
        
        $labels = [];
        $values = [];
        
        foreach (array_reverse($data) as $row) {
            $monthName = date('M Y', strtotime("{$row['year']}-{$row['month']}-01"));
            $labels[] = $monthName;
            $values[] = $row[$type] ?? 0;
        }
        
        return [
            'labels' => $labels,
            'values' => $values
        ];
    }

    /**
     * Get rotation effectiveness metrics
     * Shows which content variations are actually being shown
     */
    public function getRotationEffectiveness($months = 6) {
        $months = (int)$months;

        $sql = "SELECT 
                    ar.page_slug,
                    ar.rotation_month,
                    ar.times_shown,
                    ar.unique_days,
                    am.total_visits,
                    am.total_clicks,
                    p.title_ru
                FROM analytics_rotations ar
                LEFT JOIN analytics_monthly am ON 
                    ar.page_slug = am.page_slug AND 
                    ar.year = am.year AND 
                    ar.rotation_month = am.month
                LEFT JOIN pages p ON ar.page_slug = p.slug
                WHERE DATE(CONCAT(ar.year, '-', ar.rotation_month, '-01')) >= DATE_SUB(CURDATE(), INTERVAL $months MONTH)
                ORDER BY ar.year DESC, ar.rotation_month DESC, ar.times_shown DESC";

        return $this->db->fetchAll($sql);
    }

    /**
     * Get crawl frequency per slug
     */
    public function getCrawlFrequency($days = 30) {
        $days = (int)$days;

        $sql = "SELECT 
                    page_slug,
                    COUNT(DISTINCT date) as days_with_visits,
                    SUM(visits) as total_visits,
                    AVG(visits) as avg_visits_per_day,
                    MAX(date) as last_visit
                FROM analytics
                WHERE date >= DATE_SUB(CURDATE(), INTERVAL $days DAY)
                GROUP BY page_slug
                ORDER BY days_with_visits DESC, total_visits DESC";

        return $this->db->fetchAll($sql);
    }

    /**
     * Track which rotation was shown
     */
    public function trackRotationShown($slug, $rotationMonth, $language) {
        try {
            $year = date('Y');
            $date = date('Y-m-d');
            
            $sql = "INSERT INTO analytics_rotations 
                    (page_slug, year, rotation_month, language, times_shown, unique_days, last_shown) 
                    VALUES (?, ?, ?, ?, 1, 1, ?)
                    ON DUPLICATE KEY UPDATE 
                    times_shown = times_shown + 1,
                    unique_days = IF(DATE(last_shown) != DATE(?), unique_days + 1, unique_days),
                    last_shown = ?";
                            
            $this->db->query($sql, [$slug, $year, $rotationMonth, $language, $date, $slug, $year, $rotationMonth, $date]);
        } catch (Exception $e) {
            error_log("Rotation tracking error: " . $e->getMessage());
        }
    }

    /**
     * Get comparison between rotation and base content performance
     */
    public function getRotationComparison($pageSlug, $months = 3) {
        $months = (int)$months;

        $sql = "SELECT 
                    am.month,
                    am.year,
                    am.total_visits,
                    am.total_clicks,
                    ar.rotation_month,
                    ar.times_shown
                FROM analytics_monthly am
                LEFT JOIN analytics_rotations ar ON 
                    am.page_slug = ar.page_slug AND 
                    am.year = ar.year AND 
                    am.month = ar.rotation_month
                WHERE am.page_slug = ?
                  AND DATE(CONCAT(am.year, '-', am.month, '-01')) >= DATE_SUB(CURDATE(), INTERVAL $months MONTH)
                ORDER BY am.year DESC, am.month DESC";

        return $this->db->fetchAll($sql, [$pageSlug]);
    }


    /**
     * Get performance trends - compare periods
     */
    public function getPerformanceTrends($pageSlug = null) {
        $currentMonth = date('n');
        $currentYear = date('Y');
        $lastMonth = date('n', strtotime('-1 month'));
        $lastMonthYear = date('Y', strtotime('-1 month'));

        $paramsCurrent = [];
        $paramsPrevious = [];

        $whereCurrent = [];
        $wherePrevious = [];

        if ($pageSlug !== null) {
            $whereCurrent[] = "page_slug = ?";
            $wherePrevious[] = "page_slug = ?";
            $paramsCurrent[] = $pageSlug;
            $paramsPrevious[] = $pageSlug;
        }

        $whereCurrent[] = "year = ?";
        $whereCurrent[] = "month = ?";
        $paramsCurrent[] = $currentYear;
        $paramsCurrent[] = $currentMonth;

        $wherePrevious[] = "year = ?";
        $wherePrevious[] = "month = ?";
        $paramsPrevious[] = $lastMonthYear;
        $paramsPrevious[] = $lastMonth;

        $sql = "
            SELECT 'current' as period, SUM(total_visits) as visits, SUM(total_clicks) as clicks
            FROM analytics_monthly
            WHERE " . implode(' AND ', $whereCurrent) . "
            UNION ALL
            SELECT 'previous' as period, SUM(total_visits) as visits, SUM(total_clicks) as clicks
            FROM analytics_monthly
            WHERE " . implode(' AND ', $wherePrevious);

        $params = array_merge($paramsCurrent, $paramsPrevious);

        $results = $this->db->fetchAll($sql, $params);

        $current = ['visits' => 0, 'clicks' => 0];
        $previous = ['visits' => 0, 'clicks' => 0];

        foreach ($results as $row) {
            if ($row['period'] === 'current') {
                $current = $row;
            } else {
                $previous = $row;
            }
        }

        return [
            'current' => $current,
            'previous' => $previous,
            'changes' => [
                'visits' => $previous['visits'] > 0
                    ? round((($current['visits'] - $previous['visits']) / $previous['visits']) * 100, 1)
                    : 0,
                'clicks' => $previous['clicks'] > 0
                    ? round((($current['clicks'] - $previous['clicks']) / $previous['clicks']) * 100, 1)
                    : 0
            ]
        ];
    }

    /**
     * Get daily activity for heat map visualization
     */
    public function getDailyActivity($pageSlug = null, $days = 30) {
        $days = (int)$days;

        $conditions = ["date >= DATE_SUB(CURDATE(), INTERVAL $days DAY)"];
        $params = [];

        if ($pageSlug !== null) {
            $conditions[] = "page_slug = ?";
            $params[] = $pageSlug;
        }

        $sql = "SELECT 
                    date,
                    DAYOFWEEK(date) as day_of_week,
                    SUM(visits) as visits,
                    SUM(clicks) as clicks
                FROM analytics
                WHERE " . implode(' AND ', $conditions) . "
                GROUP BY date, day_of_week
                ORDER BY date DESC";

        return $this->db->fetchAll($sql, $params);
    }

    /**
     * Get top performing pages by conversion rate
     */
    public function getTopPerformers($months = 3, $limit = 10) {
        $sql = "SELECT 
                    page_slug,
                    SUM(total_visits) as visits,
                    SUM(total_clicks) as clicks,
                    ROUND((SUM(total_clicks) / NULLIF(SUM(total_visits), 0)) * 100, 2) as ctr,
                    COUNT(DISTINCT CONCAT(year, '-', month)) as active_months
                FROM analytics_monthly
                WHERE DATE(CONCAT(year, '-', month, '-01')) >= DATE_SUB(CURDATE(), INTERVAL ? MONTH)
                GROUP BY page_slug
                HAVING visits > 0
                ORDER BY ctr DESC, visits DESC
                LIMIT ?";
        
        return $this->db->fetchAll($sql, [$months, $limit]);
    }

    /**
     * Get language preference statistics
     */
    public function getLanguageStats($months = 3) {
        $sql = "SELECT 
                    language,
                    SUM(total_visits) as visits,
                    SUM(total_clicks) as clicks,
                    COUNT(DISTINCT page_slug) as unique_pages
                FROM analytics_monthly
                WHERE DATE(CONCAT(year, '-', month, '-01')) >= DATE_SUB(CURDATE(), INTERVAL ? MONTH)
                GROUP BY language";
        
        return $this->db->fetchAll($sql, [$months]);
    }

    public function getNavigationFlow($days = 30) {
        $sql = "SELECT 
                    from_slug,
                    to_slug,
                    language,
                    SUM(clicks) as total_clicks,
                    COUNT(DISTINCT date) as active_days,
                    MAX(date) as last_click_date
                FROM analytics_internal_links
                WHERE date >= DATE_SUB(CURDATE(), INTERVAL ? DAY)
                GROUP BY from_slug, to_slug, language
                HAVING total_clicks > 2
                ORDER BY total_clicks DESC
                LIMIT 100";
        
        return $this->db->fetchAll($sql, [$days]);
    }

    /**
     * Get most popular navigation paths
     */
    public function getPopularPaths($months = 3, $limit = 20) {
        $sql = "SELECT 
                    from_slug,
                    to_slug,
                    SUM(total_clicks) as clicks,
                    COUNT(DISTINCT CONCAT(year, '-', month)) as active_months
                FROM analytics_internal_links_monthly
                WHERE DATE(CONCAT(year, '-', month, '-01')) >= DATE_SUB(CURDATE(), INTERVAL ? MONTH)
                GROUP BY from_slug, to_slug
                ORDER BY clicks DESC
                LIMIT ?";
        
        return $this->db->fetchAll($sql, [$months, $limit]);
    }

    /**
     * Get outbound links from a specific page
     */
    public function getOutboundLinks($slug, $months = 3) {
        $sql = "SELECT 
                    to_slug,
                    language,
                    SUM(total_clicks) as clicks
                FROM analytics_internal_links_monthly
                WHERE from_slug = ?
                  AND DATE(CONCAT(year, '-', month, '-01')) >= DATE_SUB(CURDATE(), INTERVAL ? MONTH)
                GROUP BY to_slug, language
                ORDER BY clicks DESC";
        
        return $this->db->fetchAll($sql, [$slug, $months]);
    }


    public function getInboundLinks($slug, $months = 3) {
        $sql = "SELECT 
                    from_slug,
                    language,
                    SUM(total_clicks) as clicks
                FROM analytics_internal_links_monthly
                WHERE to_slug = ?
                  AND DATE(CONCAT(year, '-', month, '-01')) >= DATE_SUB(CURDATE(), INTERVAL ? MONTH)
                GROUP BY from_slug, language
                ORDER BY clicks DESC";
        
        return $this->db->fetchAll($sql, [$slug, $months]);
    }


    public function getLinkEffectiveness($months = 3) {
        $sql = "SELECT 
                    il.from_slug,
                    il.to_slug,
                    SUM(il.total_clicks) as link_clicks,
                    COALESCE(SUM(am.total_visits), 0) as from_page_visits,
                    CASE 
                        WHEN SUM(am.total_visits) > 0 
                        THEN ROUND((SUM(il.total_clicks) / SUM(am.total_visits)) * 100, 2)
                        ELSE 0 
                    END as click_through_rate
                FROM analytics_internal_links_monthly il
                LEFT JOIN analytics_monthly am ON 
                    il.from_slug = am.page_slug AND 
                    il.year = am.year AND 
                    il.month = am.month AND
                    il.language = am.language
                WHERE DATE(CONCAT(il.year, '-', il.month, '-01')) >= DATE_SUB(CURDATE(), INTERVAL ? MONTH)
                GROUP BY il.from_slug, il.to_slug
                HAVING link_clicks > 5
                ORDER BY click_through_rate DESC
                LIMIT 50";
        
        return $this->db->fetchAll($sql, [$months]);
    }


    public function getNavigationFunnels($months = 3) {
        // This gets sequential navigation patterns
        $sql = "SELECT 
                    l1.from_slug as step1,
                    l1.to_slug as step2,
                    l2.to_slug as step3,
                    COUNT(*) as occurrences
                FROM analytics_internal_links_monthly l1
                LEFT JOIN analytics_internal_links_monthly l2 ON 
                    l1.to_slug = l2.from_slug AND
                    l1.year = l2.year AND
                    l1.month = l2.month AND
                    l1.language = l2.language
                WHERE DATE(CONCAT(l1.year, '-', l1.month, '-01')) >= DATE_SUB(CURDATE(), INTERVAL ? MONTH)
                  AND l2.to_slug IS NOT NULL
                GROUP BY step1, step2, step3
                HAVING occurrences > 3
                ORDER BY occurrences DESC
                LIMIT 30";
        
        return $this->db->fetchAll($sql, [$months]);
    }
}
    

================================================================================

# ContentRotation.php
# path: .\models\ContentRotation.php

<?php
// path: ./models/ContentRotation.php
// Replace the entire file with this

class ContentRotation {
    private $db;

    public function __construct() {
        $this->db = Database::getInstance();
    }

    public function getByPageId($pageId) {
        $sql = "SELECT * FROM content_rotations WHERE page_id = ? ORDER BY active_month ASC";
        return $this->db->fetchAll($sql, [$pageId]);
    }

    public function getById($id) {
        $sql = "SELECT * FROM content_rotations WHERE id = ?";
        return $this->db->fetchOne($sql, [$id]);
    }

    public function getCurrentMonth($pageId) {
        $month = date('n');
        $sql = "SELECT * FROM content_rotations WHERE page_id = ? AND active_month = ? AND is_active = 1 LIMIT 1";
        return $this->db->fetchOne($sql, [$pageId, $month]);
    }

    public function createDefaultFromPage($pageId, $month) {
        require_once BASE_PATH . '/models/Page.php';
        $pageModel = new Page();
        $page = $pageModel->getById($pageId);
        
        if (!$page) {
            return false;
        }

        $data = [
            'page_id' => $pageId,
            'title_ru' => $page['title_ru'],
            'title_uz' => $page['title_uz'],
            'content_ru' => $page['content_ru'],
            'content_uz' => $page['content_uz'],
            'description_ru' => $page['meta_description_ru'],
            'description_uz' => $page['meta_description_uz'],
            'active_month' => $month,
            'is_active' => 1,
            'meta_title_ru' => $page['meta_title_ru'],
            'meta_title_uz' => $page['meta_title_uz'],
            'meta_description_ru' => $page['meta_description_ru'],
            'meta_description_uz' => $page['meta_description_uz'],
            'meta_keywords_ru' => $page['meta_keywords_ru'],
            'meta_keywords_uz' => $page['meta_keywords_uz'],
            'og_title_ru' => $page['og_title_ru'],
            'og_title_uz' => $page['og_title_uz'],
            'og_description_ru' => $page['og_description_ru'],
            'og_description_uz' => $page['og_description_uz'],
            'og_image' => $page['og_image'],
            'jsonld_ru' => $page['jsonld_ru'],
            'jsonld_uz' => $page['jsonld_uz']
        ];

        return $this->create($data);
    }

    public function getCoverageStats($pageId) {
        $rotations = $this->getByPageId($pageId);
        $coverage = array_fill(1, 12, false);
        $stats = [
            'total_months' => 12,
            'covered_months' => 0,
            'missing_months' => [],
            'active_months' => [],
            'inactive_months' => []
        ];
        
        foreach ($rotations as $r) {
            $coverage[$r['active_month']] = true;
            if ($r['is_active']) {
                $stats['active_months'][] = $r['active_month'];
            } else {
                $stats['inactive_months'][] = $r['active_month'];
            }
        }
        
        for ($i = 1; $i <= 12; $i++) {
            if ($coverage[$i]) {
                $stats['covered_months']++;
            } else {
                $stats['missing_months'][] = $i;
            }
        }
        
        return $stats;
    }

    public function monthHasContent($pageId, $month) {
        $sql = "SELECT COUNT(*) as count FROM content_rotations WHERE page_id = ? AND active_month = ?";
        $result = $this->db->fetchOne($sql, [$pageId, $month]);
        return $result['count'] > 0;
    }

    public function getPagesWithIncompleteRotation() {
        $sql = "SELECT p.id, p.slug, p.title_ru, p.title_uz, 
                COUNT(DISTINCT cr.active_month) as covered_months
                FROM pages p
                LEFT JOIN content_rotations cr ON p.id = cr.page_id
                WHERE p.enable_rotation = 1 AND p.is_published = 1
                GROUP BY p.id
                HAVING covered_months < 12
                ORDER BY covered_months ASC";
        return $this->db->fetchAll($sql);
    }

    public function cloneToMonth($sourceId, $targetMonth) {
        $source = $this->getById($sourceId);
        if (!$source) {
            return false;
        }

        if ($this->monthHasContent($source['page_id'], $targetMonth)) {
            return false;
        }

        $data = [
            'page_id' => $source['page_id'],
            'title_ru' => $source['title_ru'],
            'title_uz' => $source['title_uz'],
            'content_ru' => $source['content_ru'],
            'content_uz' => $source['content_uz'],
            'description_ru' => $source['description_ru'],
            'description_uz' => $source['description_uz'],
            'active_month' => $targetMonth,
            'is_active' => 1,
            'meta_title_ru' => $source['meta_title_ru'],
            'meta_title_uz' => $source['meta_title_uz'],
            'meta_description_ru' => $source['meta_description_ru'],
            'meta_description_uz' => $source['meta_description_uz'],
            'meta_keywords_ru' => $source['meta_keywords_ru'],
            'meta_keywords_uz' => $source['meta_keywords_uz'],
            'og_title_ru' => $source['og_title_ru'],
            'og_title_uz' => $source['og_title_uz'],
            'og_description_ru' => $source['og_description_ru'],
            'og_description_uz' => $source['og_description_uz'],
            'og_image' => $source['og_image'],
            'jsonld_ru' => $source['jsonld_ru'],
            'jsonld_uz' => $source['jsonld_uz']
        ];

        return $this->create($data);
    }

    public function bulkUpdateStatus($ids, $isActive) {
        if (empty($ids)) return false;
        
        $placeholders = implode(',', array_fill(0, count($ids), '?'));
        $sql = "UPDATE content_rotations SET is_active = ? WHERE id IN ($placeholders)";
        
        $params = array_merge([$isActive], $ids);
        return $this->db->query($sql, $params);
    }

    public function create($data) {
        $sql = "INSERT INTO content_rotations (
                    page_id, title_ru, title_uz, content_ru, content_uz, 
                    description_ru, description_uz, active_month, is_active,
                    meta_title_ru, meta_title_uz, meta_description_ru, meta_description_uz,
                    meta_keywords_ru, meta_keywords_uz, og_title_ru, og_title_uz,
                    og_description_ru, og_description_uz, og_image, jsonld_ru, jsonld_uz
                ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";
        
        $this->db->query($sql, [
            $data['page_id'],
            $data['title_ru'] ?? null,
            $data['title_uz'] ?? null,
            $data['content_ru'] ?? '',
            $data['content_uz'] ?? '',
            $data['description_ru'] ?? null,
            $data['description_uz'] ?? null,
            $data['active_month'],
            $data['is_active'] ?? 1,
            $data['meta_title_ru'] ?? null,
            $data['meta_title_uz'] ?? null,
            $data['meta_description_ru'] ?? null,
            $data['meta_description_uz'] ?? null,
            $data['meta_keywords_ru'] ?? null,
            $data['meta_keywords_uz'] ?? null,
            $data['og_title_ru'] ?? null,
            $data['og_title_uz'] ?? null,
            $data['og_description_ru'] ?? null,
            $data['og_description_uz'] ?? null,
            $data['og_image'] ?? null,
            $data['jsonld_ru'] ?? null,
            $data['jsonld_uz'] ?? null
        ]);
        
        return $this->db->lastInsertId();
    }

    public function update($id, $data) {
        $sql = "UPDATE content_rotations SET 
                title_ru = ?, title_uz = ?,
                content_ru = ?, content_uz = ?, 
                description_ru = ?, description_uz = ?,
                active_month = ?, is_active = ?,
                meta_title_ru = ?, meta_title_uz = ?,
                meta_description_ru = ?, meta_description_uz = ?,
                meta_keywords_ru = ?, meta_keywords_uz = ?,
                og_title_ru = ?, og_title_uz = ?,
                og_description_ru = ?, og_description_uz = ?,
                og_image = ?, jsonld_ru = ?, jsonld_uz = ?
                WHERE id = ?";
        
        return $this->db->query($sql, [
            $data['title_ru'] ?? null,
            $data['title_uz'] ?? null,
            $data['content_ru'] ?? '',
            $data['content_uz'] ?? '',
            $data['description_ru'] ?? null,
            $data['description_uz'] ?? null,
            $data['active_month'],
            $data['is_active'] ?? 1,
            $data['meta_title_ru'] ?? null,
            $data['meta_title_uz'] ?? null,
            $data['meta_description_ru'] ?? null,
            $data['meta_description_uz'] ?? null,
            $data['meta_keywords_ru'] ?? null,
            $data['meta_keywords_uz'] ?? null,
            $data['og_title_ru'] ?? null,
            $data['og_title_uz'] ?? null,
            $data['og_description_ru'] ?? null,
            $data['og_description_uz'] ?? null,
            $data['og_image'] ?? null,
            $data['jsonld_ru'] ?? null,
            $data['jsonld_uz'] ?? null,
            $id
        ]);
    }

    public function delete($id) {
        $sql = "DELETE FROM content_rotations WHERE id = ?";
        return $this->db->query($sql, [$id]);
    }

    public function bulkDelete($ids) {
        if (empty($ids)) return false;
        
        $placeholders = implode(',', array_fill(0, count($ids), '?'));
        $sql = "DELETE FROM content_rotations WHERE id IN ($placeholders)";
        return $this->db->query($sql, $ids);
    }

    public function getMonths() {
        return [
            1 => 'Январь / Yanvar',
            2 => 'Февраль / Fevral',
            3 => 'Март / Mart',
            4 => 'Апрель / Aprel',
            5 => 'Май / May',
            6 => 'Июнь / Iyun',
            7 => 'Июль / Iyul',
            8 => 'Август / Avgust',
            9 => 'Сентябрь / Sentyabr',
            10 => 'Октябрь / Oktyabr',
            11 => 'Ноябрь / Noyabr',
            12 => 'Декабрь / Dekabr'
        ];
    }

    public function getMonthNameRu($monthNum) {
        $months = [
            1 => 'Январь', 2 => 'Февраль', 3 => 'Март', 4 => 'Апрель',
            5 => 'Май', 6 => 'Июнь', 7 => 'Июль', 8 => 'Август',
            9 => 'Сентябрь', 10 => 'Октябрь', 11 => 'Ноябрь', 12 => 'Декабрь'
        ];
        return $months[$monthNum] ?? '';
    }
}

================================================================================

# FAQ.php
# path: .\models\FAQ.php

<?php
// path: ./models/FAQ.php

class FAQ {
    private $db;

    public function __construct() {
        $this->db = Database::getInstance();
    }

    public function getBySlug($slug) {
        $sql = "SELECT * FROM faqs WHERE page_slug = ? AND is_active = 1 ORDER BY sort_order ASC";
        return $this->db->fetchAll($sql, [$slug]);
    }

    public function getAll() {
        $sql = "SELECT * FROM faqs ORDER BY page_slug, sort_order ASC";
        return $this->db->fetchAll($sql);
    }

    public function getById($id) {
        $sql = "SELECT * FROM faqs WHERE id = ?";
        return $this->db->fetchOne($sql, [$id]);
    }

    public function create($data) {
        $sql = "INSERT INTO faqs (page_slug, question_ru, question_uz, answer_ru, answer_uz, sort_order, is_active) 
                VALUES (?, ?, ?, ?, ?, ?, ?)";
        
        $this->db->query($sql, [
            $data['page_slug'],
            $data['question_ru'],
            $data['question_uz'],
            $data['answer_ru'],
            $data['answer_uz'],
            $data['sort_order'] ?? 0,
            $data['is_active'] ?? 1
        ]);
        
        return $this->db->lastInsertId();
    }

    public function update($id, $data) {
        $sql = "UPDATE faqs SET page_slug = ?, question_ru = ?, question_uz = ?, 
                answer_ru = ?, answer_uz = ?, sort_order = ?, is_active = ? 
                WHERE id = ?";
        
        return $this->db->query($sql, [
            $data['page_slug'],
            $data['question_ru'],
            $data['question_uz'],
            $data['answer_ru'],
            $data['answer_uz'],
            $data['sort_order'] ?? 0,
            $data['is_active'] ?? 1,
            $id
        ]);
    }

    public function delete($id) {
        $sql = "DELETE FROM faqs WHERE id = ?";
        return $this->db->query($sql, [$id]);
    }

    public function getUniqueSlugs() {
        $sql = "SELECT DISTINCT page_slug FROM faqs ORDER BY page_slug";
        return $this->db->fetchAll($sql);
    }
}

================================================================================

# Media.php
# path: .\models\Media.php

<?php
class Media {
    private $db;

    public function __construct() {
        $this->db = Database::getInstance();
    }

    public function getAll() {
        $sql = "SELECT * FROM media ORDER BY uploaded_at DESC";
        return $this->db->fetchAll($sql);
    }

    public function create($data) {
        $sql = "INSERT INTO media (filename, original_name, file_size, mime_type) 
                VALUES (?, ?, ?, ?)";
        
        $this->db->query($sql, [
            $data['filename'],
            $data['original_name'],
            $data['file_size'],
            $data['mime_type']
        ]);
        
        return $this->db->lastInsertId();
    }

    public function delete($id) {
        $media = $this->db->fetchOne("SELECT * FROM media WHERE id = ?", [$id]);
        if ($media) {
            $filepath = UPLOAD_PATH . $media['filename'];
            if (file_exists($filepath)) {
                unlink($filepath);
            }
            $sql = "DELETE FROM media WHERE id = ?";
            return $this->db->query($sql, [$id]);
        }
        return false;
    }
}

================================================================================

# Page.php
# path: .\models\Page.php

<?php
// path: ./models/Page.php

class Page {
    private $db;

    public function __construct() {
        $this->db = Database::getInstance();
    }

    public function getBySlug($slug) {
        $sql = "SELECT * FROM pages WHERE slug = ? AND is_published = 1";
        return $this->db->fetchOne($sql, [$slug]);
    }

    public function getAll($includeUnpublished = false) {
        $sql = "SELECT * FROM pages";
        if (!$includeUnpublished) {
            $sql .= " WHERE is_published = 1";
        }
        $sql .= " ORDER BY sort_order ASC, id ASC";
        return $this->db->fetchAll($sql);
    }

    public function getById($id) {
        $sql = "SELECT * FROM pages WHERE id = ?";
        return $this->db->fetchOne($sql, [$id]);
    }

    public function create($data) {
        $sql = "INSERT INTO pages (
                    slug, title_ru, title_uz, content_ru, content_uz, 
                    meta_title_ru, meta_title_uz, meta_keywords_ru, meta_keywords_uz, 
                    meta_description_ru, meta_description_uz, 
                    og_title_ru, og_title_uz, og_description_ru, og_description_uz, og_image,
                    canonical_url, jsonld_ru, jsonld_uz, 
                    is_published, enable_rotation, sort_order
                ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";
        
        $this->db->query($sql, [
            $data['slug'],
            $data['title_ru'],
            $data['title_uz'],
            $data['content_ru'],
            $data['content_uz'],
            $data['meta_title_ru'] ?? null,
            $data['meta_title_uz'] ?? null,
            $data['meta_keywords_ru'] ?? null,
            $data['meta_keywords_uz'] ?? null,
            $data['meta_description_ru'] ?? null,
            $data['meta_description_uz'] ?? null,
            $data['og_title_ru'] ?? null,
            $data['og_title_uz'] ?? null,
            $data['og_description_ru'] ?? null,
            $data['og_description_uz'] ?? null,
            $data['og_image'] ?? null,
            $data['canonical_url'] ?? null,
            $data['jsonld_ru'] ?? null,
            $data['jsonld_uz'] ?? null,
            $data['is_published'] ?? 1,
            $data['enable_rotation'] ?? 0,
            $data['sort_order'] ?? 0
        ]);
        
        return $this->db->lastInsertId();
    }

    public function update($id, $data) {
        $sql = "UPDATE pages SET 
                    slug = ?, title_ru = ?, title_uz = ?, 
                    content_ru = ?, content_uz = ?, 
                    meta_title_ru = ?, meta_title_uz = ?, 
                    meta_keywords_ru = ?, meta_keywords_uz = ?, 
                    meta_description_ru = ?, meta_description_uz = ?, 
                    og_title_ru = ?, og_title_uz = ?, 
                    og_description_ru = ?, og_description_uz = ?, 
                    og_image = ?, canonical_url = ?,
                    jsonld_ru = ?, jsonld_uz = ?, 
                    is_published = ?, enable_rotation = ?, sort_order = ? 
                WHERE id = ?";
        
        return $this->db->query($sql, [
            $data['slug'],
            $data['title_ru'],
            $data['title_uz'],
            $data['content_ru'],
            $data['content_uz'],
            $data['meta_title_ru'] ?? null,
            $data['meta_title_uz'] ?? null,
            $data['meta_keywords_ru'] ?? null,
            $data['meta_keywords_uz'] ?? null,
            $data['meta_description_ru'] ?? null,
            $data['meta_description_uz'] ?? null,
            $data['og_title_ru'] ?? null,
            $data['og_title_uz'] ?? null,
            $data['og_description_ru'] ?? null,
            $data['og_description_uz'] ?? null,
            $data['og_image'] ?? null,
            $data['canonical_url'] ?? null,
            $data['jsonld_ru'] ?? null,
            $data['jsonld_uz'] ?? null,
            $data['is_published'] ?? 1,
            $data['enable_rotation'] ?? 0,
            $data['sort_order'] ?? 0,
            $id
        ]);
    }

    public function delete($id) {
        $sql = "DELETE FROM pages WHERE id = ?";
        return $this->db->query($sql, [$id]);
    }
}

================================================================================

# SEO.php
# path: .\models\SEO.php

<?php
class SEO {
    private $db;

    public function __construct() {
        $this->db = Database::getInstance();
    }

    public function getSettings() {
        $sql = "SELECT * FROM seo_settings ORDER BY id DESC LIMIT 1";
        return $this->db->fetchOne($sql);
    }

    public function updateSettings($data) {
        $sql = "UPDATE seo_settings SET 
                site_name_ru = ?, site_name_uz = ?,
                meta_keywords_ru = ?, meta_keywords_uz = ?,
                meta_description_ru = ?, meta_description_uz = ?,
                phone = ?, email = ?,
                address_ru = ?, address_uz = ?,
                working_hours_ru = ?, working_hours_uz = ?
                WHERE id = 1";
        
        return $this->db->query($sql, [
            $data['site_name_ru'],
            $data['site_name_uz'],
            $data['meta_keywords_ru'],
            $data['meta_keywords_uz'],
            $data['meta_description_ru'],
            $data['meta_description_uz'],
            $data['phone'],
            $data['email'],
            $data['address_ru'],
            $data['address_uz'],
            $data['working_hours_ru'],
            $data['working_hours_uz']
        ]);
    }
}

================================================================================

# User.php
# path: .\models\User.php

<?php
class User {
    private $db;

    public function __construct() {
        $this->db = Database::getInstance();
    }

    public function authenticate($username, $password) {
        $sql = "SELECT * FROM users WHERE username = ?";
        $user = $this->db->fetchOne($sql, [$username]);

        if ($user && password_verify($password, $user['password'])) {
            return $user;
        }
        return false;
    }

}

================================================================================

# .htaccess
# path: .\public\.htaccess

# path: ./public/.htaccess
# Production-Ready Security Configuration

# ========================================
# REWRITE ENGINE
# ========================================
RewriteEngine On

# ========================================
# SECURITY HEADERS
# ========================================
<IfModule mod_headers.c>
    # Prevent clickjacking
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # Prevent MIME type sniffing
    Header always set X-Content-Type-Options "nosniff"
    
    # Enable XSS protection
    Header always set X-XSS-Protection "1; mode=block"
    
    # Referrer policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # HTTPS enforcement (if using HTTPS)
    # Uncomment after enabling SSL:
    # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    
    # Content Security Policy (adjust as needed)
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://unpkg.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:;"
    
    # Remove server signature
    Header always unset X-Powered-By
    Header always unset Server
</IfModule>

# ========================================
# FORCE HTTPS (Uncomment after SSL setup)
# ========================================
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

# ========================================
# REDIRECT WWW TO NON-WWW (or vice versa)
# ========================================
# Redirect www to non-www (uncomment if needed):
# RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
# RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# ========================================
# REMOVE TRAILING SLASH
# ========================================
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} (.+)/$
RewriteRule ^ %1 [R=301,L]

# ========================================
# BLOCK ACCESS TO SENSITIVE FILES
# ========================================
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

<FilesMatch "\.(env|log|sql|md|json|yml|yaml|ini|bak|backup|old|orig|save|swp|swo|DS_Store)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Block access to specific files
<Files ~ "^(composer\.json|composer\.lock|package\.json|README\.md|\.gitignore)$">
    Order allow,deny
    Deny from all
</Files>

# ========================================
# BLOCK ACCESS TO CONFIG DIRECTORY
# ========================================
RewriteRule ^config/ - [F,L]
RewriteRule ^logs/ - [F,L]
RewriteRule ^database/ - [F,L]

# ========================================
# BLOCK BAD BOTS AND SCRAPERS
# ========================================
<IfModule mod_rewrite.c>
    RewriteCond %{HTTP_USER_AGENT} ^.*(curl|wget|python|bot|scraper|crawler|spider|parser).*$ [NC]
    RewriteCond %{REQUEST_URI} !^/robots\.txt$ [NC]
    RewriteRule ^.*$ - [F,L]
</IfModule>

# ========================================
# PREVENT DIRECTORY LISTING
# ========================================
Options -Indexes

# ========================================
# PROTECT AGAINST SQL INJECTION
# ========================================
<IfModule mod_rewrite.c>
    RewriteCond %{QUERY_STRING} (\<|%3C).*script.*(\>|%3E) [NC,OR]
    RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
    RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2}) [OR]
    RewriteCond %{QUERY_STRING} (\\|\.\./|\.\.\\) [OR]
    RewriteCond %{QUERY_STRING} (union|select|insert|drop|update|delete|cast|create|table|from|where) [NC]
    RewriteRule ^(.*)$ - [F,L]
</IfModule>

# ========================================
# BROWSER CACHING
# ========================================
<IfModule mod_expires.c>
    ExpiresActive On
    
    # Images
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
    
    # CSS and JavaScript
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/x-javascript "access plus 1 month"
    
    # Fonts
    ExpiresByType font/ttf "access plus 1 year"
    ExpiresByType font/otf "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType application/font-woff "access plus 1 year"
    
    # HTML and XML
    ExpiresByType text/html "access plus 1 hour"
    ExpiresByType text/xml "access plus 1 hour"
    ExpiresByType application/xml "access plus 1 hour"
</IfModule>

# ========================================
# GZIP COMPRESSION
# ========================================
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# ========================================
# PREVENT IMAGE HOTLINKING
# ========================================
<IfModule mod_rewrite.c>
    RewriteCond %{HTTP_REFERER} !^$
    RewriteCond %{HTTP_REFERER} !^https?://(www\.)?kuplyu-tashkent\.uz [NC]
    RewriteCond %{HTTP_REFERER} !^https?://(www\.)?test\.kuplyu-tashkent\.uz [NC]
    RewriteCond %{REQUEST_URI} \.(jpg|jpeg|png|gif|webp)$ [NC]
    RewriteRule ^.*$ - [F,L]
</IfModule>

# ========================================
# SERVE EXISTING FILES/DIRECTORIES NORMALLY
# ========================================
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# ========================================
# ROUTE EVERYTHING ELSE TO INDEX.PHP
# ========================================
RewriteRule ^ index.php [QSA,L]

# ========================================
# FILE SIZE LIMITS (adjust as needed)
# ========================================
<IfModule mod_php7.c>
    php_value upload_max_filesize 5M
    php_value post_max_size 10M
    php_value max_execution_time 300
    php_value max_input_time 300
</IfModule>

# ========================================
# ERROR PAGES (create these pages)
# ========================================
ErrorDocument 400 /error.php?code=400
ErrorDocument 401 /error.php?code=401
ErrorDocument 403 /error.php?code=403
ErrorDocument 404 /error.php?code=404
ErrorDocument 500 /error.php?code=500

# ========================================
# DISABLE SERVER SIGNATURE
# ========================================
ServerSignature Off

# ========================================
# CHARSET
# ========================================
AddDefaultCharset UTF-8

================================================================================

# deploy.php
# path: .\public\deploy.php

<?php
// path: ./views/admin/deploy.php

session_start();
require_once __DIR__ . '/../config/init.php';

define('REPO_PATH', '/home/kuplyuta/appliances');
define('GITHUB_REPO_NAME', 'seowebsite');
define('DEPLOY_FILE', REPO_PATH.'/deploy.json');

// Ensure deploy.json exists
if(!file_exists(DEPLOY_FILE)){
    file_put_contents(DEPLOY_FILE, json_encode(['queue'=>[], 'deployOutput'=>'']));
}

// --------------------
// Logging function
// --------------------
function logDeploy($msg){
    $logFile = REPO_PATH.'/deploy.log';
    $line = "[".date('Y-m-d H:i:s')."] ".$msg.PHP_EOL;
    file_put_contents($logFile, $line, FILE_APPEND | LOCK_EX);
}

// Load deploy queue
$deployData = json_decode(file_get_contents(DEPLOY_FILE), true);
$queue = $deployData['queue'] ?? [];
$deployOutput = $deployData['deployOutput'] ?? '';

// --------------------
// Handle GitHub Webhook
// --------------------
$isWebhook = !empty($_SERVER['HTTP_X_GITHUB_EVENT']);
if($isWebhook && $_SERVER['REQUEST_METHOD'] === 'POST'){
    $payload = file_get_contents('php://input');
    $data = json_decode($payload, true);
    if($data){
        $repoName = $data['repository']['name'] ?? '';
        $branch = $data['ref'] ?? '';
        if($repoName === GITHUB_REPO_NAME && $branch === 'refs/heads/master'){
            $commits = $data['commits'] ?? [];
            foreach($commits as $commit){
                $queue[] = [
                    'sha' => substr($commit['id'] ?? '', 0, 7),
                    'message' => $commit['message'] ?? '',
                    'timestamp' => $commit['timestamp'] ?? date('c'),
                    'deployed' => false
                ];
            }
            file_put_contents(DEPLOY_FILE, json_encode(['queue'=>$queue,'deployOutput'=>$deployOutput]));
            logDeploy("[WEBHOOK] Push received from {$repoName}");
        }
    }
    http_response_code(200);
    exit; // webhook returns OK
}

// --------------------
// Admin authentication
// --------------------
if(!$isWebhook && !isset($_SESSION['user_id'])){
    http_response_code(403);
    die('Access Denied. Please <a href="/admin/login">login</a> first.');
}

// CSRF token for manual deploy
if(!isset($_SESSION['deploy_csrf'])){
    $_SESSION['deploy_csrf'] = bin2hex(random_bytes(32));
}

// --------------------
// Manual deploy (approve latest push)
// --------------------
$manualDeployed = false;
$deployMessage = '';

if ($_SERVER['REQUEST_METHOD'] === 'POST' && ($_POST['csrf_token'] ?? '') === $_SESSION['deploy_csrf']) {
    // Find latest non-deployed push
    $latest = null;
    foreach ($queue as &$q) {
        if (!$q['deployed']) {
            $latest = &$q;
            break;
        }
    }

    if ($latest) {
        $commands = [
            'git reset --hard',
            'git clean -fd',
            'git pull origin master'
        ];
        $output = [];
        $exit = 0;
        foreach ($commands as $cmd) {
            $full = "cd ".REPO_PATH." && $cmd 2>&1";
            exec($full, $cmdOut, $cmdExit);
            $output[] = "$ $cmd";
            $output = array_merge($output, $cmdOut);
            if ($cmdExit !== 0) $exit = $cmdExit;
        }

        $deployOutput = implode("\n", $output);
        $deployMessage = $deployOutput;
        $manualDeployed = true;

        // mark deployed
        $latest['deployed'] = true;
        file_put_contents(DEPLOY_FILE, json_encode(['queue'=>$queue,'deployOutput'=>$deployOutput]));
        logDeploy("[MANUAL DEPLOY] ".$deployOutput);
    } else {
        $deployMessage = "No pending push to deploy.";
    }

    header('Location: deploy.php'); // optional: append ?deployed=1
    exit;
}

// --------------------
// AJAX JSON response
// --------------------
if(isset($_GET['ajax'])){
    header('Content-Type: application/json');
    echo json_encode([
        'queue' => $queue,
        'deployOutput' => $deployMessage,
        'hasPending' => count(array_filter($queue, fn($q)=>!$q['deployed']))>0
    ]);
    exit;
}

// --------------------
// Page layout
// --------------------
$pageName = 'deploy';
require BASE_PATH . '/views/admin/layout/header.php';
?>

<style>
.btn { margin-top:5px; display:inline-flex; align-items:center; gap:6px; }
.deploy-container { max-width:900px; margin:20px auto; }
.deploy-commits { background-color:#1e1e1e; color:#d4d4d4; font-family:monospace; font-size:14px; line-height:1.5; padding:16px; border-radius:6px; overflow-x:auto; max-height:400px; }
.deploy-commits ul { list-style:none; padding-left:0; margin:0; }
.deploy-commits li { padding:6px 0; border-bottom:1px solid rgba(255,255,255,0.05); }
.deploy-commits li:last-child { border-bottom:none; }
.deploy-commits li .sha { color:#569cd6; font-weight:bold; }
.deploy-commits li .message { color:#d4d4d4; }
.deploy-commits li.deployed { background-color:#2d2d2d; border-left:4px solid #6a9955; padding-left:12px; }
.deploy-commits li.pending { background-color:#2d2d2d; border-left:4px solid #ffcc00; padding-left:12px; }
.deploy-output { background:#222; color:#fff; padding:12px; border-radius:6px; margin-top:10px; white-space:pre-wrap; max-height:400px; overflow:auto; }
button:disabled { opacity:0.5; cursor:not-allowed; }
</style>

<div class="deploy-container">
    <h1><i data-feather="zap"></i> Git Deploy</h1>

    <div class="deploy-commits" id="deployQueue">
        <ul>
            <?php foreach($queue as $q): ?>
            <li class="<?= $q['deployed'] ? 'deployed' : 'pending' ?>">
                <span class="sha"><?= htmlspecialchars($q['sha']) ?></span> - 
                <span class="message"><?= htmlspecialchars($q['message']) ?></span>
            </li>
            <?php endforeach; ?>
        </ul>
    </div>

    <div class="deploy-output" id="deployOutput"><?= htmlspecialchars($deployMessage) ?></div>

    <form method="POST" id="deployForm">
        <input type="hidden" name="csrf_token" value="<?= htmlspecialchars($_SESSION['deploy_csrf']) ?>">
        <button id="deploy-btn" type="submit" class="btn btn-primary" disabled>
            <i data-feather="zap"></i> Deploy Latest Push
        </button>
    </form>
</div>

<script src="https://unpkg.com/feather-icons"></script>
<script>feather.replace();</script>

<script>
// --------------------
// Live AJAX update
// --------------------
async function refreshQueue(){
    const res = await fetch('deploy.php?ajax=1');
    const data = await res.json();

    // Update button
    const btn = document.getElementById('deploy-btn');
    btn.disabled = !data.hasPending;

    // Update push list
    const queueDiv = document.getElementById('deployQueue');
    queueDiv.innerHTML = '<ul>' + data.queue.map(q=>`
        <li class="${q.deployed ? 'deployed' : 'pending'}">
            <span class="sha">${q.sha}</span> - <span class="message">${q.message}</span>
        </li>`).join('') + '</ul>';

    // Update deploy output
    const outDiv = document.getElementById('deployOutput');
    outDiv.innerHTML = data.deployOutput;
}

// initial load + interval
refreshQueue();
setInterval(refreshQueue, 3000);

// handle manual deploy without page reload
document.getElementById('deployForm').addEventListener('submit', async e=>{
    e.preventDefault();
    const formData = new FormData(e.target);
    await fetch('deploy.php', {method:'POST', body:formData});
    refreshQueue();
});
</script>

<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>
 

================================================================================

# index.php
# path: .\public\index.php

<?php
require_once __DIR__ . '/../config/init.php';

require_once '../core/Database.php';
require_once '../core/Router.php';
require_once '../core/Controller.php';
require_once '../core/helpers.php';

$router = new Router();

/*
|--------------------------------------------------------------------------
| Public Routes
|--------------------------------------------------------------------------
*/
$router->get('/', function() {
    require_once BASE_PATH . '/controllers/PageController.php';
    $controller = new PageController();
    $controller->show('home');
});

$router->get('/{slug}', function($slug) {
    require_once BASE_PATH . '/controllers/PageController.php';
    setLanguage(DEFAULT_LANGUAGE); 
    $controller = new PageController();
    $controller->show($slug);
});

$router->get('/{slug}/{lang}', function($slug, $lang) {
    require_once BASE_PATH . '/controllers/PageController.php';
    $controller = new PageController();
    $controller->show($slug, $lang);
});

// Click / internal link tracking
$router->post('/track-click', function() {
    require_once BASE_PATH . '/controllers/PageController.php';
    $controller = new PageController();
    $controller->trackClick();
});

$router->post('/track-internal-link', function() {
    require_once BASE_PATH . '/controllers/PageController.php';
    $controller = new PageController();
    $controller->trackInternalLink();
});


/*
|--------------------------------------------------------------------------
| Admin Auth Routes
|--------------------------------------------------------------------------
*/
$router->get('/admin', function() {
    if (!empty($_SESSION['user_id'])) {
        header("Location: /admin/dashboard");
    } else {
        header("Location: /admin/login");
    }
    exit;
});

$router->get('/admin/login', function() {
    require_once BASE_PATH . '/controllers/admin/AuthController.php';
    $controller = new AuthController();
    $controller->showLogin();
});

$router->post('/admin/login', function() {
    require_once BASE_PATH . '/controllers/admin/AuthController.php';
    $controller = new AuthController();
    $controller->login();
});

$router->get('/admin/logout', function() {
    require_once BASE_PATH . '/controllers/admin/AuthController.php';
    $controller = new AuthController();
    $controller->logout();
});


/*
|--------------------------------------------------------------------------
| Admin Dashboard
|--------------------------------------------------------------------------
*/
$router->get('/admin/dashboard', function() {
    require_once BASE_PATH . '/controllers/admin/DashboardController.php';
    $controller = new DashboardController();
    $controller->index();
});


/*
|--------------------------------------------------------------------------
| Page Management (Admin)
|--------------------------------------------------------------------------
*/
$router->get('/admin/pages', fn() => requirePageAdmin('index'));
$router->get('/admin/pages/new', fn() => requirePageAdmin('edit'));
$router->get('/admin/pages/edit/{id}', fn($id) => requirePageAdmin('edit', $id));
$router->post('/admin/pages/save', fn() => requirePageAdmin('save'));
$router->post('/admin/pages/delete', fn() => requirePageAdmin('delete'));

/*
|--------------------------------------------------------------------------
| Rotation Management (Admin)
|--------------------------------------------------------------------------
*/
$router->get('/admin/rotations/manage/{pageId}', fn($pageId) => requireRotationAdmin('manage', $pageId));
$router->get('/admin/rotations/new/{pageId}', fn($pageId) => requireRotationAdmin('edit', null, $pageId));
$router->get('/admin/rotations/edit/{id}', fn($id) => requireRotationAdmin('edit', $id));
$router->post('/admin/rotations/save', fn() => requireRotationAdmin('save'));
$router->post('/admin/rotations/delete', fn() => requireRotationAdmin('delete'));
$router->get('/admin/rotations/overview', fn() => requireRotationAdmin('overview'));
$router->post('/admin/rotations/clone', fn() => requireRotationAdmin('clone'));
$router->post('/admin/rotations/bulk-action', fn() => requireRotationAdmin('bulkAction'));
$router->post('/admin/rotations/preview', fn() => requireRotationAdmin('preview'));
$router->post('/admin/rotations/bulk-upload', fn() => requireRotationAdmin('bulkUpload'));
$router->get('/admin/rotations/download-template', fn() => requireRotationAdmin('downloadTemplate'));

/*
|--------------------------------------------------------------------------
| FAQ Management (Admin)
|--------------------------------------------------------------------------
*/
$router->get('/admin/faqs', fn() => requireFAQAdmin('index'));
$router->get('/admin/faqs/new', fn() => requireFAQAdmin('edit'));
$router->get('/admin/faqs/edit/{id}', fn($id) => requireFAQAdmin('edit', $id));
$router->post('/admin/faqs/save', fn() => requireFAQAdmin('save'));
$router->post('/admin/faqs/delete', fn() => requireFAQAdmin('delete'));
$router->post('/admin/faqs/bulk-upload', fn() => requireFAQAdmin('bulkUpload'));
$router->get('/admin/faqs/download-template', fn() => requireFAQAdmin('downloadTemplate'));

/*
|--------------------------------------------------------------------------
| Media Management (Admin)
|--------------------------------------------------------------------------
*/
$router->get('/admin/media', fn() => requireMediaAdmin('index'));
$router->post('/admin/media/upload', fn() => requireMediaAdmin('upload'));
$router->post('/admin/media/delete', fn() => requireMediaAdmin('delete'));
$router->post('/admin/media/bulk-upload', fn() => requireMediaAdmin('bulkUpload'));

/*
|--------------------------------------------------------------------------
| Analytics (Admin)
|--------------------------------------------------------------------------
*/
$router->get('/admin/analytics', fn() => requireAnalytics('index'));
$router->get('/admin/analytics/rotation', fn() => requireAnalytics('rotationAnalytics'));
$router->get('/admin/analytics/crawl', fn() => requireAnalytics('crawlAnalysis'));
$router->get('/admin/analytics/page/{slug}', fn($slug) => requireAnalytics('pageDetail', $slug));
$router->get('/admin/analytics/export', fn() => requireAnalytics('export'));
$router->get('/admin/analytics/navigation', fn() => requireAnalytics('navigationAnalytics'));

/*
|--------------------------------------------------------------------------
| SEO (Admin)
|--------------------------------------------------------------------------
*/
$router->get('/admin/seo', fn() => requireSEO('index'));
$router->post('/admin/seo/save', fn() => requireSEO('save'));


/*
|--------------------------------------------------------------------------
| 404 Route
|--------------------------------------------------------------------------
*/

$router->notFound(function () {
    $router->error(404);
});


/*
|--------------------------------------------------------------------------
| Preview Routes (Admin Only)
|--------------------------------------------------------------------------
*/
$router->get('/admin/preview/{id}', function($id) {
    require_once BASE_PATH . '/controllers/admin/PreviewController.php';
    $controller = new PreviewController();
    $controller->show($id);
});

$router->get('/admin/preview/{id}/content', function($id) {
    require_once BASE_PATH . '/controllers/admin/PreviewController.php';
    $controller = new PreviewController();
    $controller->getPreviewContent($id);
});

/*
|--------------------------------------------------------------------------
| Sitemap & SEO Routes
|--------------------------------------------------------------------------
*/
$router->get('/sitemap.xml', function() {
    require_once BASE_PATH . '/controllers/SitemapController.php';
    $controller = new SitemapController();
    $controller->generateXML();
});

$router->get('/robots.txt', function() {
    require_once BASE_PATH . '/controllers/SitemapController.php';
    $controller = new SitemapController();
    $controller->generateRobotsTxt();
});

// Admin sitemap management
$router->get('/admin/seo/sitemap', function() {
    require_once BASE_PATH . '/controllers/SitemapController.php';
    $controller = new SitemapController();
    $controller->adminPanel();
});

$router->post('/admin/seo/sitemap/ping', function() {
    require_once BASE_PATH . '/controllers/SitemapController.php';
    $controller = new SitemapController();
    $controller->pingSearchEngines();
});

$router->dispatch();

/*
|--------------------------------------------------------------------------
| Helper functions for cleaner route callbacks
|--------------------------------------------------------------------------
*/
function requirePageAdmin($method, $id = null) {
    require_once BASE_PATH . '/controllers/admin/PageAdminController.php';
    $controller = new PageAdminController();
    $id !== null ? $controller->$method($id) : $controller->$method();
}

function requireRotationAdmin($method, $id = null, $pageId = null) {
    require_once BASE_PATH . '/controllers/admin/RotationAdminController.php';
    $controller = new RotationAdminController();
    if ($pageId !== null) $controller->$method($pageId);
    else if ($id !== null) $controller->$method($id);
    else $controller->$method();
}

function requireFAQAdmin($method, $id = null) {
    require_once BASE_PATH . '/controllers/admin/FAQAdminController.php';
    $controller = new FAQAdminController();
    $id !== null ? $controller->$method($id) : $controller->$method();
}

function requireMediaAdmin($method) {
    require_once BASE_PATH . '/controllers/admin/MediaController.php';
    $controller = new MediaController();
    $controller->$method();
}

function requireAnalytics($method, $arg = null) {
    require_once BASE_PATH . '/controllers/admin/AnalyticsController.php';
    $controller = new AnalyticsController();
    $arg !== null ? $controller->$method($arg) : $controller->$method();
}

function requireSEO($method) {
    require_once BASE_PATH . '/controllers/admin/SEOController.php';
    $controller = new SEOController();
    $controller->$method();
}


================================================================================

# admin.css
# path: .\public\css\admin.css

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary-dark: #303034;
    --primary-light: #EDEBD7;
    --accent-dark: #3f3f44;
    --accent-light: #f5f3e5;
    --text-dark: #1a1a1c;
    --text-muted: #6b6b70;
    --success: #059669;
    --success-hover: #047857;
    --danger: #dc3545;
    --danger-hover: #c82333;
    --sidebar-width: 260px;
    --toggle-size: 20px;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    font-size: 14px;
    color: var(--text-dark);
    background: var(--accent-light);
}

.feather-icon {
    display: inline-block;
    vertical-align: middle;
    width: 18px;
    height: 18px;
    margin-right: 6px;
    stroke-width: 2;
    color: inherit;
}

.page-header .feather-icon,
.info-banner .feather-icon,
.analytics-tabs .feather-icon {
    width: 22px;
    height: 22px;
    margin-right: 8px;
}

.summary-card .card-icon .feather-icon,
.recommendation .rec-icon .feather-icon {
    display: block;        /* block to allow centering */
    margin: 0 auto 10px;   /* center horizontally and add bottom spacing */
    width: 36px;
    height: 36px;
    stroke-width: 2.5;
}

.action-buttons .feather-icon,
.data-table .feather-icon,
.bulk-actions-bar .feather-icon {
    width: 16px;
    height: 16px;
    margin-right: 4px;
    vertical-align: text-bottom;
}

.alert .feather-icon,
.recommendation .feather-icon {
    width: 20px;
    height: 20px;
    margin-right: 6px;
    vertical-align: middle;
}

.modal .feather-icon,
.rotation-actions .feather-icon {
    width: 20px;
    height: 20px;
    vertical-align: middle;
    margin-right: 6px;
}


.badge + .feather-icon,
.feather-icon + .badge {
    margin-left: 4px;
}


.feather-icon:hover {
    color: inherit;
}

.login-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    background: linear-gradient(135deg, var(--primary-dark) 0%, var(--accent-dark) 100%);
}

.login-box {
    background: white;
    padding: 40px;
    border-radius: 8px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    width: 100%;
    max-width: 400px;
}

.login-box h2 {
    margin-bottom: 30px;
    text-align: center;
    color: var(--text-dark);
}

.admin-wrapper {
    display: flex;
    min-height: 100vh;
}

.sidebar {
    top: 0;
    left: 0;
    width: var(--sidebar-width, 260px);
    background: var(--primary-dark);
    color: var(--primary-light);
    position: fixed;
    height: 100vh;
    overflow-y: auto;
    overflow-x: visible; 
    transform: translateX(0);
    transition: transform 0.3s ease;
    z-index: 1000;
    display: flex;
    flex-direction: column;
}


.sidebar::-webkit-scrollbar {
    width: 6px;
}
.sidebar::-webkit-scrollbar-track {
    background: var(--primary-dark);  /* track matches sidebar background */
}

.sidebar::-webkit-scrollbar-thumb {
    background: var(--accent-dark);  /* thumb slightly lighter/darker */
    border-radius: 3px;              /* rounded edges */
}

.sidebar::-webkit-scrollbar-thumb:hover {
    background: var(--accent-light); /* subtle hover effect */
}

/* Firefox */
.sidebar {
    scrollbar-width: thin;                 /* thin scrollbar */
    scrollbar-color: var(--accent-dark) var(--primary-dark); /* thumb color | track color */
}

.sidebar-toggle {
    position: absolute;
    top: 50%;
    left: var(--sidebar-width);
    transform: translateY(-50%);
    width: 20px;
    height: 60px;
    background: var(--primary-dark);
    color: var(--primary-light);
    border: none;
    border-radius: 0 8px 8px 0;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 1001; 
    transition: all 0.3s ease;
    box-shadow: 2px 0 8px rgba(0,0,0,0.2);
}

.sidebar-toggle::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--accent-dark);
}


.sidebar-toggle:active {
    width: 18px;
}

.sidebar-toggle svg {
    width: 16px;
    height: 16px;
    stroke-width: 2.5;
    transition: transform 0.3s ease;
}


.admin-wrapper:not(.sidebar-collapsed) .sidebar-toggle svg {
    transform: rotate(0deg);
}
.admin-wrapper.sidebar-collapsed .sidebar-toggle svg {
    transform: rotate(180deg);
}

.admin-wrapper.sidebar-collapsed .sidebar-toggle {
    right: auto;
    left: 0;
    border-radius: 0 8px 8px 0;
}

.admin-wrapper.sidebar-collapsed .sidebar {
    transform: translateX(calc(-1 * var(--sidebar-width)));
}

.admin-wrapper.sidebar-collapsed .admin-main {
    margin-left: 0;
}

@keyframes pulse-glow {
    0%, 100% {
        box-shadow: 2px 0 8px rgba(0,0,0,0.2);
    }
    50% {
        box-shadow: 2px 0 16px rgba(237, 235, 215, 0.3);
    }
}

.admin-wrapper.sidebar-collapsed .sidebar-toggle {
    animation: pulse-glow 3s ease-in-out infinite;
}

.sidebar-toggle:hover {
    animation: none !important;
}

/* Mobile responsive */
@media (max-width: 768px) {
    .sidebar-toggle {
        right: -24px;
        width: 24px;
        height: 48px;
        z-index: 1002; 
    }
    
    .admin-wrapper.sidebar-collapsed .sidebar-toggle {
        left: 0;
    }
}



  

.logo {
    padding: 20px;
    background: var(--accent-dark);
    text-align: center;
}

.logo h2 {
    font-size: 18px;
    color: var(--primary-light);
}

.admin-nav {
    padding: 20px 0;
}

.admin-nav a {
    display: block;
    padding: 12px 20px;
    color: var(--primary-light);
    text-decoration: none;
    transition: background 0.2s;
}

.admin-nav a:hover {
    background: var(--accent-dark);
}

.admin-main {
    flex: 1;
    margin-left: var(--sidebar-width);
    padding: 30px;
    transition: margin-left 0.3s ease;
}


.admin-content {
    max-width: 1400px;
}

/* Alerts */
.alert {
    padding: 12px 20px;
    margin-bottom: 20px;
    border-radius: 4px;
    border-left: 4px solid;
}

.alert-success {
    background: #d1f4e0;
    border-color: var(--success);
    color: #0d5132;
}

.alert-error {
    background: #f8d7da;
    border-color: var(--danger);
    color: #721c24;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
    color: var(--text-dark);
}

.form-group input[type="text"],
.form-group input[type="email"],
.form-group input[type="password"],
.form-group input[type="number"],
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid var(--primary-light);
    border-radius: 4px;
    font-size: 14px;
    background: white;
    color: var(--text-dark);
}

.form-group input[type="text"]:focus,
.form-group input[type="email"]:focus,
.form-group input[type="password"]:focus,
.form-group input[type="number"]:focus,
.form-group textarea:focus,
.form-group select:focus {
    outline: none;
    border-color: var(--primary-dark);
}

.form-group textarea {
    resize: vertical;
    font-family: inherit;
}

.form-group textarea.code {
    font-family: monospace;
    font-size: 12px;
    background: var(--accent-light);
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.form-section {
    background: white;
    padding: 20px;
    margin-bottom: 20px;
    border-radius: 4px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.form-section h3 {
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--primary-light);
    color: var(--text-dark);
}

.form-actions {
    margin-top: 30px;
}

.help-text {
    background: var(--accent-light);
    padding: 10px;
    border-left: 3px solid var(--primary-dark);
    margin-bottom: 20px;
    font-size: 13px;
    color: var(--text-muted);
}

/* Buttons */
.btn {
    display: inline-block;
    padding: 10px 20px;
    background: var(--text-muted);
    color: white;
    text-decoration: none;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.2s;
}

.btn:hover {
    background: var(--text-dark);
}

.btn-primary {
    background: var(--primary-dark);
}

.btn-primary:hover {
    background: var(--accent-dark);
}

.btn-secondary {
    background: var(--text-muted);
}

.btn-secondary:hover {
    background: var(--text-dark);
}

.btn-danger {
    background: var(--danger);
}

.btn-danger:hover {
    background: var(--danger-hover);
}

.btn-sm {
    padding: 5px 10px;
    font-size: 12px;
}

.btn-group {
    display: flex;
    gap: 10px;
}

/* Tables */
.data-table {
    width: 100%;
    background: white;
    border-collapse: collapse;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border-radius: 4px;
    overflow: hidden;
}

.data-table th,
.data-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid var(--primary-light);
}

.data-table th {
    background: var(--accent-light);
    font-weight: 600;
    color: var(--text-dark);
}

.data-table tbody tr:hover {
    background: var(--accent-light);
}

/* Badges */
.badge {
    display: inline-block;
    padding: 4px 8px;
    font-size: 12px;
    border-radius: 3px;
}

.badge-success {
    background: var(--success);
    color: white;
}

.badge-danger {
    background: var(--danger);
    color: white;
}

/* Page Header */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.page-header h1 {
    font-size: 28px;
    color: var(--text-dark);
}

/* Tabs */
.tabs {
    display: flex;
    gap: 5px;
    margin-bottom: 20px;
    border-bottom: 2px solid var(--primary-light);
}

.tab-btn {
    padding: 10px 20px;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 14px;
    color: var(--text-muted);
    border-bottom: 2px solid transparent;
    margin-bottom: -2px;
}

.tab-btn.active {
    color: var(--primary-dark);
    border-bottom-color: var(--primary-dark);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.admin-form {
    background: white;
    padding: 30px;
    border-radius: 4px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

/* Stats */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    padding: 30px;
    border-radius: 4px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.stat-card h3 {
    font-size: 14px;
    color: var(--text-muted);
    margin-bottom: 10px;
}

.stat-number {
    font-size: 36px;
    font-weight: bold;
    color: var(--primary-dark);
}

/* Media Manager */
.media-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
}

.media-item {
    background: white;
    border-radius: 4px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.media-item img {
    width: 100%;
    height: 150px;
    object-fit: cover;
}

.media-info {
    padding: 10px;
}

.media-info p {
    font-size: 12px;
    margin-bottom: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--text-dark);
}

.media-meta {
    color: var(--text-muted);
    font-size: 11px;
}

.media-actions {
    display: flex;
    gap: 5px;
    margin-top: 10px;
}
.nav-section {
    margin: 15px 0;
}

.nav-section-title {
    padding: 8px 20px;
    font-size: 0.75em;
    font-weight: 600;
    text-transform: uppercase;
    color: rgba(237, 235, 215, 0.5);
    letter-spacing: 0.5px;
}

.admin-nav a.active {
    background: var(--accent-dark);
    border-left: 3px solid var(--primary-light);
}
/* ADD TO END OF admin.css - Mobile Responsive Improvements */

/* ===========================================
   MOBILE RESPONSIVE ADMIN PANEL
   =========================================== */

/* Tablets and below */
@media (max-width: 1024px) {
    :root {
        --sidebar-width: 240px;
    }
    
    /* Start collapsed on tablets */
    .admin-wrapper {
        /* Sidebar starts collapsed */
    }
    
    .admin-main {
        padding: 20px 15px;
    }
    
    /* Make tables scrollable */
    .data-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
    }
    
    /* Stack form rows */
    .form-row {
        grid-template-columns: 1fr;
    }
    
    /* Adjust stat cards */
    .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
}

/* Mobile devices */
@media (max-width: 768px) {
    :root {
        --sidebar-width: 280px;
        font-size: 14px;
    }
    
    /* Header adjustments */
    .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .page-header h1 {
        font-size: 1.5em;
    }
    
    .btn-group,
    .header-actions {
        width: 100%;
        flex-direction: column;
    }
    
    .btn-group .btn,
    .header-actions .btn,
    .btn-group select {
        width: 100%;
    }
    
    /* Form improvements */
    .form-group input,
    .form-group textarea,
    .form-group select {
        font-size: 16px; /* Prevent zoom on iOS */
    }
    
    /* Tables */
    .data-table th,
    .data-table td {
        padding: 10px 8px;
        font-size: 13px;
    }
    
    /* Hide less important columns on mobile */
    .data-table th:nth-child(3),
    .data-table td:nth-child(3) {
        display: none;
    }
    
    /* Action buttons stack */
    .action-buttons {
        flex-direction: column;
        width: 100%;
    }
    
    .action-buttons .btn {
        width: 100%;
    }
    
    /* Stats cards single column */
    .stats-grid,
    .trend-cards,
    .crawl-summary-cards {
        grid-template-columns: 1fr;
    }
    
    /* Tabs */
    .tabs {
        overflow-x: auto;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
    }
    
    .tab-btn {
        flex-shrink: 0;
    }
    
    /* Analytics specific */
    .chart-container {
        grid-template-columns: 1fr;
    }
    
    .performers-grid {
        grid-template-columns: 1fr;
    }
    
    .lang-cards {
        flex-direction: column;
    }
    
    /* Rotation specific */
    .rotation-timeline {
        grid-template-columns: 1fr;
    }
    
    .rotation-stats-bar {
        flex-direction: column;
        gap: 15px;
    }
    
    .bulk-actions-bar {
        flex-direction: column;
        align-items: stretch;
    }
    
    .bulk-buttons {
        flex-direction: column;
        width: 100%;
    }
    
    .bulk-buttons button {
        width: 100%;
    }
    
    /* Media manager */
    .media-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    }
    
    /* Modals */
    .modal-content {
        width: 95%;
        max-width: none;
        margin: 10px;
    }
    
    /* Navigation improvements */
    .admin-nav a {
        padding: 14px 20px;
        font-size: 15px;
    }
    
    .nav-section-title {
        padding: 10px 20px;
    }
    
    /* Login page */
    .login-box {
        margin: 20px;
        padding: 30px 20px;
    }
}

/* Small phones */
@media (max-width: 480px) {
    :root {
        font-size: 13px;
    }
    
    .admin-main {
        padding: 15px 10px;
    }
    
    .page-header h1 {
        font-size: 1.3em;
    }
    
    /* Make buttons more touch-friendly */
    .btn {
        padding: 12px 16px;
        font-size: 14px;
    }
    
    .btn-sm {
        padding: 8px 12px;
        font-size: 13px;
    }
    
    /* Data table compact mode */
    .data-table th,
    .data-table td {
        padding: 8px 6px;
        font-size: 12px;
    }
    
    /* Hide more columns */
    .data-table th:nth-child(4),
    .data-table td:nth-child(4) {
        display: none;
    }
    
    /* Form spacing */
    .form-group {
        margin-bottom: 15px;
    }
    
    /* Stat cards more compact */
    .stat-card {
        padding: 20px 15px;
    }
    
    .stat-number {
        font-size: 28px;
    }
    
    /* Media grid smaller */
    .media-grid {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 10px;
    }
    
    .media-item img {
        height: 120px;
    }
}

/* Touch improvements */
@media (hover: none) and (pointer: coarse) {
    /* Increase tap targets */
    .btn,
    a {
        min-height: 44px;
        display: inline-flex;
        align-items: center;
    }
    
    /* Remove hover effects on touch */
    .admin-nav a:hover {
        background: transparent;
    }
    
    .admin-nav a:active {
        background: var(--accent-dark);
    }
    
    /* Better checkbox/radio tap targets */
    input[type="checkbox"],
    input[type="radio"] {
        width: 20px;
        height: 20px;
    }
}

@media (max-height: 500px) and (orientation: landscape) {
    .sidebar {
        overflow-y: auto;
    }
    
    .logo {
        padding: 12px;
    }
    
    .admin-nav {
        padding: 10px 0;
    }
    
    .admin-nav a {
        padding: 10px 20px;
    }
}

@media print {
    .sidebar,
    .sidebar-toggle,
    .btn-group,
    .action-buttons,
    .admin-toolbar,
    .floating-call {
        display: none !important;
    }
    
    .admin-main {
        margin-left: 0;
        padding: 0;
    }
    
    .data-table {
        page-break-inside: avoid;
    }
}

@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

@media (prefers-contrast: high) {
    .btn,
    .badge,
    .alert {
        border: 2px solid currentColor;
    }
}

================================================================================

# pages.css
# path: .\public\css\pages.css

* { 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box; 
}

:root {
    --primary-dark: #303034;
    --primary-light: #EDEBD7;
    --accent-dark: #3f3f44;
    --accent-light: #f5f3e5;
    --text-dark: #1a1a1c;
    --text-muted: #6b6b70;
    --success: #059669;
    --success-hover: #047857;
}

body { 
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    line-height: 1.6; 
    color: var(--text-dark);
    background: var(--primary-light);
    font-size: 16px;
}

.container { 
    max-width: 1200px; 
    margin: 0 auto; 
    padding: 0 16px;
}

/* Header Styles */
header { 
    background: var(--primary-dark);
    padding: 10px 0;
    box-shadow: 0 2px 12px rgba(0,0,0,0.15);
    position: sticky;
    top: 0;
    z-index: 100;
}

nav { 
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
}

.logo-link {
    display: flex;
    align-items: center;
    text-decoration: none;
    flex-shrink: 0;
}

.logo {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    background: var(--primary-light);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    font-weight: bold;
    color: var(--primary-dark);
    flex-shrink: 0;
}

.site-name {
    margin-left: 10px;
    color: var(--primary-light);
    font-size: 1em;
    font-weight: 600;
    display: none;
}

.nav-links {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-left: auto;
}

.nav-links a { 
    color: var(--primary-light);
    text-decoration: none;
    font-weight: 500;
    transition: all 0.2s;
    font-size: 0.9em;
    padding: 6px 10px;
    border-radius: 6px;
    white-space: nowrap;
}

.nav-links a:hover { 
    background: var(--accent-dark);
    color: #fff;
}

.lang-switch { 
    display: flex;
    gap: 4px;
    align-items: center;
    background: var(--accent-dark);
    padding: 3px;
    border-radius: 6px;
    flex-shrink: 0;
}

.lang-switch a {
    padding: 5px 12px !important;
    border-radius: 4px;
    background: transparent;
    color: var(--primary-light);
    text-decoration: none;
    font-size: 0.8em;
    font-weight: 600;
    transition: all 0.2s;
}

.lang-switch a:hover,
.lang-switch a.active {
    background: var(--primary-light);
    color: var(--primary-dark);
}

/* Main Content */
main { 
    padding: 32px 0;
    min-height: 60vh;
    background: #fff;
}

main .container {
    max-width: 900px;
}

/* Content Typography */
main h1 {
    color: var(--text-dark);
    font-size: 1.75em;
    margin-bottom: 16px;
    line-height: 1.3;
}

main h2 {
    color: var(--text-dark);
    font-size: 1.4em;
    margin: 28px 0 12px;
}

main h3 {
    color: var(--text-dark);
    font-size: 1.15em;
    margin: 20px 0 10px;
}

main p {
    margin-bottom: 16px;
    color: var(--text-muted);
    font-size: 1em;
    line-height: 1.7;
}

main ul, main ol {
    margin: 16px 0 16px 20px;
    color: var(--text-muted);
}

main li {
    margin-bottom: 10px;
    line-height: 1.7;
}

main a {
    color: var(--primary-dark);
    text-decoration: none;
    border-bottom: 1px solid var(--primary-dark);
    transition: opacity 0.2s;
}

main a:hover {
    opacity: 0.7;
}

/* Footer Styles */
footer { 
    background: var(--primary-dark);
    color: var(--primary-light);
    padding: 32px 0 20px;
    margin-top: 40px;
}

footer .footer-content {
    display: grid;
    grid-template-columns: 1fr;
    gap: 24px;
    margin-bottom: 24px;
}

footer h3 {
    color: #fff;
    font-size: 1.1em;
    margin-bottom: 12px;
    font-weight: 600;
}

footer p {
    margin-bottom: 10px;
    line-height: 1.6;
    color: var(--primary-light);
    font-size: 0.95em;
}

footer a {
    color: var(--accent-light);
    text-decoration: none;
    transition: opacity 0.2s;
}

footer a:hover {
    opacity: 0.8;
}

.contact-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    margin-bottom: 10px;
}

.contact-item svg {
    width: 18px;
    height: 18px;
    flex-shrink: 0;
    color: var(--accent-light);
    margin-top: 2px;
}

.copyright {
    text-align: center;
    padding-top: 20px;
    border-top: 1px solid var(--accent-dark);
    color: rgba(237, 235, 215, 0.7);
    font-size: 0.85em;
}

/* Floating Call Button */
.floating-call {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--success);
    color: #fff;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 16px rgba(5, 150, 105, 0.4);
    text-decoration: none;
    transition: all 0.3s;
    z-index: 999;
    animation: pulse 2s infinite;
}

.floating-call:hover {
    transform: scale(1.1);
    background: var(--success-hover);
    box-shadow: 0 6px 20px rgba(5, 150, 105, 0.5);
}

.floating-call:active {
    transform: scale(0.95);
}

.floating-call svg {
    width: 26px;
    height: 26px;
}

@keyframes pulse {
    0%, 100% { 
        box-shadow: 0 4px 16px rgba(5, 150, 105, 0.4);
    }
    50% { 
        box-shadow: 0 4px 24px rgba(5, 150, 105, 0.6), 0 0 0 8px rgba(5, 150, 105, 0.1);
    }
}

/* Tablet Responsive (481px - 768px) */
@media (min-width: 481px) {
    .container {
        padding: 0 24px;
    }
    
    .site-name {
        display: inline;
    }
    
    .logo {
        width: 42px;
        height: 42px;
        font-size: 24px;
    }
    
    .nav-links {
        gap: 20px;
    }
    
    .nav-links a {
        font-size: 0.95em;
    }
    
    .lang-switch a {
        padding: 6px 14px !important;
        font-size: 0.85em;
    }
    
    main {
        padding: 40px 0;
    }
    
    main h1 {
        font-size: 2em;
    }
    
    main h2 {
        font-size: 1.6em;
    }
    
    footer .footer-content {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .floating-call {
        width: 60px;
        height: 60px;
        bottom: 24px;
        right: 24px;
    }
    
    .floating-call svg {
        width: 28px;
        height: 28px;
    }
}

/* Desktop Responsive (769px+) */
@media (min-width: 769px) {
    header {
        padding: 12px 0;
    }
    
    .logo {
        width: 46px;
        height: 46px;
        font-size: 26px;
    }
    
    .site-name {
        font-size: 1.15em;
        margin-left: 12px;
    }
    
    .nav-links {
        gap: 24px;
    }
    
    .nav-links a {
        font-size: 1em;
    }
    
    main {
        padding: 50px 0;
    }
    
    main h1 {
        font-size: 2.2em;
        margin-bottom: 20px;
    }
    
    main h2 {
        font-size: 1.7em;
        margin: 35px 0 15px;
    }
    
    main h3 {
        font-size: 1.3em;
    }
    
    main p {
        font-size: 1.05em;
        margin-bottom: 18px;
    }
    
    footer {
        padding: 40px 0 25px;
    }
    
    footer .footer-content {
        grid-template-columns: repeat(3, 1fr);
        gap: 30px;
    }
    
    .floating-call {
        width: 64px;
        height: 64px;
        bottom: 30px;
        right: 30px;
    }
    
    .floating-call svg {
        width: 30px;
        height: 30px;
    }
}

/* Extra small phones (max 360px) */
@media (max-width: 360px) {
    .logo {
        width: 34px;
        height: 34px;
        font-size: 20px;
    }
    
    .nav-links a {
        font-size: 0.85em;
        padding: 5px 8px;
    }
    
    .lang-switch a {
        padding: 4px 10px !important;
        font-size: 0.75em;
    }
    
    main h1 {
        font-size: 1.5em;
    }
    
    .floating-call {
        width: 52px;
        height: 52px;
        bottom: 16px;
        right: 16px;
    }
}

/* Landscape mobile optimization */
@media (max-height: 500px) and (orientation: landscape) {
    header {
        padding: 8px 0;
    }
    
    .logo {
        width: 36px;
        height: 36px;
        font-size: 20px;
    }
    
    nav {
        gap: 15px;
    }
    
    main {
        padding: 24px 0;
    }
}
.page-hero {
    padding: 32px 0;
    border-bottom: 1px solid #EDEBD7;
    margin-bottom: 32px;
}

.page-hero h1 {
    margin-bottom: 12px;
}

.page-hero p {
    font-size: 1.05em;
    max-width: 700px;
}

/* Info Grid (Feature Cards) */
.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin: 32px 0;
}

.info-card {
    padding: 24px;
    background: #f9f9f7;
    border: 1px solid #EDEBD7;
    border-radius: 6px;
}

.info-card h3 {
    margin-bottom: 10px;
    font-size: 1.1em;
}

.info-card p {
    margin: 0;
    font-size: 0.95em;
}

/* Content Sections */
.content-section {
    margin: 48px 0;
}

.content-section h2 {
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 1px solid #EDEBD7;
}

/* Brands List */
.brands-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 12px;
    margin-top: 20px;
}

.brands-list span {
    padding: 12px;
    background: #f9f9f7;
    border: 1px solid #EDEBD7;
    border-radius: 4px;
    text-align: center;
    font-size: 0.9em;
    color: var(--text-dark);
}

/* Condition Items */
.condition-item {
    margin-bottom: 24px;
    padding-bottom: 24px;
    border-bottom: 1px solid #EDEBD7;
}

.condition-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.condition-item h3 {
    margin-bottom: 8px;
    font-size: 1.05em;
}

.condition-item p {
    margin: 0;
}

/* Process Steps */
.process-step {
    margin-bottom: 24px;
    padding-left: 32px;
    position: relative;
}

.process-step:before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    width: 3px;
    height: 100%;
    background: #EDEBD7;
}

.process-step h3 {
    margin-bottom: 8px;
    font-size: 1.05em;
}

.process-step p {
    margin: 0;
}

/* FAQ Items */
.faq-item {
    margin-bottom: 28px;
}

.faq-item h3 {
    margin-bottom: 10px;
    font-size: 1.05em;
}

.faq-item p {
    margin: 0;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
    .page-hero {
        padding: 24px 0;
    }
    
    .info-grid {
        grid-template-columns: 1fr;
        gap: 16px;
    }
    
    .brands-list {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 10px;
    }
    
    .content-section {
        margin: 36px 0;
    }
}

@media (max-width: 480px) {
    .brands-list {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .process-step {
        padding-left: 20px;
    }
}

/* Add to existing pages.css */

/* FAQ Section */
.faq-section {
    margin-top: 60px;
    padding-top: 40px;
    border-top: 2px solid #EDEBD7;
}

.faq-section > h2 {
    font-size: 1.8em;
    margin-bottom: 30px;
    color: var(--text-dark);
    text-align: center;
}

.faq-list {
    max-width: 800px;
    margin: 0 auto;
}

.faq-item {
    background: #f9f9f7;
    border: 1px solid #EDEBD7;
    border-radius: 6px;
    padding: 24px;
    margin-bottom: 20px;
    transition: all 0.2s;
}

.faq-item:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    border-color: var(--primary-dark);
}

.faq-item h3 {
    font-size: 1.1em;
    margin-bottom: 12px;
    color: var(--primary-dark);
    font-weight: 600;
}

.faq-item p {
    margin: 0;
    line-height: 1.7;
}

@media (max-width: 768px) {
    .faq-section {
        margin-top: 40px;
        padding-top: 30px;
    }
    
    .faq-section > h2 {
        font-size: 1.5em;
        margin-bottom: 20px;
    }
    
    .faq-item {
        padding: 18px;
    }
    
    .faq-item h3 {
        font-size: 1.05em;
    }
}
/* IMPLEMENTATION: Add to public/css/pages.css */

/* ===========================================
   CONTENT IMAGES
   Auto-styling for images in content
   =========================================== */

main img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 24px auto;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.2s, box-shadow 0.2s;
}

main img:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* Image Size Classes (from Media Manager) */
main img.img-thumbnail {
    max-width: 300px;
}

main img.img-medium {
    max-width: 600px;
}

/* Full width images */
main img.img-full {
    max-width: 100%;
    width: 100%;
}

/* Float images for text wrapping */
main img.img-left {
    float: left;
    margin: 0 24px 16px 0;
    max-width: 400px;
}

main img.img-right {
    float: right;
    margin: 0 0 16px 24px;
    max-width: 400px;
}

/* Clear floats */
main .clear {
    clear: both;
}

/* Image captions */
main figure {
    margin: 24px 0;
    text-align: center;
}

main figure img {
    margin: 0 auto 12px;
}

main figcaption {
    font-size: 0.9em;
    color: var(--text-muted);
    font-style: italic;
    max-width: 600px;
    margin: 0 auto;
}

/* Image grid for multiple images */
.image-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 16px;
    margin: 32px 0;
}

.image-grid img {
    margin: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    aspect-ratio: 4/3;
}

/* Lightbox effect on click (optional) */
main img[data-lightbox] {
    cursor: zoom-in;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    main img.img-left,
    main img.img-right {
        float: none;
        margin: 16px auto;
        max-width: 100%;
    }
    
    .image-grid {
        grid-template-columns: 1fr;
    }
}

/* Gallery layout (horizontal scroll on mobile) */
.image-gallery {
    display: flex;
    gap: 16px;
    overflow-x: auto;
    padding: 16px 0;
    margin: 32px 0;
    -webkit-overflow-scrolling: touch;
}

.image-gallery img {
    flex-shrink: 0;
    width: 300px;
    height: 200px;
    object-fit: cover;
    margin: 0;
}

.image-gallery::-webkit-scrollbar {
    height: 8px;
}

.image-gallery::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.image-gallery::-webkit-scrollbar-thumb {
    background: var(--primary-dark);
    border-radius: 4px;
}

/* Hero images */
.hero-image {
    width: 100%;
    height: 400px;
    object-fit: cover;
    margin: 0 0 32px 0;
    border-radius: 12px;
}

@media (max-width: 768px) {
    .hero-image {
        height: 250px;
        border-radius: 8px;
    }
}

/* Image with text overlay */
.image-with-text {
    position: relative;
    margin: 32px 0;
}

.image-with-text img {
    width: 100%;
    margin: 0;
}

.image-with-text .overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
    color: white;
    padding: 24px;
    border-radius: 0 0 8px 8px;
}

.image-with-text .overlay h3 {
    margin: 0 0 8px 0;
    color: white;
}

/* Comparison slider (before/after) */
.image-compare {
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    margin: 32px auto;
    max-width: 800px;
}

/* Loading state for images */
main img[loading="lazy"] {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
}

@keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

/* Zoom on hover for clickable images */
main a img {
    transition: transform 0.3s ease;
}

main a:hover img {
    transform: scale(1.05);
}

================================================================================

# crawl.css
# path: .\public\css\admin\analytics\crawl.css

.crawl-summary-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.summary-card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    display: flex;
    gap: 15px;
    align-items: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    border-left: 4px solid;
}

.summary-card.daily {
    border-left-color: #059669;
}

.summary-card.weekly {
    border-left-color: #3b82f6;
}

.summary-card.monthly {
    border-left-color: #f59e0b;
}

.summary-card.rare {
    border-left-color: #dc3545;
}

.card-icon {
    font-size: 2em;
}

.card-content {
    flex: 1;
}

.card-number {
    font-size: 2em;
    font-weight: bold;
    color: var(--text-dark);
    line-height: 1;
}

.card-label {
    font-weight: 600;
    color: var(--text-dark);
    margin-top: 4px;
}

.card-desc {
    font-size: 0.85em;
    color: var(--text-muted);
}

.crawl-table-container {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    margin-bottom: 30px;
}

.crawl-table-container h2 {
    margin-bottom: 20px;
}

.crawl-table td {
    vertical-align: middle;
}

.days-ago {
    padding: 4px 8px;
    border-radius: 4px;
    background: var(--accent-light);
    font-size: 0.9em;
}

.days-ago.warning {
    background: #fef3c7;
    color: #92400e;
    font-weight: 600;
}

.status-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 0.85em;
    font-weight: 600;
}

.status-daily {
    background: #d1f4e0;
    color: #065f46;
}

.status-weekly {
    background: #dbeafe;
    color: #1e3a8a;
}

.status-monthly {
    background: #fef3c7;
    color: #92400e;
}

.status-rare {
    background: #f8d7da;
    color: #991b1b;
}

.action-buttons {
    display: flex;
    gap: 5px;
}

.recommendations-panel {
    background: white;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.recommendations-panel h2 {
    margin-bottom: 20px;
}

.recommendation {
    display: flex;
    gap: 20px;
    padding: 20px;
    border-radius: 6px;
    margin-bottom: 20px;
    border-left: 4px solid;
}

.recommendation.warning {
    background: #fef3c7;
    border-left-color: #f59e0b;
}

.recommendation.success {
    background: #d1f4e0;
    border-left-color: #059669;
}

.recommendation.info {
    background: #dbeafe;
    border-left-color: #3b82f6;
}

.rec-icon {
    font-size: 2em;
}

.rec-content {
    flex: 1;
}

.rec-content h3 {
    margin-bottom: 8px;
    font-size: 1.1em;
}

.rec-content p {
    margin-bottom: 8px;
    color: var(--text-muted);
}

.rec-content ul {
    margin: 10px 0;
    padding-left: 20px;
}

.rec-content li {
    margin-bottom: 8px;
    color: var(--text-muted);
}

@media (max-width: 768px) {
    .crawl-summary-cards {
        grid-template-columns: 1fr;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .recommendation {
        flex-direction: column;
        gap: 10px;
    }
}

================================================================================

# index.css
# path: .\public\css\admin\analytics\index.css

.header-actions {
    display: flex;
    gap: 10px;
}

.trend-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.trend-card {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.trend-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.trend-label {
    font-size: 0.9em;
    color: var(--text-muted);
}

.trend-change {
    font-size: 0.9em;
    font-weight: 600;
    padding: 4px 8px;
    border-radius: 4px;
}

.trend-change.positive {
    color: #059669;
    background: #d1f4e0;
}

.trend-change.negative {
    color: #dc3545;
    background: #f8d7da;
}

.trend-value {
    font-size: 2em;
    font-weight: bold;
    color: var(--text-dark);
    margin-bottom: 4px;
}

.trend-comparison {
    font-size: 0.85em;
    color: var(--text-muted);
}

.analytics-tabs {
    display: flex;
    gap: 5px;
    margin-bottom: 30px;
    border-bottom: 2px solid var(--accent-light);
}

.tab-link {
    padding: 12px 20px;
    text-decoration: none;
    color: var(--text-muted);
    border-bottom: 2px solid transparent;
    margin-bottom: -2px;
    transition: all 0.2s;
}

.tab-link:hover {
    color: var(--text-dark);
}

.tab-link.active {
    color: var(--primary-dark);
    border-bottom-color: var(--primary-dark);
}

.top-performers {
    margin-bottom: 40px;
}

.performers-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.performer-card {
    background: white;
    padding: 16px;
    border-radius: 6px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.performer-name {
    font-weight: 600;
    margin-bottom: 12px;
    color: var(--text-dark);
}

.performer-name a {
    color: var(--text-dark);
    text-decoration: none;
}

.performer-stats {
    display: flex;
    gap: 12px;
}

.performer-stats .stat {
    flex: 1;
    text-align: center;
}

.performer-stats .stat-label {
    display: block;
    font-size: 0.75em;
    color: var(--text-muted);
    margin-bottom: 2px;
}

.performer-stats .stat-value {
    display: block;
    font-size: 1.1em;
    font-weight: 600;
    color: var(--primary-dark);
}

.language-stats {
    margin-bottom: 40px;
}

.lang-cards {
    display: flex;
    gap: 20px;
    margin-top: 20px;
}

.lang-card {
    flex: 1;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.lang-name {
    font-size: 1.5em;
    font-weight: bold;
    color: var(--primary-dark);
    margin-bottom: 16px;
}

.lang-metrics {
    display: flex;
    gap: 20px;
}

.metric {
    flex: 1;
    text-align: center;
}

.metric-value {
    display: block;
    font-size: 1.3em;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 4px;
}

.metric-label {
    display: block;
    font-size: 0.85em;
    color: var(--text-muted);
}

.chart-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
    margin: 30px 0;
}

.chart-box {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.chart-box h2 {
    margin-bottom: 20px;
    font-size: 1.1em;
}

.chart-box canvas {
    height: 250px !important;
}

.ctr-badge {
    padding: 4px 10px;
    border-radius: 4px;
    font-weight: 600;
    font-size: 0.9em;
}

.ctr-badge.high {
    background: #d1f4e0;
    color: #059669;
}

.ctr-badge.medium {
    background: #fef3c7;
    color: #f59e0b;
}

.ctr-badge.low {
    background: #f3f4f6;
    color: #6b7280;
}



================================================================================

# navigation.css
# path: .\public\css\admin\analytics\navigation.css

/* path: ./public/css/admin/analytics/navigation.css */

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 20px;
}

.page-header h1 {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.8em;
    font-weight: 700;
    color: var(--text-dark);
    margin: 0;
}

.header-actions {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.info-banner {
    background: #eff6ff;
    border-left: 4px solid #3b82f6;
    padding: 16px;
    margin-bottom: 30px;
    border-radius: 4px;
    color: #1e3a8a;
}

.empty-state {
    background: white;
    padding: 60px 40px;
    text-align: center;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.empty-state h2 {
    margin-bottom: 15px;
    color: var(--text-dark);
}

.empty-state p {
    color: var(--text-muted);
}

.crawl-table-container {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    margin-bottom: 30px;
}

.crawl-table-container h2 {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 15px;
    font-size: 1.3em;
}

.crawl-table-container h2 i {
    color: #3b82f6;
}

.crawl-table-container p {
    margin-bottom: 15px;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}

.data-table th,
.data-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #e5e7eb;
    text-align: left;
}

.data-table th {
    background: #f9fafb;
    font-weight: 600;
    color: var(--text-dark);
}

.data-table th i {
    vertical-align: middle;
}

.data-table tbody tr:hover {
    background: var(--accent-light);
}

.data-table td a {
    color: var(--primary-dark);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 4px;
}

.data-table td a:hover {
    text-decoration: underline;
}

.data-table td a i {
    width: 14px;
    height: 14px;
}

.badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 4px;
    font-size: 0.85em;
    font-weight: 600;
    background: #e5e7eb;
    color: #374151;
}

.badge-success {
    background: #d1f4e0;
    color: #065f46;
}

.badge-danger {
    background: #f8d7da;
    color: #991b1b;
}

.recommendations-panel {
    background: white;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.recommendations-panel h2 {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 20px;
    font-size: 1.3em;
}

.recommendation {
    display: flex;
    gap: 20px;
    padding: 20px;
    border-radius: 6px;
    margin-bottom: 20px;
    border-left: 4px solid;
}

.recommendation.warning {
    background: #fef3c7;
    border-left-color: #f59e0b;
}

.recommendation.success {
    background: #d1f4e0;
    border-left-color: #059669;
}

.recommendation.info {
    background: #dbeafe;
    border-left-color: #3b82f6;
}

.rec-icon {
    font-size: 2em;
    display: flex;
    align-items: center;
    justify-content: center;
}

.rec-icon i {
    width: 36px;
    height: 36px;
}

.rec-content {
    flex: 1;
}

.rec-content h3 {
    margin-bottom: 10px;
    font-size: 1.1em;
    color: var(--text-dark);
}

.rec-content p {
    margin-bottom: 10px;
    color: var(--text-muted);
    line-height: 1.6;
}

.rec-content ul {
    margin: 10px 0;
    padding-left: 20px;
    color: var(--text-muted);
}

.rec-content li {
    margin-bottom: 8px;
    line-height: 1.6;
}

@media (max-width: 768px) {
    .page-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .header-actions {
        width: 100%;
        flex-direction: column;
    }
    
    .header-actions .btn,
    .header-actions select {
        width: 100%;
    }
    
    .recommendation {
        flex-direction: column;
        gap: 15px;
    }
    
    .rec-icon {
        font-size: 1.5em;
    }
}

================================================================================

# page_detail.css
# path: .\public\css\admin\analytics\page_detail.css

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 20px;
}

.page-header h1 {
    font-size: 1.8em;
    font-weight: 700;
    color: var(--text-dark);
    margin: 0;
}

.header-actions {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.header-actions .btn {
    padding: 8px 16px;
    text-decoration: none;
    background: var(--primary);
    color: white;
    border-radius: 4px;
    font-weight: 600;
    transition: 0.2s;
}

.header-actions .btn-secondary {
    background: var(--accent-light);
    color: var(--text-dark);
}

/* --- Info Banner --- */
.info-banner {
    background: var(--accent-light);
    padding: 15px 20px;
    border-radius: 6px;
    margin-bottom: 30px;
    font-size: 0.95em;
}

/* --- Summary Cards --- */
.crawl-summary-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.summary-card {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 20px;
    border-radius: 8px;
    background: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    border-left: 4px solid;
}

.summary-card.daily { border-left-color: #059669; }
.summary-card.weekly { border-left-color: #3b82f6; }
.summary-card.monthly { border-left-color: #f59e0b; }

.card-icon { font-size: 2em; }
.card-content { flex: 1; }
.card-number { font-size: 2em; font-weight: bold; color: var(--text-dark); line-height: 1; }
.card-label { font-weight: 600; color: var(--text-dark); margin-top: 4px; }
.card-desc { font-size: 0.85em; color: var(--text-muted); }

/* --- Tables --- */
.crawl-table-container {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    margin-bottom: 30px;
}

.crawl-table-container h2 {
    margin-bottom: 20px;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}

.data-table th,
.data-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #e5e7eb;
    text-align: left;
}

.data-table th { background: #f9fafb; font-weight: 600; }

.crawl-table td { vertical-align: middle; }

/* --- Status Badges --- */
.status-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 0.85em;
    font-weight: 600;
}

.status-daily { background: #d1f4e0; color: #065f46; }
.status-rare { background: #f8d7da; color: #991b1b; }

/* --- Recommendations --- */
.recommendations-panel {
    background: white;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.recommendations-panel h2 { margin-bottom: 20px; }

.recommendation {
    display: flex;
    gap: 20px;
    padding: 20px;
    border-radius: 6px;
    margin-bottom: 20px;
    border-left: 4px solid;
}

.recommendation.warning { background: #fef3c7; border-left-color: #f59e0b; }
.recommendation.info { background: #dbeafe; border-left-color: #3b82f6; }

.rec-icon { font-size: 2em; }
.rec-content { flex: 1; }
.rec-content h3 { margin-bottom: 8px; font-size: 1.1em; }
.rec-content p, .rec-content li { color: var(--text-muted); }
.rec-content ul { margin: 10px 0; padding-left: 20px; }

/* --- Empty State --- */
.empty-state {
    text-align: center;
    color: var(--text-muted);
    padding: 20px;
    font-size: 0.95em;
}

/* --- Responsive --- */
@media (max-width: 768px) {
    .crawl-summary-cards { grid-template-columns: 1fr; }
    .header-actions { flex-direction: column; gap: 10px; }
    .recommendation { flex-direction: column; gap: 10px; }
}


================================================================================

# rotation.css
# path: .\public\css\admin\analytics\rotation.css

.info-banner {
    background: #eff6ff;
    border-left: 4px solid #3b82f6;
    padding: 16px;
    margin-bottom: 30px;
    border-radius: 4px;
    color: #1e3a8a;
}

.empty-state {
    background: white;
    padding: 60px 40px;
    text-align: center;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.empty-state h2 {
    margin-bottom: 20px;
    color: var(--text-dark);
}

.empty-state ol {
    text-align: left;
    max-width: 400px;
    margin: 20px auto;
}

.empty-state li {
    margin-bottom: 10px;
    color: var(--text-muted);
}

.rotation-effectiveness-grid {
    display: grid;
    gap: 30px;
}

.effectiveness-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    overflow: hidden;
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    background: var(--accent-light);
    border-bottom: 2px solid var(--primary-light);
}

.card-header h2 {
    margin: 0;
    font-size: 1.3em;
    color: var(--text-dark);
}

.slug-badge {
    background: var(--primary-dark);
    color: var(--primary-light);
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 0.85em;
    font-family: monospace;
}

.rotation-timeline {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1px;
    background: var(--accent-light);
    padding: 1px;
}

.rotation-item {
    background: white;
    padding: 16px;
    transition: all 0.2s;
}

.rotation-item:hover {
    background: var(--accent-light);
}

.rotation-item.current {
    background: #eff6ff;
    border-left: 3px solid #3b82f6;
}

.rotation-month {
    font-size: 1.1em;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.current-badge {
    background: #3b82f6;
    color: white;
    padding: 2px 8px;
    border-radius: 3px;
    font-size: 0.7em;
    font-weight: 700;
}

.rotation-metrics {
    margin-bottom: 12px;
}

.metric-row {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    border-bottom: 1px solid var(--accent-light);
}

.metric-row:last-child {
    border-bottom: none;
}

.metric-label {
    font-size: 0.85em;
    color: var(--text-muted);
}

.metric-value {
    font-weight: 600;
    color: var(--text-dark);
}

.metric-value.highlight {
    color: var(--success);
}

.rotation-actions {
    padding-top: 12px;
    border-top: 1px solid var(--accent-light);
}

.card-summary {
    display: flex;
    justify-content: space-around;
    padding: 20px;
    background: var(--accent-light);
    border-top: 2px solid var(--primary-light);
}

.summary-stat {
    text-align: center;
}

.summary-stat .stat-label {
    display: block;
    font-size: 0.85em;
    color: var(--text-muted);
    margin-bottom: 4px;
}

.summary-stat .stat-value {
    display: block;
    font-size: 1.4em;
    font-weight: 600;
    color: var(--primary-dark);
}

@media (max-width: 768px) {
    .rotation-timeline {
        grid-template-columns: 1fr;
    }
    
    .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .card-summary {
        flex-direction: column;
        gap: 16px;
    }
}

================================================================================

# manager.css
# path: .\public\css\admin\media\manager.css

.media-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 15px;
}

.media-filters {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}

.media-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 20px;
}

.media-item {
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    transition: all 0.2s;
    cursor: pointer;
    position: relative;
}

.media-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.media-item.selected {
    outline: 3px solid #3b82f6;
    outline-offset: 2px;
}

.media-preview {
    width: 100%;
    height: 180px;
    background: #f5f5f5;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
}

.media-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.media-checkbox {
    position: absolute;
    top: 10px;
    left: 10px;
    width: 22px;
    height: 22px;
    cursor: pointer;
    z-index: 10;
    display: none; /* Hidden by default */
    accent-color: #3b82f6;
    transition: transform 0.2s;
}

.media-checkbox:hover {
    transform: scale(1.1);
}

.media-info {
    padding: 12px;
}

.media-name {
    font-size: 0.85em;
    font-weight: 600;
    margin-bottom: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: #303034;
}

.media-meta {
    font-size: 0.75em;
    color: #6b7280;
    margin-bottom: 8px;
}

.media-actions {
    display: flex;
    gap: 5px;
}

.media-actions button {
    flex: 1;
    padding: 6px;
    font-size: 0.8em;
}

.bulk-actions {
    display: none;
    background: #eff6ff;
    padding: 15px;
    border-radius: 6px;
    margin-bottom: 20px;
    border-left: 3px solid #3b82f6;
}

.bulk-actions.active {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
}

/* Select Mode Button States */
#select-mode-btn {
    position: relative;
}

#select-mode-btn.btn-primary {
    background: #3b82f6;
    border-color: #3b82f6;
}

#select-mode-btn.btn-primary::after {
    content: '✓';
    margin-left: 6px;
}

/* Modal styles */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    z-index: 10000;
    align-items: center;
    justify-content: center;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: white;
    border-radius: 8px;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    width: 90%;
}

.modal-header {
    padding: 20px;
    border-bottom: 1px solid #e5e7eb;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
}

.close-btn {
    background: none;
    border: none;
    font-size: 1.5em;
    cursor: pointer;
    color: #6b7280;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: all 0.2s;
}

.close-btn:hover {
    background: #f3f4f6;
    color: #303034;
}

.modal-body {
    padding: 20px;
}

.insert-preview {
    max-width: 100%;
    border-radius: 6px;
    margin-bottom: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.insert-options {
    display: grid;
    gap: 15px;
}

.size-options {
    display: flex;
    gap: 10px;
}

.size-option {
    flex: 1;
    padding: 12px;
    border: 2px solid #e5e7eb;
    border-radius: 6px;
    cursor: pointer;
    text-align: center;
    transition: all 0.2s;
}

.size-option:hover,
.size-option.active {
    border-color: #3b82f6;
    background: #eff6ff;
}

.copy-field {
    display: flex;
    gap: 8px;
}

.copy-field input {
    flex: 1;
    padding: 8px;
    border: 1px solid #e5e7eb;
    border-radius: 4px;
    font-family: monospace;
    font-size: 0.9em;
}

/* Responsive */
@media (max-width: 768px) {
    .media-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    }
    
    .media-controls {
        flex-direction: column;
        align-items: stretch;
    }
    
    .media-filters {
        width: 100%;
    }
    
    .media-filters button {
        flex: 1;
    }
}


================================================================================

# manage.css
# path: .\public\css\admin\rotations\manage.css

.rotation-stats-bar {
    display: flex;
    gap: 30px;
    padding: 20px;
    background: white;
    border-radius: 6px;
    margin-bottom: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.stat-item {
    display: flex;
    flex-direction: column;
}

.stat-label {
    font-size: 0.85em;
    color: var(--text-muted);
    margin-bottom: 4px;
}

.stat-value {
    font-size: 1.2em;
    font-weight: 600;
    color: var(--text-dark);
}

.stat-value.current-month {
    color: #3b82f6;
}

.bulk-actions-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: var(--accent-light);
    border-radius: 6px;
    margin-bottom: 15px;
}

.bulk-buttons {
    display: flex;
    gap: 10px;
}

.rotation-table {
    margin-top: 0;
}

.current-month-row {
    background: #eff6ff !important;
    border-left: 3px solid #3b82f6;
}

.inactive-row {
    opacity: 0.6;
}

.content-preview {
    font-size: 0.9em;
    color: var(--text-muted);
    line-height: 1.4;
}

.no-content {
    color: #9ca3af;
}

.action-buttons {
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
}

.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.modal-content {
    background: white;
    padding: 0;
    border-radius: 8px;
    max-width: 500px;
    width: 90%;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid var(--accent-light);
}

.modal-header h2 {
    margin: 0;
    font-size: 1.3em;
}

.close-btn {
    background: none;
    border: none;
    font-size: 2em;
    cursor: pointer;
    color: var(--text-muted);
    line-height: 1;
}

.modal form {
    padding: 20px;
}

.modal-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--accent-light);
}


================================================================================

# overview.css
# path: .\public\css\admin\rotations\overview.css

.rotation-summary {
    margin-top: 30px;
}

.rotation-card {
    background: white;
    border-radius: 8px;
    padding: 24px;
    margin-top: 10px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    border-left: 4px solid #059669;
}

.rotation-card.status-incomplete {
    border-left-color: #f59e0b;
}

.rotation-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 16px;
}

.rotation-header h3 {
    margin: 0 0 4px 0;
    font-size: 1.2em;
}

.rotation-header h3 a {
    color: var(--text-dark);
    text-decoration: none;
}

.rotation-header h3 a:hover {
    color: var(--primary-dark);
}

.slug {
    color: var(--text-muted);
    font-size: 0.9em;
    margin: 0;
}

.rotation-stats {
    display: flex;
    gap: 16px;
}

.stat-badge {
    text-align: center;
}

.stat-number {
    display: block;
    font-size: 1.5em;
    font-weight: bold;
    color: var(--primary-dark);
}

.stat-label {
    display: block;
    font-size: 0.85em;
    color: var(--text-muted);
}

.progress-bar {
    height: 8px;
    background: var(--accent-light);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 16px;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #059669, #10b981);
    transition: width 0.3s;
}

.status-incomplete .progress-fill {
    background: linear-gradient(90deg, #f59e0b, #fbbf24);
}

.rotation-details {
    margin-bottom: 16px;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid var(--accent-light);
}

.detail-row:last-child {
    border-bottom: none;
}

.detail-row .label {
    font-weight: 500;
    color: var(--text-muted);
}

.detail-row .value {
    color: var(--text-dark);
}

.detail-row .value.missing {
    color: #f59e0b;
    font-weight: 500;
}

.detail-row .value.inactive {
    color: #dc3545;
}

.rotation-actions {
    display: flex;
    gap: 10px;
    padding-top: 16px;
    border-top: 1px solid var(--accent-light);
}


================================================================================

# admin.js
# path: .\public\js\admin.js

// ----------------------------
// Tabs
// ----------------------------
function switchTab(tab, event) {
    if (event && event.currentTarget) {
        event.preventDefault();
    }
    
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

    // Find and activate the button that was clicked
    const clickedBtn = event && event.currentTarget ? event.currentTarget : 
                       document.querySelector(`[onclick*="switchTab('${tab}')"]`);
    
    if (clickedBtn) {
        clickedBtn.classList.add('active');
    }
    
    const content = document.getElementById('tab-' + tab);
    if (content) content.classList.add('active');
}

// ----------------------------
// DOM Ready
// ----------------------------
document.addEventListener('DOMContentLoaded', () => {

    const wrapper = document.querySelector('.admin-wrapper');
    const sidebar = document.querySelector('.sidebar');
    const toggle = document.querySelector('.sidebar-toggle');

    if (!wrapper || !sidebar || !toggle) return;

    // ----------------------------
    // Delete Confirmation
    // ----------------------------
    document.querySelectorAll('form[action*="delete"]').forEach(form => {
        form.addEventListener('submit', e => {
            if (!confirm('Are you sure you want to delete this item?')) {
                e.preventDefault();
            }
        });
    });

    // ----------------------------
    // Sidebar Toggle
    // ----------------------------
    function updateIcon() {
        toggle.innerHTML = '<i data-feather="chevron-left"></i>';
        feather.replace();
    }

    toggle.addEventListener('click', e => {
        e.stopPropagation();
        wrapper.classList.toggle('sidebar-collapsed');
        updateIcon();
    });

    // Click outside sidebar to collapse (only on mobile/tablet)
    document.addEventListener('click', e => {
        // Remove the screen size check
        if (!e.target.closest('.sidebar') && !e.target.closest('.sidebar-toggle')) {
            if (!wrapper.classList.contains('sidebar-collapsed')) {
                wrapper.classList.add('sidebar-collapsed');
                updateIcon();
            }
        }
    });


    // Start collapsed on mobile, expanded on desktop
    
    updateIcon();

});

================================================================================

# link-tracking.js
# path: .\public\js\link-tracking.js

// path: ./public/js/link-tracking.js
// Internal link tracking for analytics

(function() {
    'use strict';
    
    function getCurrentSlug() {
        const pathParts = window.location.pathname.split('/').filter(Boolean);
        return pathParts[0] && pathParts[0].length > 2 ? pathParts[0] : 'home';
    }
    
    function getCurrentLanguage() {
        const pathParts = window.location.pathname.split('/').filter(Boolean);
        const lastPart = pathParts[pathParts.length - 1];
        return lastPart === 'uz' ? 'uz' : 'ru';
    }
    
    function trackInternalLink(toSlug) {
        const fromSlug = getCurrentSlug();
        const lang = getCurrentLanguage();
        
        if (fromSlug === toSlug) return;
        
        fetch(window.baseUrl + '/track-internal-link', {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/x-www-form-urlencoded' 
            },
            body: 'from=' + encodeURIComponent(fromSlug) + 
                  '&to=' + encodeURIComponent(toSlug) + 
                  '&lang=' + encodeURIComponent(lang),
            keepalive: true // Ensure request completes even if page unloads
        }).catch(function(err) {
            console.debug('Link tracking failed:', err);
        });
    }
    
    function extractSlugFromHref(href) {
        try {
            const url = new URL(href, window.location.origin);
            if (url.origin !== window.location.origin) return null;
            const pathParts = url.pathname.split('/').filter(Boolean);
            for (let i = 0; i < pathParts.length; i++) {
                const part = pathParts[i];
                if (part.length > 2) return part;
            }
            
            return 'home'; 
        } catch (e) {
            return null;
        }
    }
    
    function setupLinkTracking() {
        document.addEventListener('click', function(e) {
            const link = e.target.closest('a');
            
            if (!link || !link.href) return;
            const toSlug = extractSlugFromHref(link.href);
            
            if (toSlug) {
                trackInternalLink(toSlug);
            }
        }, true); 
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupLinkTracking);
    } else {
        setupLinkTracking();
    }
})();

================================================================================

# media_manager.js
# path: .\public\js\media_manager.js

    let selectMode = false;
    let selectedItems = new Set();
    let currentInsertUrl = '';
    let currentInsertName = '';

    function uploadFile() {
        const input = document.getElementById('file-input');
        const file = input.files[0];
        if (!file) return;
        
        const formData = new FormData();
        formData.append('file', file);
        
        fetch('<?= BASE_URL ?>/admin/media/upload', {
            method: 'POST',
            body: formData
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert(data.message);
            }
        })
        .catch(e => alert('Upload failed'));
    }

    function deleteMedia(id) {
        if (!confirm('Delete this image?')) return;
        
        const formData = new FormData();
        formData.append('id', id);
        
        fetch('<?= BASE_URL ?>/admin/media/delete', {
            method: 'POST',
            body: formData
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                document.querySelector(`[data-id="${id}"]`).remove();
            } else {
                alert('Delete failed');
            }
        });
    }

    function copyUrl(url) {
        navigator.clipboard.writeText(url).then(() => {
            alert('URL copied to clipboard');
        });
    }

    function toggleSelectMode() {
        selectMode = !selectMode;
        const btn = document.getElementById('select-mode-btn');
        
        if (selectMode) {
            btn.classList.add('btn-primary');
            // Show all checkboxes
            document.querySelectorAll('.media-checkbox').forEach(cb => {
                cb.style.display = 'block';
            });
        } else {
            btn.classList.remove('btn-primary');
            // Hide checkboxes
            document.querySelectorAll('.media-checkbox').forEach(cb => {
                cb.style.display = 'none';
            });
            clearSelection();
        }
        
        feather.replace();
    }

    function toggleMediaSelection(checkbox) {
        const item = checkbox.closest('.media-item');
        const id = item.dataset.id;
        
        if (checkbox.checked) {
            selectedItems.add(id);
            item.classList.add('selected');
        } else {
            selectedItems.delete(id);
            item.classList.remove('selected');
        }
        
        updateBulkActions();
    }

    function selectMedia(element, event) {
        if (!selectMode) return;
        
        // Don't trigger if clicking on buttons
        if (event.target.closest('button')) return;
        
        const checkbox = element.querySelector('.media-checkbox');
        checkbox.checked = !checkbox.checked;
        toggleMediaSelection(checkbox);
    }

    function updateBulkActions() {
        const bulkActions = document.getElementById('bulk-actions');
        const count = document.getElementById('selected-count');
        
        count.textContent = selectedItems.size;
        
        if (selectedItems.size > 0) {
            bulkActions.classList.add('active');
        } else {
            bulkActions.classList.remove('active');
        }
    }

    function clearSelection() {
        selectedItems.clear();
        document.querySelectorAll('.media-checkbox').forEach(cb => {
            cb.checked = false;
            cb.style.display = 'none';
        });
        document.querySelectorAll('.media-item').forEach(item => {
            item.classList.remove('selected');
        });
        updateBulkActions();
    }

    function deleteSelected() {
        if (!confirm(`Delete ${selectedItems.size} selected images?`)) return;
        
        const promises = Array.from(selectedItems).map(id => {
            const formData = new FormData();
            formData.append('id', id);
            return fetch('<?= BASE_URL ?>/admin/media/delete', {
                method: 'POST',
                body: formData
            });
        });
        
        Promise.all(promises).then(() => {
            location.reload();
        });
    }

    function insertSingle(id) {
        const item = document.querySelector(`[data-id="${id}"]`);
        const filename = item.dataset.filename;
        const name = item.dataset.name;
        
        currentInsertUrl = '<?= UPLOAD_URL ?>' + filename;
        currentInsertName = name;
        
        showInsertModal();
    }

    function insertSelected() {
        if (selectedItems.size === 0) {
            alert('Please select images first');
            return;
        }
        
        let htmlCode = '';
        selectedItems.forEach(id => {
            const item = document.querySelector(`[data-id="${id}"]`);
            const filename = item.dataset.filename;
            const name = item.dataset.name;
            const url = '<?= UPLOAD_URL ?>' + filename;
            htmlCode += `<img src="${url}" alt="${name}">\n`;
        });
        
        navigator.clipboard.writeText(htmlCode).then(() => {
            alert(`HTML code for ${selectedItems.size} images copied to clipboard!`);
        });
    }

    function showInsertModal() {
        document.getElementById('insert-preview').src = currentInsertUrl;
        updateInsertCodes('full');
        document.getElementById('insert-modal').classList.add('active');
        feather.replace();
    }

    function closeInsertModal() {
        document.getElementById('insert-modal').classList.remove('active');
    }

    function selectSize(element) {
        document.querySelectorAll('.size-option').forEach(opt => opt.classList.remove('active'));
        element.classList.add('active');
        
        const size = element.dataset.size;
        updateInsertCodes(size);
    }

    function updateInsertCodes(size) {
        let sizeClass = '';
        let sizeStyle = '';
        
        switch(size) {
            case 'medium':
                sizeClass = ' class="img-medium"';
                sizeStyle = ' style="max-width: 600px;"';
                break;
            case 'thumbnail':
                sizeClass = ' class="img-thumbnail"';
                sizeStyle = ' style="max-width: 300px;"';
                break;
            default:
                sizeClass = '';
                sizeStyle = '';
        }
        
        document.getElementById('image-url').value = currentInsertUrl;
        document.getElementById('html-code').value = `<img src="${currentInsertUrl}" alt="${currentInsertName}"${sizeStyle}>`;
        document.getElementById('markdown-code').value = `![${currentInsertName}](${currentInsertUrl})`;
    }

    function copyField(fieldId) {
        const field = document.getElementById(fieldId);
        field.select();
        navigator.clipboard.writeText(field.value).then(() => {
            alert('Copied to clipboard!');
            if (fieldId === 'html-code') {
                closeInsertModal();
            }
        });
    }

    function filterMedia() {
        const search = document.getElementById('search-input').value.toLowerCase();
        document.querySelectorAll('.media-item').forEach(item => {
            const name = item.dataset.name.toLowerCase();
            item.style.display = name.includes(search) ? '' : 'none';
        });
    }

    function sortMedia() {
        const sortBy = document.getElementById('sort-select').value;
        const grid = document.getElementById('media-grid');
        const items = Array.from(grid.children);
        
        items.sort((a, b) => {
            switch(sortBy) {
                case 'newest':
                    return parseInt(b.dataset.date) - parseInt(a.dataset.date);
                case 'oldest':
                    return parseInt(a.dataset.date) - parseInt(b.dataset.date);
                case 'name':
                    return a.dataset.name.localeCompare(b.dataset.name);
                case 'size':
                    return parseInt(b.dataset.size) - parseInt(a.dataset.size);
            }
        });
        
        items.forEach(item => grid.appendChild(item));
    }

    // Initialize - hide checkboxes by default
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.media-checkbox').forEach(cb => {
            cb.style.display = 'none';
        });
        feather.replace();
    });

    // Close modal on outside click
    document.getElementById('insert-modal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeInsertModal();
        }
    });

================================================================================

# error.php
# path: .\views\error.php

<?php
// path: ./views/error.php

$lang = $lang ?? 'ru';
$code = intval($_GET['code'] ?? 500);

http_response_code($code);

// Error titles and messages
$errorTitles = [
    400 => ['ru'=>'Неверный запрос','uz'=>"Noto‘g‘ri so‘rov"],
    401 => ['ru'=>'Требуется авторизация','uz'=>'Avtorizatsiya talab qilinadi'],
    403 => ['ru'=>'Доступ запрещён','uz'=>"Kirish taqiqlangan"],
    404 => ['ru'=>'Страница не найдена','uz'=>'Sahifa topilmadi'],
    500 => ['ru'=>'Внутренняя ошибка сервера','uz'=>'Serverda ichki xato']
];

$errorMessages = [
    400 => ['ru'=>'Ваш запрос не может быть обработан.','uz'=>"Sizning so‘rovingiz qayta ishlanmaydi."],
    401 => ['ru'=>'Пожалуйста, авторизуйтесь для доступа.','uz'=>'Kirish uchun avtorizatsiya qilishingiz kerak.'],
    403 => ['ru'=>'У вас нет прав для доступа к этой странице.','uz'=>'Sizda ushbu sahifaga kirish huquqi yo‘q.'],
    404 => ['ru'=>'Страница, которую вы ищете, не найдена.','uz'=>'Siz izlayotgan sahifa topilmadi.'],
    500 => ['ru'=>'Произошла ошибка на сервере.','uz'=>'Serverda xato yuz berdi.']
];

$title = $errorTitles[$code][$lang] ?? $errorTitles[500][$lang];
$message = $errorMessages[$code][$lang] ?? $errorMessages[500][$lang];

$siteName = 'Kuplyu Tashkent';
?>

<!DOCTYPE html>
<html lang="<?= $lang ?>">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?= htmlspecialchars($title) ?> - <?= htmlspecialchars($siteName) ?></title>
    <link rel="icon" href="<?= BASE_URL ?>/css/favicon.ico">
    <link rel="stylesheet" href="<?= BASE_URL ?>/css/pages.css">
    <style>
        body { font-family: sans-serif; margin:0; padding:0; background:#f9f9f9; color:#333; display:flex; flex-direction:column; min-height:100vh; }
        .container { max-width: 900px; margin: auto; text-align: center; padding: 80px 20px; flex:1; }
        h1 { font-size: 2em; margin-bottom: 20px; }
        p { font-size: 1.1em; color: #555; margin-bottom: 30px; }
        a.button { display: inline-block; padding: 12px 24px; background: #dc3545; color: #fff; border-radius:6px; text-decoration:none; font-weight:500; transition: all 0.2s; }
        a.button:hover { background: #c82333; }
        footer { text-align:center; padding:20px 0; background:#f1f1f1; font-size:0.9em; color:#666; }
    </style>
</head>
<body>
    <div class="container">
        <h1><?= htmlspecialchars($title) ?></h1>
        <p><?= htmlspecialchars($message) ?></p>
        <a class="button" href="<?= BASE_URL ?>"><?= $lang === 'ru' ? 'Вернуться на главную' : "Bosh sahifaga qaytish" ?></a>
    </div>
    <footer>
        &copy; <?= date('Y') ?> <?= htmlspecialchars($siteName) ?>. <?= $lang === 'ru' ? 'Все права защищены.' : "Barcha huquqlar himoyalangan." ?>
    </footer>
</body>
</html>


================================================================================

# dashboard.php
# path: .\views\admin\dashboard.php

<?php require 'layout/header.php'; ?>

<h1>Dashboard</h1>

<div class="stats-grid">
    <div class="stat-card">
        <h3>Total Pages</h3>
        <p class="stat-number"><?= $stats['total_pages'] ?></p>
    </div>
    
    <div class="stat-card">
        <h3>Published Pages</h3>
        <p class="stat-number"><?= $stats['published_pages'] ?></p>
    </div>
    
    <div class="stat-card">
        <h3>Media Files</h3>
        <p class="stat-number"><?= $stats['total_media'] ?></p>
    </div>
</div>

<div style="margin-top: 30px;">
    <h2>Quick Actions</h2>
    <div class="btn-group">
        <a href="<?= BASE_URL ?>/admin/pages/new" class="btn btn-primary">Create New Page</a>
        <a href="<?= BASE_URL ?>/admin/seo" class="btn btn-secondary">Edit SEO Settings</a>
        <a href="<?= BASE_URL ?>/" class="btn btn-secondary" target="_blank">View Website</a>
    </div>
</div>

<?php require 'layout/footer.php'; ?>

================================================================================

# login.php
# path: .\views\admin\login.php

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login</title>
    <link rel="stylesheet" href="<?= BASE_URL ?>/css/admin.css">
</head>
<body>
    <div class="login-wrapper">
        <div class="login-box">
            <h2>Admin Login</h2>
            
            <?php if (isset($_SESSION['error'])): ?>
                <div class="alert alert-error"><?= e($_SESSION['error']) ?></div>
                <?php unset($_SESSION['error']); ?>
            <?php endif; ?>
            
            <form method="POST" action="<?= BASE_URL ?>/admin/login">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" name="username" required autofocus>
                </div>
                
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" required>
                </div>
                
                <button type="submit" class="btn btn-primary">Login</button>
                <?= csrfField() ?>
            </form>
        </div>
    </div>
</body>
</html>

================================================================================

# crawl.php
# path: .\views\admin\analytics\crawl.php

<?php 
// path: ./views/admin/analytics/crawl.php
$pageName = 'analytics/crawl';
require BASE_PATH . '/views/admin/layout/header.php'; 
?>

<div class="page-header">
    <h1>Crawl Frequency Analysis</h1>
    <div class="header-actions">
        <select onchange="window.location='?days='+this.value" class="btn">
            <option value="7" <?= $days == 7 ? 'selected' : '' ?>>Last 7 Days</option>
            <option value="30" <?= $days == 30 ? 'selected' : '' ?>>Last 30 Days</option>
            <option value="60" <?= $days == 60 ? 'selected' : '' ?>>Last 60 Days</option>
            <option value="90" <?= $days == 90 ? 'selected' : '' ?>>Last 90 Days</option>
        </select>
        <a href="<?= BASE_URL ?>/admin/analytics" class="btn btn-secondary">Back to Analytics</a>
    </div>
</div>

<div class="info-banner">
    <strong><i data-feather="zap"></i> Understanding Crawl Frequency:</strong> This shows how often search engines visit your pages. 
    Higher frequency means Google considers your content important. Pages with low frequency may need more internal links or fresher content.
</div>

<?php if (empty($crawl_frequency)): ?>
    <div class="empty-state">
        <h2>No Crawl Data Available</h2>
        <p>Analytics tracking will show data once visitors start accessing your pages.</p>
    </div>
<?php else: ?>

<!-- Summary Stats -->
<div class="crawl-summary-cards">
    <?php
    $dailyPages = 0;
    $weeklyPages = 0;
    $monthlyPages = 0;
    $rarePages = 0;
    
    foreach ($crawl_frequency as $page) {
        $daysSince = (strtotime('today') - strtotime($page['last_visit'])) / 86400;
        if ($daysSince <= 1) $dailyPages++;
        elseif ($daysSince <= 7) $weeklyPages++;
        elseif ($daysSince <= 30) $monthlyPages++;
        else $rarePages++;
    }
    ?>
    
    <div class="summary-card daily">
        <div class="card-icon"><i data-feather="calendar"></i></div>
        <div class="card-content">
            <div class="card-number"><?= $dailyPages ?></div>
            <div class="card-label">Daily Crawl</div>
            <div class="card-desc">Visited within 24h</div>
        </div>
    </div>
    
    <div class="summary-card weekly">
        <div class="card-icon"><i data-feather="bar-chart-2"></i></div>
        <div class="card-content">
            <div class="card-number"><?= $weeklyPages ?></div>
            <div class="card-label">Weekly Crawl</div>
            <div class="card-desc">Visited within 7 days</div>
        </div>
    </div>
    
    <div class="summary-card monthly">
        <div class="card-icon"><i data-feather="calendar"></i></div>
        <div class="card-content">
            <div class="card-number"><?= $monthlyPages ?></div>
            <div class="card-label">Monthly Crawl</div>
            <div class="card-desc">Visited within 30 days</div>
        </div>
    </div>
    
    <div class="summary-card rare">
        <div class="card-icon"><i data-feather="alert-circle"></i></div>
        <div class="card-content">
            <div class="card-number"><?= $rarePages ?></div>
            <div class="card-label">Rare/Stale</div>
            <div class="card-desc">Needs attention</div>
        </div>
    </div>
</div>

<!-- Detailed Table -->
<div class="crawl-table-container">
    <h2>Detailed Crawl Analysis (Last <?= $days ?> Days)</h2>
    
    <table class="data-table crawl-table">
        <thead>
            <tr>
                <th>Page</th>
                <th>Days with Visits</th>
                <th>Total Visits</th>
                <th>Avg/Day</th>
                <th>Last Visit</th>
                <th>Days Ago</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <?php foreach ($crawl_frequency as $page): 
                $daysSince = round((strtotime('today') - strtotime($page['last_visit'])) / 86400);
                $avgPerDay = round($page['avg_visits_per_day'], 1);
                
                // Determine status
                if ($daysSince <= 1) {
                    $status = 'Daily';
                    $statusClass = 'status-daily';
                } elseif ($daysSince <= 7) {
                    $status = 'Weekly';
                    $statusClass = 'status-weekly';
                } elseif ($daysSince <= 30) {
                    $status = 'Monthly';
                    $statusClass = 'status-monthly';
                } else {
                    $status = 'Rare';
                    $statusClass = 'status-rare';
                }
            ?>
            <tr>
                <td>
                    <strong><?= e($page['page_slug']) ?></strong>
                </td>
                <td><?= $page['days_with_visits'] ?> / <?= $days ?></td>
                <td><?= number_format($page['total_visits']) ?></td>
                <td><?= $avgPerDay ?></td>
                <td><?= date('M d, Y', strtotime($page['last_visit'])) ?></td>
                <td>
                    <span class="days-ago <?= $daysSince > 7 ? 'warning' : '' ?>">
                        <?= $daysSince ?> day<?= $daysSince != 1 ? 's' : '' ?>
                    </span>
                </td>
                <td>
                    <span class="status-badge <?= $statusClass ?>">
                        <?= $status ?>
                    </span>
                </td>
                <td>
                    <div class="action-buttons">
                        <a href="<?= BASE_URL ?>/<?= e($page['page_slug']) ?>" 
                           target="_blank" 
                           class="btn btn-sm" 
                           title="View page">
                            <i data-feather="eye"></i> View
                        </a>
                        <a href="<?= BASE_URL ?>/admin/analytics/page/<?= e($page['page_slug']) ?>" 
                           class="btn btn-sm" 
                           title="View analytics">
                            <i data-feather="bar-chart-2"></i> Stats
                        </a>
                    </div>
                </td>
            </tr>
            <?php endforeach; ?>
        </tbody>
    </table>
</div>

<!-- Recommendations -->
<div class="recommendations-panel">
    <h2>Recommendations</h2>
    
    <?php if ($rarePages > 0): ?>
    <div class="recommendation warning">
        <div class="rec-icon"><i data-feather="alert-circle"></i></div>
        <div class="rec-content">
            <h3><?= $rarePages ?> page(s) with rare crawl frequency</h3>
            <p><strong>Action:</strong> These pages need attention. Consider:</p>
            <ul>
                <li>Adding more internal links to these pages</li>
                <li>Updating content to make it fresher</li>
                <li>Enabling content rotation to signal freshness</li>
                <li>Adding to sitemap with higher priority</li>
            </ul>
        </div>
    </div>
    <?php endif; ?>
    
    <?php if ($dailyPages > 0): ?>
    <div class="recommendation success">
        <div class="rec-icon"><i data-feather="check-circle"></i></div>
        <div class="rec-content">
            <h3><?= $dailyPages ?> page(s) with daily crawl frequency</h3>
            <p><strong>Great!</strong> These pages are performing well. Google considers them important and up-to-date.</p>
        </div>
    </div>
    <?php endif; ?>
    
    <div class="recommendation info">
        <div class="rec-icon"><i data-feather="zap"></i></div>
        <div class="rec-content">
            <h3>Improve Overall Crawl Frequency</h3>
            <ul>
                <li><strong>Content Rotation:</strong> Regular content updates signal freshness to search engines</li>
                <li><strong>Internal Linking:</strong> Link to underperforming pages from popular ones</li>
                <li><strong>Sitemap:</strong> Ensure all pages are in sitemap.xml with appropriate priority</li>
                <li><strong>Quality Content:</strong> Longer, more detailed content gets crawled more often</li>
            </ul>
        </div>
    </div>
</div>

<?php endif; ?>

<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>


================================================================================

# index.php
# path: .\views\admin\analytics\index.php

<?php 
// path: ./views/admin/analytics/index.php
$pageName = 'analytics/index';
require BASE_PATH . '/views/admin/layout/header.php'; 
?>

<div class="page-header">
    <h1>Analytics Dashboard</h1>
    <div class="header-actions">
        <select onchange="window.location='?months='+this.value" class="btn">
            <option value="3" <?= $stats['months'] == 3 ? 'selected' : '' ?>>Last 3 Months</option>
            <option value="6" <?= $stats['months'] == 6 ? 'selected' : '' ?>>Last 6 Months</option>
            <option value="12" <?= $stats['months'] == 12 ? 'selected' : '' ?>>Last 12 Months</option>
        </select>
        
        <a href="<?= BASE_URL ?>/admin/analytics/export?months=<?= $stats['months'] ?>" 
           class="btn btn-secondary">
            <i data-feather="download"></i> Export CSV
        </a>
    </div>
</div>

<!-- Performance Trends -->
<div class="trend-cards">
    <div class="trend-card">
        <div class="trend-header">
            <span class="trend-label">Current Month Visits</span>
            <span class="trend-change <?= $stats['trends']['changes']['visits'] >= 0 ? 'positive' : 'negative' ?>">
                <?= $stats['trends']['changes']['visits'] >= 0 ? '↑' : '↓' ?>
                <?= abs($stats['trends']['changes']['visits']) ?>%
            </span>
        </div>
        <div class="trend-value"><?= number_format($stats['trends']['current']['visits'] ?? 0) ?></div>
        <div class="trend-comparison">
            vs <?= number_format($stats['trends']['previous']['visits'] ?? 0) ?> last month
        </div>
    </div>
    
    <div class="trend-card">
        <div class="trend-header">
            <span class="trend-label">Current Month Clicks</span>
            <span class="trend-change <?= $stats['trends']['changes']['clicks'] >= 0 ? 'positive' : 'negative' ?>">
                <?= $stats['trends']['changes']['clicks'] >= 0 ? '↑' : '↓' ?>
                <?= abs($stats['trends']['changes']['clicks']) ?>%
            </span>
        </div>
        <div class="trend-value"><?= number_format($stats['trends']['current']['clicks'] ?? 0) ?></div>
        <div class="trend-comparison">
            vs <?= number_format($stats['trends']['previous']['clicks'] ?? 0) ?> last month
        </div>
    </div>
    
    <div class="trend-card">
        <div class="trend-header">
            <span class="trend-label">Overall CTR</span>
        </div>
        <div class="trend-value">
            <?php 
            $totalVisits = $stats['total']['total_visits'] ?? 0;
            $totalClicks = $stats['total']['total_clicks'] ?? 0;
            $ctr = $totalVisits > 0 ? round(($totalClicks / $totalVisits) * 100, 2) : 0;
            echo $ctr;
            ?>%
        </div>
        <div class="trend-comparison">
            <?= number_format($totalClicks) ?> clicks / <?= number_format($totalVisits) ?> visits
        </div>
    </div>
</div>


<!-- Overview Content -->
<?php if ($stats['view'] === 'overview'): ?>

<!-- Quick Access Cards -->
<div class="quick-access-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 40px;">
    <a href="<?= BASE_URL ?>/admin/analytics/navigation" class="quick-card" style="text-decoration: none; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-left: 4px solid #3b82f6; transition: all 0.2s;">
        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 12px;">
            <div style="width: 48px; height: 48px; background: #eff6ff; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i data-feather="git-branch" style="color: #3b82f6; width: 24px; height: 24px;"></i>
            </div>
            <h3 style="margin: 0; font-size: 1.1em; color: var(--text-dark);">Navigation Flow</h3>
        </div>
        <p style="margin: 0; color: var(--text-muted); font-size: 0.9em; line-height: 1.5;">
            See how users navigate between pages. Track internal link clicks, popular paths, and user journeys.
        </p>
        <div style="margin-top: 15px; color: #3b82f6; font-weight: 600; font-size: 0.9em; display: flex; align-items: center; gap: 5px;">
            View Navigation Analytics <i data-feather="arrow-right" style="width: 16px; height: 16px;"></i>
        </div>
    </a>
    
    <a href="<?= BASE_URL ?>/admin/analytics/rotation" class="quick-card" style="text-decoration: none; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-left: 4px solid #059669; transition: all 0.2s;">
        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 12px;">
            <div style="width: 48px; height: 48px; background: #d1f4e0; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i data-feather="repeat" style="color: #059669; width: 24px; height: 24px;"></i>
            </div>
            <h3 style="margin: 0; font-size: 1.1em; color: var(--text-dark);">Rotation Stats</h3>
        </div>
        <p style="margin: 0; color: var(--text-muted); font-size: 0.9em; line-height: 1.5;">
            Track which content variations are shown and how they perform each month.
        </p>
        <div style="margin-top: 15px; color: #059669; font-weight: 600; font-size: 0.9em; display: flex; align-items: center; gap: 5px;">
            View Rotation Analytics <i data-feather="arrow-right" style="width: 16px; height: 16px;"></i>
        </div>
    </a>
    
    <a href="<?= BASE_URL ?>/admin/analytics/crawl" class="quick-card" style="text-decoration: none; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-left: 4px solid #f59e0b; transition: all 0.2s;">
        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 12px;">
            <div style="width: 48px; height: 48px; background: #fef3c7; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i data-feather="zap" style="color: #f59e0b; width: 24px; height: 24px;"></i>
            </div>
            <h3 style="margin: 0; font-size: 1.1em; color: var(--text-dark);">Crawl Analysis</h3>
        </div>
        <p style="margin: 0; color: var(--text-muted); font-size: 0.9em; line-height: 1.5;">
            Monitor how often search engines crawl your pages and identify stale content.
        </p>
        <div style="margin-top: 15px; color: #f59e0b; font-weight: 600; font-size: 0.9em; display: flex; align-items: center; gap: 5px;">
            View Crawl Analytics <i data-feather="arrow-right" style="width: 16px; height: 16px;"></i>
        </div>
    </a>
</div>

<style>
.quick-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.12) !important;
}
</style>

<!-- Top Performers -->
<div class="top-performers">
    <h2>Top Performing Pages</h2>
    <div class="performers-grid">
        <?php foreach (array_slice($stats['top_performers'], 0, 5) as $performer): ?>
        <div class="performer-card">
            <div class="performer-name">
                <a href="<?= BASE_URL ?>/admin/analytics/page/<?= e($performer['page_slug']) ?>">
                    <?= e($performer['page_slug']) ?>
                </a>
            </div>
            <div class="performer-stats">
                <div class="stat">
                    <span class="stat-label">CTR</span>
                    <span class="stat-value"><?= $performer['ctr'] ?>%</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Visits</span>
                    <span class="stat-value"><?= number_format($performer['visits']) ?></span>
                </div>
                <div class="stat">
                    <span class="stat-label">Clicks</span>
                    <span class="stat-value"><?= number_format($performer['clicks']) ?></span>
                </div>
            </div>
        </div>
        <?php endforeach; ?>
    </div>
</div>

<!-- Language Statistics -->
<?php if (!empty($stats['language_stats'])): ?>
<div class="language-stats">
    <h2>Language Distribution</h2>
    <div class="lang-cards">
        <?php foreach ($stats['language_stats'] as $langStat): ?>
        <div class="lang-card">
            <div class="lang-name"><?= strtoupper($langStat['language']) ?></div>
            <div class="lang-metrics">
                <div class="metric">
                    <span class="metric-value"><?= number_format($langStat['visits']) ?></span>
                    <span class="metric-label">Visits</span>
                </div>
                <div class="metric">
                    <span class="metric-value"><?= number_format($langStat['clicks']) ?></span>
                    <span class="metric-label">Clicks</span>
                </div>
                <div class="metric">
                    <span class="metric-value"><?= $langStat['unique_pages'] ?></span>
                    <span class="metric-label">Pages</span>
                </div>
            </div>
        </div>
        <?php endforeach; ?>
    </div>
</div>
<?php endif; ?>

<!-- Charts -->
<div class="chart-container">
    <div class="chart-box">
        <h2>Monthly Visits</h2>
        <canvas id="visitsChart"></canvas>
    </div>
    
    <div class="chart-box">
        <h2>Monthly Clicks</h2>
        <canvas id="clicksChart"></canvas>
    </div>
</div>

<!-- Detailed Page Stats Table -->
<div style="margin-top: 40px;">
    <h2>Page Statistics (Last <?= $stats['months'] ?> Months)</h2>
    <table class="data-table">
        <thead>
            <tr>
                <th>Page</th>
                <th>Language</th>
                <th>Visits</th>
                <th>Clicks</th>
                <th>CTR</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <?php foreach ($stats['page_stats'] as $page): 
                $pageCtr = $page['visits'] > 0 ? number_format(($page['clicks'] / $page['visits']) * 100, 2) : 0;
            ?>
            <tr>
                <td>
                    <a href="<?= BASE_URL ?>/admin/analytics/page/<?= e($page['page_slug']) ?>">
                        <?= e($page['page_slug']) ?>
                    </a>
                </td>
                <td><span class="badge"><?= strtoupper($page['language']) ?></span></td>
                <td><?= number_format($page['visits']) ?></td>
                <td><?= number_format($page['clicks']) ?></td>
                <td>
                    <span class="ctr-badge <?= $pageCtr > 5 ? 'high' : ($pageCtr > 2 ? 'medium' : 'low') ?>">
                        <?= $pageCtr ?>%
                    </span>
                </td>
                <td>
                    <a href="<?= BASE_URL ?>/admin/analytics/page/<?= e($page['page_slug']) ?>" 
                       class="btn btn-sm">
                        <i data-feather="eye"></i> View Details
                    </a>
                </td>
            </tr>
            <?php endforeach; ?>
        </tbody>
    </table>
</div>

<?php endif; ?>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script>
const visitsData = <?= json_encode($stats['visits_chart']) ?>;
const clicksData = <?= json_encode($stats['clicks_chart']) ?>;

// Visits Chart
new Chart(document.getElementById('visitsChart'), {
    type: 'line',
    data: {
        labels: visitsData.labels,
        datasets: [{
            label: 'Visits',
            data: visitsData.values,
            borderColor: '#303034',
            backgroundColor: 'rgba(48, 48, 52, 0.1)',
            tension: 0.3,
            fill: true
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: false }
        },
        scales: {
            y: { beginAtZero: true }
        }
    }
});

// Clicks Chart
new Chart(document.getElementById('clicksChart'), {
    type: 'line',
    data: {
        labels: clicksData.labels,
        datasets: [{
            label: 'Clicks',
            data: clicksData.values,
            borderColor: '#059669',
            backgroundColor: 'rgba(5, 150, 105, 0.1)',
            tension: 0.3,
            fill: true
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: false }
        },
        scales: {
            y: { beginAtZero: true }
        }
    }
});
</script>
<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>

================================================================================

# navigation.php
# path: .\views\admin\analytics\navigation.php

<?php 
// path: ./views/admin/analytics/navigation.php
$pageName = 'analytics/navigation';
require BASE_PATH . '/views/admin/layout/header.php'; 
?>

<div class="page-header">
    <h1><i data-feather="git-branch"></i> Internal Navigation Analytics</h1>
    <div class="header-actions">
        <select onchange="window.location='?months='+this.value" class="btn">
            <option value="1" <?= $months == 1 ? 'selected' : '' ?>>Last Month</option>
            <option value="3" <?= $months == 3 ? 'selected' : '' ?>>Last 3 Months</option>
            <option value="6" <?= $months == 6 ? 'selected' : '' ?>>Last 6 Months</option>
        </select>
        <a href="<?= BASE_URL ?>/admin/analytics" class="btn btn-secondary">
            <i data-feather="arrow-left"></i> Back to Analytics
        </a>
    </div>
</div>

<div class="info-banner">
    <strong><i data-feather="info"></i> Navigation Tracking:</strong> 
    This shows how users navigate between pages on your site. Use this data to optimize your internal linking structure and improve user flow.
</div>

<?php if (empty($navigation_flow) && empty($popular_paths)): ?>
    <div class="empty-state">
        <h2>No Navigation Data Yet</h2>
        <p>Internal link tracking will show data once users start navigating between pages.</p>
    </div>
<?php else: ?>

<!-- Popular Navigation Paths -->
<div class="crawl-table-container">
    <h2><i data-feather="trending-up"></i> Most Popular Navigation Paths</h2>
    
    <table class="data-table">
        <thead>
            <tr>
                <th>From Page</th>
                <th><i data-feather="arrow-right"></i></th>
                <th>To Page</th>
                <th>Total Clicks</th>
                <th>Active Months</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <?php foreach ($popular_paths as $path): ?>
            <tr>
                <td>
                    <a href="<?= BASE_URL ?>/<?= e($path['from_slug']) ?>" target="_blank">
                        <i data-feather="external-link"></i> <?= e($path['from_slug']) ?>
                    </a>
                </td>
                <td style="text-align: center; color: #6b7280;">
                    <i data-feather="arrow-right"></i>
                </td>
                <td>
                    <a href="<?= BASE_URL ?>/<?= e($path['to_slug']) ?>" target="_blank">
                        <i data-feather="external-link"></i> <?= e($path['to_slug']) ?>
                    </a>
                </td>
                <td><strong><?= number_format($path['clicks']) ?></strong> clicks</td>
                <td><?= $path['active_months'] ?> month(s)</td>
                <td>
                    <a href="<?= BASE_URL ?>/admin/analytics/page/<?= e($path['from_slug']) ?>" 
                       class="btn btn-sm">
                        <i data-feather="bar-chart-2"></i> View Source
                    </a>
                </td>
            </tr>
            <?php endforeach; ?>
        </tbody>
    </table>
</div>

<!-- Link Effectiveness -->
<?php if (!empty($link_effectiveness)): ?>
<div class="crawl-table-container">
    <h2><i data-feather="percent"></i> Link Effectiveness (Click-Through Rate)</h2>
    <p style="color: #6b7280; margin-bottom: 15px;">
        Shows what percentage of page visitors click each internal link
    </p>
    
    <table class="data-table">
        <thead>
            <tr>
                <th>From Page</th>
                <th>To Page</th>
                <th>Link Clicks</th>
                <th>Page Visits</th>
                <th>CTR</th>
                <th>Performance</th>
            </tr>
        </thead>
        <tbody>
            <?php foreach ($link_effectiveness as $link): 
                $ctr = $link['click_through_rate'];
                $performance = $ctr >= 10 ? 'Excellent' : ($ctr >= 5 ? 'Good' : ($ctr >= 2 ? 'Fair' : 'Poor'));
                $badgeClass = $ctr >= 10 ? 'badge-success' : ($ctr >= 5 ? 'badge' : 'badge-danger');
            ?>
            <tr>
                <td><?= e($link['from_slug']) ?></td>
                <td><?= e($link['to_slug']) ?></td>
                <td><?= number_format($link['link_clicks']) ?></td>
                <td><?= number_format($link['from_page_visits']) ?></td>
                <td><strong><?= $ctr ?>%</strong></td>
                <td>
                    <span class="badge <?= $badgeClass ?>">
                        <?= $performance ?>
                    </span>
                </td>
            </tr>
            <?php endforeach; ?>
        </tbody>
    </table>
</div>
<?php endif; ?>

<!-- Navigation Funnels -->
<?php if (!empty($navigation_funnels)): ?>
<div class="crawl-table-container">
    <h2><i data-feather="git-branch"></i> Common Navigation Sequences</h2>
    <p style="color: #6b7280; margin-bottom: 15px;">
        Shows the most common 3-step navigation paths users take
    </p>
    
    <table class="data-table">
        <thead>
            <tr>
                <th>Step 1</th>
                <th><i data-feather="arrow-right"></i></th>
                <th>Step 2</th>
                <th><i data-feather="arrow-right"></i></th>
                <th>Step 3</th>
                <th>Occurrences</th>
            </tr>
        </thead>
        <tbody>
            <?php foreach ($navigation_funnels as $funnel): ?>
            <tr>
                <td><?= e($funnel['step1']) ?></td>
                <td style="text-align: center;"><i data-feather="arrow-right"></i></td>
                <td><?= e($funnel['step2']) ?></td>
                <td style="text-align: center;"><i data-feather="arrow-right"></i></td>
                <td><?= e($funnel['step3']) ?></td>
                <td><strong><?= number_format($funnel['occurrences']) ?></strong> times</td>
            </tr>
            <?php endforeach; ?>
        </tbody>
    </table>
</div>
<?php endif; ?>

<!-- Recommendations Panel -->
<div class="recommendations-panel">
    <h2><i data-feather="zap"></i> Optimization Recommendations</h2>
    
    <?php
    // Find pages with low CTR
    $lowCtrLinks = array_filter($link_effectiveness, function($link) {
        return $link['click_through_rate'] < 2 && $link['link_clicks'] > 10;
    });
    ?>
    
    <?php if (!empty($lowCtrLinks)): ?>
    <div class="recommendation warning">
        <div class="rec-icon"><i data-feather="alert-triangle"></i></div>
        <div class="rec-content">
            <h3>Low-Performing Links Detected</h3>
            <p><strong>Issue:</strong> <?= count($lowCtrLinks) ?> internal links have click-through rates below 2%.</p>
            <p><strong>Action:</strong></p>
            <ul>
                <li>Make links more prominent with better positioning</li>
                <li>Use more compelling anchor text</li>
                <li>Add visual cues (buttons, icons)</li>
                <li>Consider if the linked content is relevant to visitors</li>
            </ul>
        </div>
    </div>
    <?php endif; ?>
    
    <div class="recommendation info">
        <div class="rec-icon"><i data-feather="git-branch"></i></div>
        <div class="rec-content">
            <h3>Optimize Navigation Flow</h3>
            <ul>
                <li><strong>High-performing paths:</strong> Add more links to popular destinations from your top pages</li>
                <li><strong>Orphaned pages:</strong> Check pages with few inbound links - they may need better promotion</li>
                <li><strong>Common sequences:</strong> The navigation funnels show natural user journeys - optimize these paths</li>
                <li><strong>CTR optimization:</strong> Links with 10%+ CTR are performing excellently - study what makes them effective</li>
            </ul>
        </div>
    </div>
    
    <?php if (!empty($navigation_funnels)): ?>
    <div class="recommendation success">
        <div class="rec-icon"><i data-feather="check-circle"></i></div>
        <div class="rec-content">
            <h3>Strong Navigation Patterns Identified</h3>
            <p>Users are following clear navigation paths through your site. This indicates good information architecture. Consider:</p>
            <ul>
                <li>Adding quick links for the most common sequences</li>
                <li>Creating related content sections based on these patterns</li>
                <li>Using breadcrumbs that reflect common navigation paths</li>
            </ul>
        </div>
    </div>
    <?php endif; ?>
</div>

<?php endif; ?>

<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>

================================================================================

# page_detail.php
# path: .\views\admin\analytics\page_detail.php

<?php
// path: ./views/admin/analytics/page_detail.php
$pageName = 'analytics/page_detail';
require BASE_PATH . '/views/admin/layout/header.php';
?>

<div class="page-header">
    <h1>Page Analytics: <?= e($page['slug']) ?></h1>
    <div class="header-actions">
        <a href="<?= BASE_URL ?>/<?= e($page['slug']) ?>" target="_blank" class="btn">
            <i data-feather="eye"></i> View Page
        </a>
        <a href="<?= BASE_URL ?>/admin/analytics" class="btn btn-secondary">
            <i data-feather="arrow-left"></i> Back to Analytics
        </a>
    </div>
</div>

<div class="info-banner">
    <strong><i data-feather="file-text"></i> Page Overview:</strong>
    This page shows how a single slug performs in terms of visits, clicks,
    crawl freshness, and content rotation effectiveness.
</div>

<!-- PAGE META SUMMARY -->
<div class="crawl-summary-cards">
    <div class="summary-card daily">
        <div class="card-icon"><i data-feather="globe"></i></div>
        <div class="card-content">
            <div class="card-number"><?= e($page['slug']) ?></div>
            <div class="card-label">Slug</div>
            <div class="card-desc">Canonical page identifier</div>
        </div>
    </div>

    <div class="summary-card weekly">
        <div class="card-icon"><i data-feather="refresh-cw"></i></div>
        <div class="card-content">
            <div class="card-number"><?= $page['enable_rotation'] ? 'ON' : 'OFF' ?></div>
            <div class="card-label">Content Rotation</div>
            <div class="card-desc">
                <?= $page['enable_rotation'] ? 'Freshness enabled' : 'Static content' ?>
            </div>
        </div>
    </div>

    <div class="summary-card monthly">
        <div class="card-icon"><i data-feather="volume-2"></i></div>
        <div class="card-content">
            <div class="card-number"><?= $page['is_published'] ? 'Published' : 'Hidden' ?></div>
            <div class="card-label">Visibility</div>
            <div class="card-desc">Search engine access</div>
        </div>
    </div>
</div>

<!-- PERFORMANCE TRENDS -->
<div class="crawl-table-container">
    <h2>Month-over-Month Performance</h2>

    <table class="data-table">
        <thead>
            <tr>
                <th>Period</th>
                <th>Visits</th>
                <th>Clicks</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Current Month</strong></td>
                <td><?= number_format($trends['current']['visits']) ?></td>
                <td><?= number_format($trends['current']['clicks']) ?></td>
            </tr>
            <tr>
                <td><strong>Previous Month</strong></td>
                <td><?= number_format($trends['previous']['visits']) ?></td>
                <td><?= number_format($trends['previous']['clicks']) ?></td>
            </tr>
        </tbody>
    </table>

    <p style="margin-top:15px;">
        <strong>Change:</strong><br>
        Visits: <?= $trends['changes']['visits'] ?>%<br>
        Clicks: <?= $trends['changes']['clicks'] ?>%
    </p>
</div>

<!-- ROTATION IMPACT -->
<div class="crawl-table-container">
    <h2>Rotation Impact</h2>

    <?php if (empty($rotation_comparison)): ?>
        <div class="empty-state">
            <p>No rotation data recorded for this page.</p>
        </div>
    <?php else: ?>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Month</th>
                    <th>Visits</th>
                    <th>Clicks</th>
                    <th>Rotation Active</th>
                    <th>Times Shown</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($rotation_comparison as $row): ?>
                <tr>
                    <td><?= $row['year'] ?>-<?= str_pad($row['month'], 2, '0', STR_PAD_LEFT) ?></td>
                    <td><?= number_format($row['total_visits']) ?></td>
                    <td><?= number_format($row['total_clicks']) ?></td>
                    <td>
                        <span class="status-badge <?= $row['rotation_month'] ? 'status-daily' : 'status-rare' ?>">
                            <?= $row['rotation_month'] ? 'Yes' : 'No' ?>
                        </span>
                    </td>
                    <td><?= (int)($row['times_shown'] ?? 0) ?></td>
                </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    <?php endif; ?>
</div>

<!-- DAILY ACTIVITY -->
<div class="crawl-table-container">
    <h2>Daily Activity (Last 30 Days)</h2>

    <?php if (empty($daily_activity)): ?>
        <p>No activity recorded.</p>
    <?php else: ?>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Visits</th>
                    <th>Clicks</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($daily_activity as $row): ?>
                <tr>
                    <td><?= date('M d, Y', strtotime($row['date'])) ?></td>
                    <td><?= number_format($row['visits']) ?></td>
                    <td><?= number_format($row['clicks']) ?></td>
                </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    <?php endif; ?>
</div>

<!-- RECOMMENDATIONS -->
<div class="recommendations-panel">
    <h2>SEO & Crawl Recommendations</h2>

    <?php if (!$page['enable_rotation']): ?>
    <div class="recommendation warning">
        <div class="rec-icon"><i data-feather="alert-circle"></i></div>
        <div class="rec-content">
            <h3>Content rotation disabled</h3>
            <p>
                <strong>Action:</strong> Enable content rotation to increase crawl frequency
                and signal freshness to Google.
            </p>
        </div>
    </div>
    <?php endif; ?>

    <div class="recommendation info">
        <div class="rec-icon"><i data-feather="zap"></i></div>
        <div class="rec-content">
            <h3>Improve performance</h3>
            <ul>
                <li>Rotate titles and descriptions monthly</li>
                <li>Link to this page from high-traffic pages</li>
                <li>Update JSON-LD when content changes</li>
                <li>Request crawl after major rotation updates</li>
            </ul>
        </div>
    </div>
</div>

<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>


================================================================================

# rotation.php
# path: .\views\admin\analytics\rotation.php

<?php 
// path: ./views/admin/analytics/rotation.php
$pageName = 'analytics/rotation';
require BASE_PATH . '/views/admin/layout/header.php'; 
?>

<div class="page-header">
    <h1>Content Rotation Analytics</h1>
    <div class="header-actions">
        <select onchange="window.location='?months='+this.value" class="btn">
            <option value="1" <?= $months == 1 ? 'selected' : '' ?>>Last Month</option>
            <option value="3" <?= $months == 3 ? 'selected' : '' ?>>Last 3 Months</option>
            <option value="6" <?= $months == 6 ? 'selected' : '' ?>>Last 6 Months</option>
            <option value="12" <?= $months == 12 ? 'selected' : '' ?>>Last 12 Months</option>
        </select>
        <a href="<?= BASE_URL ?>/admin/analytics" class="btn btn-secondary">
            <i data-feather="arrow-left"></i> Back to Analytics
        </a>
    </div>
</div>

<div class="info-banner">
    <strong><i data-feather="bar-chart-2"></i> What This Shows:</strong> This page tracks which rotation content variations are actually displayed to visitors. 
    Use this data to identify your best-performing seasonal content and optimize your rotation strategy.
</div>

<?php if (empty($effectiveness)): ?>
    <div class="empty-state">
        <h2>No Rotation Data Yet</h2>
        <p>Start tracking rotation effectiveness by:</p>
        <ol>
            <li>Enabling rotation on pages</li>
            <li>Creating content for different months</li>
            <li>Waiting for visitors to view the rotated content</li>
        </ol>
        <a href="<?= BASE_URL ?>/admin/rotations/overview" class="btn btn-primary">
            <i data-feather="settings"></i> Set Up Rotations
        </a>
    </div>
<?php else: ?>

<div class="rotation-effectiveness-grid">
    <?php
    $groupedData = [];
    foreach ($effectiveness as $row) {
        $pageSlug = $row['page_slug'];
        if (!isset($groupedData[$pageSlug])) {
            $groupedData[$pageSlug] = [
                'title' => $row['title_ru'],
                'rotations' => []
            ];
        }
        $groupedData[$pageSlug]['rotations'][] = $row;
    }
    
    foreach ($groupedData as $slug => $data):
    ?>
    
    <div class="effectiveness-card">
        <div class="card-header">
            <h2><?= e($data['title']) ?></h2>
            <span class="slug-badge"><?= e($slug) ?></span>
        </div>
        
        <div class="rotation-timeline">
            <?php foreach ($data['rotations'] as $rotation): 
                $monthName = date('F', mktime(0, 0, 0, $rotation['rotation_month'], 1));
                $isCurrentMonth = $rotation['rotation_month'] == date('n');
                $total_visits = $rotation['total_visits'] ?? 0;
                $total_clicks = $rotation['total_clicks'] ?? 0;
                $ctr = $total_visits > 0 ? round(($total_clicks / $total_visits) * 100, 2) : 0;
            ?>
            
            <div class="rotation-item <?= $isCurrentMonth ? 'current' : '' ?>">
                <div class="rotation-month">
                    <?= $monthName ?>
                    <?php if ($isCurrentMonth): ?>
                    <span class="current-badge"><i data-feather="clock"></i> NOW</span>
                    <?php endif; ?>
                </div>
                
                <div class="rotation-metrics">
                    <div class="metric-row">
                        <span class="metric-label"><i data-feather="eye"></i> Times Shown:</span>
                        <span class="metric-value"><?= number_format($rotation['times_shown']) ?></span>
                    </div>
                    
                    <div class="metric-row">
                        <span class="metric-label"><i data-feather="calendar"></i> Unique Days:</span>
                        <span class="metric-value"><?= $rotation['unique_days'] ?></span>
                    </div>
                    
                    <?php if ($total_visits > 0): ?>
                    <div class="metric-row">
                        <span class="metric-label"><i data-feather="bar-chart"></i> Visits:</span>
                        <span class="metric-value"><?= number_format($total_visits) ?></span>
                    </div>
                    
                    <div class="metric-row">
                        <span class="metric-label"><i data-feather="mouse-pointer"></i> Clicks:</span>
                        <span class="metric-value"><?= number_format($total_clicks) ?></span>
                    </div>
                    
                    <div class="metric-row">
                        <span class="metric-label"><i data-feather="percent"></i> CTR:</span>
                        <span class="metric-value highlight"><?= $ctr ?>%</span>
                    </div>
                    <?php endif; ?>
                </div>
                
                <div class="rotation-actions">
                    <a href="<?= BASE_URL ?>/admin/rotations/manage/<?= $rotation['page_id'] ?? '' ?>" 
                       class="btn btn-sm">
                        <i data-feather="edit"></i> Edit Rotations
                    </a>
                </div>
            </div>
            
            <?php endforeach; ?>
        </div>
        
        <div class="card-summary">
            <?php
            $totalShown = array_sum(array_column($data['rotations'], 'times_shown'));
            $avgPerMonth = count($data['rotations']) > 0 ? round($totalShown / count($data['rotations'])) : 0;
            $monthsCovered = count($data['rotations']);
            ?>
            <div class="summary-stat">
                <span class="stat-label"><i data-feather="eye"></i> Total Times Shown:</span>
                <span class="stat-value"><?= number_format($totalShown) ?></span>
            </div>
            <div class="summary-stat">
                <span class="stat-label"><i data-feather="bar-chart-2"></i> Avg per Month:</span>
                <span class="stat-value"><?= number_format($avgPerMonth) ?></span>
            </div>
            <div class="summary-stat">
                <span class="stat-label"><i data-feather="calendar"></i> Months Covered:</span>
                <span class="stat-value"><?= $monthsCovered ?>/12</span>
            </div>
        </div>
    </div>
    
    <?php endforeach; ?>
</div>

<?php endif; ?>


<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>


================================================================================

# edit.php
# path: .\views\admin\faqs\edit.php

<?php 
// path: ./views/admin/faqs/edit.php
require BASE_PATH . '/views/admin/layout/header.php'; 
?>

<h1><?= $faq ? 'Edit FAQ' : 'Create FAQ' ?></h1>

<form method="POST" action="<?= BASE_URL ?>/admin/faqs/save" class="admin-form">
    <?php if ($faq): ?>
        <input type="hidden" name="id" value="<?= $faq['id'] ?>">
    <?php endif; ?>

    <div class="form-group">
        <label>Page*</label>
        <select name="page_slug" required>
            <option value="">Select Page</option>
            <?php foreach ($pages as $page): ?>
            <option value="<?= e($page['slug']) ?>" <?= ($faq['page_slug'] ?? '') === $page['slug'] ? 'selected' : '' ?>>
                <?= e($page['slug']) ?> - <?= e($page['title_ru']) ?>
            </option>
            <?php endforeach; ?>
        </select>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label>Question (RU)*</label>
            <input type="text" name="question_ru" value="<?= $faq['question_ru'] ?? '' ?>" required>
        </div>
        <div class="form-group">
            <label>Question (UZ)*</label>
            <input type="text" name="question_uz" value="<?= $faq['question_uz'] ?? '' ?>" required>
        </div>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label>Answer (RU)*</label>
            <textarea name="answer_ru" rows="3" required><?= $faq['answer_ru'] ?? '' ?></textarea>
        </div>
        <div class="form-group">
            <label>Answer (UZ)*</label>
            <textarea name="answer_uz" rows="3" required><?= $faq['answer_uz'] ?? '' ?></textarea>
        </div>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label>Sort Order</label>
            <input type="number" name="sort_order" value="<?= $faq['sort_order'] ?? 0 ?>">
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" name="is_active" <?= ($faq['is_active'] ?? 1) ? 'checked' : '' ?>>
                Active
            </label>
        </div>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary"><?= $faq ? 'Update FAQ' : 'Create FAQ' ?></button>
        <a href="<?= BASE_URL ?>/admin/faqs" class="btn btn-secondary">Cancel</a>
    </div>
</form>

<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>


================================================================================

# list.php
# path: .\views\admin\faqs\list.php

<?php 
// path: ./views/admin/faqs/list.php
require BASE_PATH . '/views/admin/layout/header.php'; 
?>

<div class="page-header">
    <h1>FAQs</h1>
    <div class="btn-group">
        <a href="<?= BASE_URL ?>/admin/faqs/new" class="btn btn-primary">
            <i data-feather="plus"></i> Add New FAQ
        </a>
        <button onclick="showUploadModal()" class="btn">
            <i data-feather="upload"></i> Bulk Upload
        </button>
        <a href="<?= BASE_URL ?>/admin/faqs/download-template" class="btn btn-secondary">
            <i data-feather="download"></i> Download Template
        </a>
    </div>
</div>

<table class="data-table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Page</th>
            <th>Question (RU)</th>
            <th>Order</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <?php foreach ($faqs as $faq): ?>
        <tr>
            <td><?= $faq['id'] ?></td>
            <td><?= e($faq['page_slug']) ?></td>
            <td><?= e(substr($faq['question_ru'], 0, 60)) ?>...</td>
            <td><?= $faq['sort_order'] ?></td>
            <td>
                <span class="badge <?= $faq['is_active'] ? 'badge-success' : 'badge-danger' ?>">
                    <?= $faq['is_active'] ? 'Active' : 'Inactive' ?>
                </span>
            </td>
            <td>
                <a href="<?= BASE_URL ?>/admin/faqs/edit/<?= $faq['id'] ?>" class="btn btn-sm">
                    <i data-feather="edit"></i> Edit
                </a>
                <form method="POST" action="<?= BASE_URL ?>/admin/faqs/delete" style="display:inline;" 
                      onsubmit="return confirm('Delete this FAQ?')">
                    <input type="hidden" name="id" value="<?= $faq['id'] ?>">
                    <button type="submit" class="btn btn-sm btn-danger">
                        <i data-feather="trash-2"></i> Delete
                    </button>
                </form>
            </td>
        </tr>
        <?php endforeach; ?>
    </tbody>
</table>

<!-- Upload Modal -->
<div id="upload-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i data-feather="upload"></i> Bulk Upload FAQs</h2>
            <button onclick="closeUploadModal()" class="close-btn"><i data-feather="x"></i></button>
        </div>
        
        <form method="POST" action="<?= BASE_URL ?>/admin/faqs/bulk-upload" enctype="multipart/form-data">
            <div class="help-text" style="margin-bottom: 20px;">
                <strong>Supported formats:</strong> CSV, JSON<br>
                <strong>Required fields:</strong> page_slug, question_ru, answer_ru<br>
                <strong>Optional fields:</strong> question_uz, answer_uz, sort_order, is_active
            </div>
            
            <div class="form-group">
                <label>Select File (CSV or JSON):</label>
                <input type="file" name="file" accept=".csv,.json" required>
            </div>
            
            <details style="margin: 20px 0;">
                <summary style="cursor: pointer; font-weight: 600; margin-bottom: 10px;">
                    JSON Format Example
                </summary>
                <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 12px;">[
  {
    "page_slug": "home",
    "question_ru": "Какой вопрос?",
    "question_uz": "Qanday savol?",
    "answer_ru": "Это ответ",
    "answer_uz": "Bu javob",
    "sort_order": 0,
    "is_active": 1
  }
]</pre>
            </details>
            
            <div class="modal-actions">
                <button type="submit" class="btn btn-primary">
                    <i data-feather="upload"></i> Upload
                </button>
                <button type="button" onclick="closeUploadModal()" class="btn btn-secondary">
                    <i data-feather="x-circle"></i> Cancel
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function showUploadModal() {
    document.getElementById('upload-modal').style.display = 'flex';
    feather.replace();
}

function closeUploadModal() {
    document.getElementById('upload-modal').style.display = 'none';
}
</script>

<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>

================================================================================

# footer.php
# path: .\views\admin\layout\footer.php


            </div>
        </main>
    </div>
    <script src="<?= BASE_URL ?>/js/admin.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script>
      feather.replace({ class: 'feather-icon' });
    </script>
</body>
</html>

================================================================================

# header.php
# path: .\views\admin\layout\header.php

<?php
// path: ./views/admin/layout/header.php
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="icon" type="image/x-icon" href="https://test.kuplyu-tashkent.uz/css/favicon.ico">
    <link rel="stylesheet" href="<?= BASE_URL ?>/css/admin.css">
    <?php
    if (!empty($pageName)) {
        $cssFile = "admin/{$pageName}.css";
        $cssPath = BASE_PATH . "/public/css/{$cssFile}";

        if (file_exists($cssPath)) {
            echo '<link rel="stylesheet" href="' . BASE_URL . "/css/{$cssFile}" . '">';
        }
    }
    ?>
</head>
<body>
    <div class="admin-wrapper">
        <button class="sidebar-toggle" aria-label="Toggle sidebar">
                <i data-feather="chevron-left"></i>
            </button>
        <aside class="sidebar">
            <!-- Toggle button INSIDE sidebar -->
            
            
            <div class="logo">
                <h2>Admin Panel</h2>
            </div>
            <nav class="admin-nav">
                <a href="<?= BASE_URL ?>/admin/dashboard" class="<?= strpos($_SERVER['REQUEST_URI'], '/dashboard') !== false ? 'active' : '' ?>">
                    <i data-feather="bar-chart-2"></i> Dashboard
                </a>
                
                <div class="nav-section">
                    <div class="nav-section-title">Content</div>
                    <a href="<?= BASE_URL ?>/admin/pages" class="<?= strpos($_SERVER['REQUEST_URI'], '/pages') !== false ? 'active' : '' ?>">
                        <i data-feather="file-text"></i> Pages
                    </a>
                    <a href="<?= BASE_URL ?>/admin/rotations/overview" class="<?= strpos($_SERVER['REQUEST_URI'], '/rotations') !== false ? 'active' : '' ?>">
                        <i data-feather="repeat"></i> Content Rotation
                    </a>
                    <a href="<?= BASE_URL ?>/admin/faqs" class="<?= strpos($_SERVER['REQUEST_URI'], '/faqs') !== false ? 'active' : '' ?>">
                        <i data-feather="help-circle"></i> FAQs
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Analytics</div>
                    <a href="<?= BASE_URL ?>/admin/analytics" class="<?= strpos($_SERVER['REQUEST_URI'], '/analytics') !== false && strpos($_SERVER['REQUEST_URI'], '/rotation') === false && strpos($_SERVER['REQUEST_URI'], '/crawl') === false && strpos($_SERVER['REQUEST_URI'], '/navigation') === false ? 'active' : '' ?>">
                        <i data-feather="trending-up"></i> Overview
                    </a>
                    <a href="<?= BASE_URL ?>/admin/analytics/rotation" class="<?= strpos($_SERVER['REQUEST_URI'], '/analytics/rotation') !== false ? 'active' : '' ?>">
                        <i data-feather="bar-chart"></i> Rotation Stats
                    </a>
                    <a href="<?= BASE_URL ?>/admin/analytics/navigation" class="<?= strpos($_SERVER['REQUEST_URI'], '/analytics/navigation') !== false ? 'active' : '' ?>">
                        <i data-feather="git-branch"></i> Navigation Flow
                    </a>
                    <a href="<?= BASE_URL ?>/admin/analytics/crawl" class="<?= strpos($_SERVER['REQUEST_URI'], '/analytics/crawl') !== false ? 'active' : '' ?>">
                        <i data-feather="zap"></i> Crawl Analysis
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Settings</div>
                    <a href="<?= BASE_URL ?>/admin/seo" class="<?= strpos($_SERVER['REQUEST_URI'], '/seo') !== false && strpos($_SERVER['REQUEST_URI'], '/sitemap') === false ? 'active' : '' ?>">
                        <i data-feather="search"></i> SEO Settings
                    </a>
                    <a href="<?= BASE_URL ?>/admin/seo/sitemap" class="<?= strpos($_SERVER['REQUEST_URI'], '/seo/sitemap') !== false ? 'active' : '' ?>">
                        <i data-feather="map"></i> Sitemap & Robots
                    </a>
                    <a href="<?= BASE_URL ?>/admin/media" class="<?= strpos($_SERVER['REQUEST_URI'], '/media') !== false ? 'active' : '' ?>">
                        <i data-feather="image"></i> Media
                    </a>
                </div>
                <a href="<?= BASE_URL ?>/deploy.php" class="<?= strpos($_SERVER['REQUEST_URI'], '/deploy.php') !== false ? 'active' : '' ?>">
                    <i data-feather="zap"></i> Deploy
                </a>

                <a href="<?= BASE_URL ?>/admin/logout" style="margin-top: 20px; color: #dc3545;">
                    <i data-feather="log-out"></i> Logout
                </a>
            </nav>
        </aside>
        
        <main class="admin-main">
            <div class="admin-content">
                <?php if (isset($_SESSION['success'])): ?>
                    <div class="alert alert-success"><?= e($_SESSION['success']) ?></div>
                    <?php unset($_SESSION['success']); ?>
                <?php endif; ?>
                
                <?php if (isset($_SESSION['error'])): ?>
                    <div class="alert alert-error"><?= e($_SESSION['error']) ?></div>
                    <?php unset($_SESSION['error']); ?>
                <?php endif; ?>

================================================================================

# manager.php
# path: .\views\admin\media\manager.php

<?php 
// path: ./views/admin/media/manager.php
$pageName = 'media/manager';
require BASE_PATH . '/views/admin/layout/header.php'; 
?>


<div class="page-header">
    <h1><i data-feather="image"></i> Media Manager</h1>
</div>

<div class="media-controls">
    <div class="media-filters">
        <button onclick="document.getElementById('file-input').click()" class="btn btn-primary">
            <i data-feather="upload"></i> Upload Single
        </button>
        <button onclick="document.getElementById('bulk-file-input').click()" class="btn">
            <i data-feather="upload-cloud"></i> Bulk Upload
        </button>
        <button onclick="toggleSelectMode()" id="select-mode-btn" class="btn">
            <i data-feather="check-square"></i> Select Mode
        </button>
    </div>
    
    <div style="display: flex; gap: 10px; align-items: center;">
        <input type="text" id="search-input" placeholder="Search media..." 
               oninput="filterMedia()"
               style="padding: 8px; border: 1px solid #e5e7eb; border-radius: 4px; width: 200px;">
        <select id="sort-select" onchange="sortMedia()" class="btn">
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="name">Name A-Z</option>
            <option value="size">Size (Large-Small)</option>
        </select>
    </div>
</div>

<!-- Bulk Actions Bar -->
<div class="bulk-actions" id="bulk-actions">
    <div>
        <strong id="selected-count">0</strong> items selected
    </div>
    <div class="btn-group">
        <button onclick="insertSelected()" class="btn btn-primary">
            <i data-feather="plus"></i> Insert Selected
        </button>
        <button onclick="deleteSelected()" class="btn btn-danger">
            <i data-feather="trash-2"></i> Delete Selected
        </button>
        <button onclick="clearSelection()" class="btn">
            <i data-feather="x"></i> Clear
        </button>
    </div>
</div>

<!-- Upload Forms (Hidden) -->
<form id="upload-form" style="display:none;">
    <input type="file" id="file-input" accept="image/*" onchange="uploadFile()">
</form>

<form id="bulk-upload-form" method="POST" action="<?= BASE_URL ?>/admin/media/bulk-upload" 
      enctype="multipart/form-data" style="display:none;">
    <input type="file" id="bulk-file-input" name="files[]" accept="image/*" 
           multiple onchange="this.form.submit()">
</form>

<!-- Media Grid -->
<div class="media-grid" id="media-grid">
    <?php foreach ($media as $item): ?>
    <div class="media-item" 
         data-id="<?= $item['id'] ?>"
         data-filename="<?= e($item['filename']) ?>"
         data-name="<?= e($item['original_name']) ?>"
         data-size="<?= $item['file_size'] ?>"
         data-date="<?= strtotime($item['uploaded_at']) ?>"
         onclick="selectMedia(this, event)">
        
        <input type="checkbox" class="media-checkbox" onclick="event.stopPropagation(); toggleMediaSelection(this)">
        
        <div class="media-preview">
            <img src="<?= UPLOAD_URL . e($item['filename']) ?>" 
                 alt="<?= e($item['original_name']) ?>"
                 loading="lazy">
        </div>
        
        <div class="media-info">
            <div class="media-name" title="<?= e($item['original_name']) ?>">
                <?= e($item['original_name']) ?>
            </div>
            <div class="media-meta">
                <?= number_format($item['file_size'] / 1024, 1) ?> KB
                <span style="margin: 0 5px;">•</span>
                <?= date('M d, Y', strtotime($item['uploaded_at'])) ?>
            </div>
            <div class="media-actions">
                <button onclick="event.stopPropagation(); insertSingle(<?= $item['id'] ?>)" 
                        class="btn btn-sm btn-primary" title="Insert">
                    <i data-feather="plus"></i>
                </button>
                <button onclick="event.stopPropagation(); copyUrl('<?= UPLOAD_URL . e($item['filename']) ?>')" 
                        class="btn btn-sm" title="Copy URL">
                    <i data-feather="copy"></i>
                </button>
                <button onclick="event.stopPropagation(); deleteMedia(<?= $item['id'] ?>)" 
                        class="btn btn-sm btn-danger" title="Delete">
                    <i data-feather="trash-2"></i>
                </button>
            </div>
        </div>
    </div>
    <?php endforeach; ?>
</div>

<!-- Insert Modal -->
<div class="modal" id="insert-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i data-feather="plus-circle"></i> Insert Image</h2>
            <button onclick="closeInsertModal()" class="close-btn">
                <i data-feather="x"></i>
            </button>
        </div>
        <div class="modal-body">
            <img id="insert-preview" class="insert-preview" src="" alt="Preview">
            
            <div class="insert-options">
                <div>
                    <label><strong>Size:</strong></label>
                    <div class="size-options">
                        <div class="size-option active" data-size="full" onclick="selectSize(this)">
                            <div><i data-feather="maximize"></i></div>
                            <div style="font-size: 0.85em; margin-top: 5px;">Full Size</div>
                        </div>
                        <div class="size-option" data-size="medium" onclick="selectSize(this)">
                            <div><i data-feather="square"></i></div>
                            <div style="font-size: 0.85em; margin-top: 5px;">Medium</div>
                        </div>
                        <div class="size-option" data-size="thumbnail" onclick="selectSize(this)">
                            <div><i data-feather="minimize"></i></div>
                            <div style="font-size: 0.85em; margin-top: 5px;">Thumbnail</div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <label><strong>Image URL:</strong></label>
                    <div class="copy-field">
                        <input type="text" id="image-url" readonly>
                        <button onclick="copyField('image-url')" class="btn">
                            <i data-feather="copy"></i>
                        </button>
                    </div>
                </div>
                
                <div>
                    <label><strong>HTML Code:</strong></label>
                    <div class="copy-field">
                        <input type="text" id="html-code" readonly>
                        <button onclick="copyField('html-code')" class="btn">
                            <i data-feather="copy"></i>
                        </button>
                    </div>
                </div>
                
                <div>
                    <label><strong>Markdown:</strong></label>
                    <div class="copy-field">
                        <input type="text" id="markdown-code" readonly>
                        <button onclick="copyField('markdown-code')" class="btn">
                            <i data-feather="copy"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                <button onclick="copyField('html-code')" class="btn btn-primary" style="width: 100%;">
                    <i data-feather="clipboard"></i> Copy HTML & Close
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// IMPLEMENTATION: Replace the <script> section at the bottom of views/admin/media/manager.php

    let selectMode = false;
    let selectedItems = new Set();
    let currentInsertUrl = '';
    let currentInsertName = '';

    function uploadFile() {
        const input = document.getElementById('file-input');
        const file = input.files[0];
        if (!file) return;
        
        const formData = new FormData();
        formData.append('file', file);
        
        fetch('<?= BASE_URL ?>/admin/media/upload', {
            method: 'POST',
            body: formData
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert(data.message);
            }
        })
        .catch(e => alert('Upload failed'));
    }

    function deleteMedia(id) {
        if (!confirm('Delete this image?')) return;
        
        const formData = new FormData();
        formData.append('id', id);
        
        fetch('<?= BASE_URL ?>/admin/media/delete', {
            method: 'POST',
            body: formData
        })
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                document.querySelector(`[data-id="${id}"]`).remove();
            } else {
                alert('Delete failed');
            }
        });
    }

    function copyUrl(url) {
        navigator.clipboard.writeText(url).then(() => {
            alert('URL copied to clipboard');
        });
    }

    function toggleSelectMode() {
        selectMode = !selectMode;
        const btn = document.getElementById('select-mode-btn');
        
        if (selectMode) {
            btn.classList.add('btn-primary');
            // Show all checkboxes
            document.querySelectorAll('.media-checkbox').forEach(cb => {
                cb.style.display = 'block';
            });
        } else {
            btn.classList.remove('btn-primary');
            // Hide checkboxes
            document.querySelectorAll('.media-checkbox').forEach(cb => {
                cb.style.display = 'none';
            });
            clearSelection();
        }
        
        feather.replace();
    }

    function toggleMediaSelection(checkbox) {
        const item = checkbox.closest('.media-item');
        const id = item.dataset.id;
        
        if (checkbox.checked) {
            selectedItems.add(id);
            item.classList.add('selected');
        } else {
            selectedItems.delete(id);
            item.classList.remove('selected');
        }
        
        updateBulkActions();
    }

    function selectMedia(element, event) {
        if (!selectMode) return;
        
        // Don't trigger if clicking on buttons
        if (event.target.closest('button')) return;
        
        const checkbox = element.querySelector('.media-checkbox');
        checkbox.checked = !checkbox.checked;
        toggleMediaSelection(checkbox);
    }

    function updateBulkActions() {
        const bulkActions = document.getElementById('bulk-actions');
        const count = document.getElementById('selected-count');
        
        count.textContent = selectedItems.size;
        
        if (selectedItems.size > 0) {
            bulkActions.classList.add('active');
        } else {
            bulkActions.classList.remove('active');
        }
    }

    function clearSelection() {
        selectedItems.clear();
        document.querySelectorAll('.media-checkbox').forEach(cb => {
            cb.checked = false;
            cb.style.display = 'none';
        });
        document.querySelectorAll('.media-item').forEach(item => {
            item.classList.remove('selected');
        });
        updateBulkActions();
    }

    function deleteSelected() {
        if (!confirm(`Delete ${selectedItems.size} selected images?`)) return;
        
        const promises = Array.from(selectedItems).map(id => {
            const formData = new FormData();
            formData.append('id', id);
            return fetch('<?= BASE_URL ?>/admin/media/delete', {
                method: 'POST',
                body: formData
            });
        });
        
        Promise.all(promises).then(() => {
            location.reload();
        });
    }

    function insertSingle(id) {
        const item = document.querySelector(`[data-id="${id}"]`);
        const filename = item.dataset.filename;
        const name = item.dataset.name;
        
        currentInsertUrl = '<?= UPLOAD_URL ?>' + filename;
        currentInsertName = name;
        
        showInsertModal();
    }

    function insertSelected() {
        if (selectedItems.size === 0) {
            alert('Please select images first');
            return;
        }
        
        let htmlCode = '';
        selectedItems.forEach(id => {
            const item = document.querySelector(`[data-id="${id}"]`);
            const filename = item.dataset.filename;
            const name = item.dataset.name;
            const url = '<?= UPLOAD_URL ?>' + filename;
            htmlCode += `<img src="${url}" alt="${name}">\n`;
        });
        
        navigator.clipboard.writeText(htmlCode).then(() => {
            alert(`HTML code for ${selectedItems.size} images copied to clipboard!`);
        });
    }

    function showInsertModal() {
        document.getElementById('insert-preview').src = currentInsertUrl;
        updateInsertCodes('full');
        document.getElementById('insert-modal').classList.add('active');
        feather.replace();
    }

    function closeInsertModal() {
        document.getElementById('insert-modal').classList.remove('active');
    }

    function selectSize(element) {
        document.querySelectorAll('.size-option').forEach(opt => opt.classList.remove('active'));
        element.classList.add('active');
        
        const size = element.dataset.size;
        updateInsertCodes(size);
    }

    function updateInsertCodes(size) {
        let sizeClass = '';
        let sizeStyle = '';
        
        switch(size) {
            case 'medium':
                sizeClass = ' class="img-medium"';
                sizeStyle = ' style="max-width: 600px;"';
                break;
            case 'thumbnail':
                sizeClass = ' class="img-thumbnail"';
                sizeStyle = ' style="max-width: 300px;"';
                break;
            default:
                sizeClass = '';
                sizeStyle = '';
        }
        
        document.getElementById('image-url').value = currentInsertUrl;
        document.getElementById('html-code').value = `<img src="${currentInsertUrl}" alt="${currentInsertName}"${sizeStyle}>`;
        document.getElementById('markdown-code').value = `![${currentInsertName}](${currentInsertUrl})`;
    }

    function copyField(fieldId) {
        const field = document.getElementById(fieldId);
        field.select();
        navigator.clipboard.writeText(field.value).then(() => {
            alert('Copied to clipboard!');
            if (fieldId === 'html-code') {
                closeInsertModal();
            }
        });
    }

    function filterMedia() {
        const search = document.getElementById('search-input').value.toLowerCase();
        document.querySelectorAll('.media-item').forEach(item => {
            const name = item.dataset.name.toLowerCase();
            item.style.display = name.includes(search) ? '' : 'none';
        });
    }

    function sortMedia() {
        const sortBy = document.getElementById('sort-select').value;
        const grid = document.getElementById('media-grid');
        const items = Array.from(grid.children);
        
        items.sort((a, b) => {
            switch(sortBy) {
                case 'newest':
                    return parseInt(b.dataset.date) - parseInt(a.dataset.date);
                case 'oldest':
                    return parseInt(a.dataset.date) - parseInt(b.dataset.date);
                case 'name':
                    return a.dataset.name.localeCompare(b.dataset.name);
                case 'size':
                    return parseInt(b.dataset.size) - parseInt(a.dataset.size);
            }
        });
        
        items.forEach(item => grid.appendChild(item));
    }

    // Initialize - hide checkboxes by default
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.media-checkbox').forEach(cb => {
            cb.style.display = 'none';
        });
        feather.replace();
    });

    // Close modal on outside click
    document.getElementById('insert-modal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeInsertModal();
        }
    });
</script>

<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>

================================================================================

# edit.php
# path: .\views\admin\pages\edit.php

<?php 
// path: ./views/admin/pages/edit.php
require BASE_PATH . '/views/admin/layout/header.php'; 
?>

<h1><?= $page ? 'Edit Page' : 'Create Page' ?></h1>

<form method="POST" action="<?= BASE_URL ?>/admin/pages/save" class="admin-form">
    <?php if ($page): ?>
    <input type="hidden" name="id" value="<?= $page['id'] ?>">
    <?php endif; ?>
    
    <div class="tabs">
        <button type="button" class="tab-btn active" onclick="switchTab('general')">General</button>
        <button type="button" class="tab-btn" onclick="switchTab('seo')">SEO & Meta</button>
        <button type="button" class="tab-btn" onclick="switchTab('advanced')">Advanced SEO</button>
    </div>
    
    <div id="tab-general" class="tab-content active">
        <div class="help-text">
            <strong>Template Variables:</strong> Use {{variable}} syntax. Available: {{page.title}}, {{global.phone}}, {{global.email}}, {{global.address}}, {{global.working_hours}}, {{global.site_name}}, {{date.year}}, {{date.month}}
            <br><strong>Loops:</strong> {% for item in items %}...{% endfor %}
            <br><strong>Conditionals:</strong> {% if variable %}...{% else %}...{% endif %}
        </div>
        
        <div class="form-group">
            <label>Slug (URL)*</label>
            <input type="text" name="slug" value="<?= $page['slug'] ?? '' ?>" required>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>Title (RU)*</label>
                <input type="text" name="title_ru" value="<?= $page['title_ru'] ?? '' ?>" required>
            </div>
            
            <div class="form-group">
                <label>Title (UZ)*</label>
                <input type="text" name="title_uz" value="<?= $page['title_uz'] ?? '' ?>" required>
            </div>
        </div>
        
        <div class="form-group">
            <label>Content (RU)</label>
            <textarea name="content_ru" class="tinymce"><?= $page['content_ru'] ?? '' ?></textarea>
        </div>
        
        <div class="form-group">
            <label>Content (UZ)</label>
            <textarea name="content_uz" class="tinymce"><?= $page['content_uz'] ?? '' ?></textarea>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>Sort Order</label>
                <input type="number" name="sort_order" value="<?= $page['sort_order'] ?? 0 ?>">
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" name="is_published" <?= ($page['is_published'] ?? 1) ? 'checked' : '' ?>>
                    Published
                </label>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" name="enable_rotation" <?= ($page['enable_rotation'] ?? 0) ? 'checked' : '' ?>>
                    Enable Monthly Rotation
                </label>
            </div>
        </div>
        
        <?php if ($page): ?>
        <div class="form-actions" style="margin-top: 20px;">
            <a href="<?= BASE_URL ?>/admin/rotations/manage/<?= $page['id'] ?>" class="btn btn-secondary">Manage Content Rotations</a>
        </div>
        <?php endif; ?>
    </div>
    
    <div id="tab-seo" class="tab-content">
        <p class="help-text">Leave fields empty to use global defaults. All template variables work here too.</p>
        
        <div class="form-row">
            <div class="form-group">
                <label>Meta Title (RU)</label>
                <input type="text" name="meta_title_ru" value="<?= $page['meta_title_ru'] ?? '' ?>">
            </div>
            
            <div class="form-group">
                <label>Meta Title (UZ)</label>
                <input type="text" name="meta_title_uz" value="<?= $page['meta_title_uz'] ?? '' ?>">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>Meta Keywords (RU)</label>
                <textarea name="meta_keywords_ru" rows="2"><?= $page['meta_keywords_ru'] ?? '' ?></textarea>
            </div>
            
            <div class="form-group">
                <label>Meta Keywords (UZ)</label>
                <textarea name="meta_keywords_uz" rows="2"><?= $page['meta_keywords_uz'] ?? '' ?></textarea>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>Meta Description (RU)</label>
                <textarea name="meta_description_ru" rows="3"><?= $page['meta_description_ru'] ?? '' ?></textarea>
            </div>
            
            <div class="form-group">
                <label>Meta Description (UZ)</label>
                <textarea name="meta_description_uz" rows="3"><?= $page['meta_description_uz'] ?? '' ?></textarea>
            </div>
        </div>
    </div>
    
    <div id="tab-advanced" class="tab-content">
        <p class="help-text">Advanced SEO options for social media and search engines.</p>
        
        <div class="form-row">
            <div class="form-group">
                <label>OG Title (RU) - For Facebook/Social</label>
                <input type="text" name="og_title_ru" value="<?= $page['og_title_ru'] ?? '' ?>">
            </div>
            
            <div class="form-group">
                <label>OG Title (UZ)</label>
                <input type="text" name="og_title_uz" value="<?= $page['og_title_uz'] ?? '' ?>">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>OG Description (RU)</label>
                <textarea name="og_description_ru" rows="2"><?= $page['og_description_ru'] ?? '' ?></textarea>
            </div>
            
            <div class="form-group">
                <label>OG Description (UZ)</label>
                <textarea name="og_description_uz" rows="2"><?= $page['og_description_uz'] ?? '' ?></textarea>
            </div>
        </div>
        
        <div class="form-group">
            <label>OG Image URL (Full URL)</label>
            <input type="text" name="og_image" value="<?= $page['og_image'] ?? '' ?>">
        </div>
        
        <div class="form-group">
            <label>Canonical URL (Leave empty for auto)</label>
            <input type="text" name="canonical_url" value="<?= $page['canonical_url'] ?? '' ?>">
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>JSON-LD Schema (RU)</label>
                <textarea name="jsonld_ru" rows="8" class="code"><?= $page['jsonld_ru'] ?? '' ?></textarea>
            </div>
            
            <div class="form-group">
                <label>JSON-LD Schema (UZ)</label>
                <textarea name="jsonld_uz" rows="8" class="code"><?= $page['jsonld_uz'] ?? '' ?></textarea>
            </div>
        </div>
    </div>
    
    <div class="form-actions">
        <button type="submit" class="btn btn-primary">Save Page</button>
        <a href="<?= BASE_URL ?>/admin/pages" class="btn btn-secondary">Cancel</a>
    </div>
</form>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.7.0/tinymce.min.js"></script>
<script>
tinymce.init({
    selector: '.tinymce',
    height: 400,
    menubar: false,
    plugins: 'fullscreen code',
    toolbar: 'fullscreen code',
    content_css: '<?= BASE_URL ?>/css/pages.css'
});
</script>

<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>

================================================================================

# list.php
# path: .\views\admin\pages\list.php

<?php require BASE_PATH . '/views/admin/layout/header.php'; ?>

<div class="page-header">
    <h1>Pages</h1>
    <a href="<?= BASE_URL ?>/admin/pages/new" class="btn btn-primary">Add New Page</a>
</div>

<table class="data-table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Slug</th>
            <th>Title (RU)</th>
            <th>Title (UZ)</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <?php foreach ($pages as $page): ?>
        <tr>
            <td><?= $page['id'] ?></td>
            <td><?= e($page['slug']) ?></td>
            <td><?= e($page['title_ru']) ?></td>
            <td><?= e($page['title_uz']) ?></td>
            <td>
                <span class="badge <?= $page['is_published'] ? 'badge-success' : 'badge-danger' ?>">
                    <?= $page['is_published'] ? 'Published' : 'Draft' ?>
                </span>
            </td>
            <td>
                <a href="<?= BASE_URL ?>/admin/pages/edit/<?= $page['id'] ?>" class="btn btn-sm">Edit</a>
                <a href="<?= BASE_URL ?>/<?= e($page['slug']) ?>" class="btn btn-sm" target="_blank">View</a>
                <form method="POST" action="<?= BASE_URL ?>/admin/pages/delete" style="display:inline;" 
                      onsubmit="return confirm('Delete this page?')">
                    <input type="hidden" name="id" value="<?= $page['id'] ?>">
                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
            </td>
        </tr>
        <?php endforeach; ?>
    </tbody>
</table>

<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>

================================================================================

# edit.php
# path: .\views\admin\rotations\edit.php

<?php 
// path: ./views/admin/rotations/edit.php
require BASE_PATH . '/views/admin/layout/header.php'; 
?>

<h1><?= $rotation ? 'Edit Content Rotation' : 'Create Content Rotation' ?></h1>

<form method="POST" action="<?= BASE_URL ?>/admin/rotations/save" class="admin-form">
    <?php if ($rotation): ?>
        <input type="hidden" name="id" value="<?= $rotation['id'] ?>">
    <?php endif; ?>

    <input type="hidden" name="page_id" value="<?= $page['id'] ?>">

    <div class="tabs">
        <button type="button" class="tab-btn active" onclick="switchTab('general')">General</button>
        <button type="button" class="tab-btn" onclick="switchTab('seo')">SEO & Meta</button>
        <button type="button" class="tab-btn" onclick="switchTab('advanced')">Advanced SEO</button>
    </div>

    <!-- GENERAL TAB -->
    <div id="tab-general" class="tab-content active">
        <div class="help-text">
            <strong>Template Variables:</strong> Use {{variable}} syntax. Available: {{page.title}}, {{global.phone}}, {{global.email}}, {{date.year}}, {{date.month}}
            <br><strong>Note:</strong> All fields support template variables!
        </div>

        <div class="form-group">
            <label>Page:</label>
            <input type="text" value="<?= e($page['title_ru']) ?> / <?= e($page['title_uz']) ?>" disabled>
        </div>

        <div class="form-group">
            <label>Active Month*</label>
            <select name="active_month" required>
                <option value="">Select Month</option>
                <?php foreach ($months as $num => $label): ?>
                    <option value="<?= $num ?>" 
                            <?= ($rotation['active_month'] ?? $suggestedMonth ?? '') == $num ? 'selected' : '' ?>>
                        <?= $label ?>
                    </option>
                <?php endforeach; ?>
            </select>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Title (RU)*</label>
                <input type="text" name="title_ru" 
                       value="<?= e($rotation['title_ru'] ?? '') ?>" 
                       placeholder="Page title override">
            </div>
            
            <div class="form-group">
                <label>Title (UZ)*</label>
                <input type="text" name="title_uz" 
                       value="<?= e($rotation['title_uz'] ?? '') ?>"
                       placeholder="Page title override">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Description/Intro (RU)</label>
                <textarea name="description_ru" rows="3" 
                          placeholder="Brief intro text"><?= e($rotation['description_ru'] ?? '') ?></textarea>
            </div>
            
            <div class="form-group">
                <label>Description/Intro (UZ)</label>
                <textarea name="description_uz" rows="3"
                          placeholder="Brief intro text"><?= e($rotation['description_uz'] ?? '') ?></textarea>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Content (RU)*</label>
                <textarea name="content_ru" class="tinymce" rows="6"><?= $rotation['content_ru'] ?? '' ?></textarea>
            </div>
            <div class="form-group">
                <label>Content (UZ)*</label>
                <textarea name="content_uz" class="tinymce" rows="6"><?= $rotation['content_uz'] ?? '' ?></textarea>
            </div>
        </div>

        <div class="form-group">
            <label>
                <input type="checkbox" name="is_active" <?= ($rotation['is_active'] ?? 1) ? 'checked' : '' ?>>
                Active
            </label>
        </div>
    </div>

    <!-- SEO TAB -->
    <div id="tab-seo" class="tab-content">
        <p class="help-text">
            Override page SEO for this rotation. Leave empty to use base page SEO. 
            Template variables work here too!
        </p>

        <div class="form-row">
            <div class="form-group">
                <label>Meta Title (RU)</label>
                <input type="text" name="meta_title_ru" 
                       value="<?= e($rotation['meta_title_ru'] ?? '') ?>"
                       placeholder="Leave empty to use page default">
            </div>
            
            <div class="form-group">
                <label>Meta Title (UZ)</label>
                <input type="text" name="meta_title_uz" 
                       value="<?= e($rotation['meta_title_uz'] ?? '') ?>"
                       placeholder="Leave empty to use page default">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Meta Keywords (RU)</label>
                <textarea name="meta_keywords_ru" rows="2"
                          placeholder="Leave empty to use page default"><?= e($rotation['meta_keywords_ru'] ?? '') ?></textarea>
            </div>
            
            <div class="form-group">
                <label>Meta Keywords (UZ)</label>
                <textarea name="meta_keywords_uz" rows="2"
                          placeholder="Leave empty to use page default"><?= e($rotation['meta_keywords_uz'] ?? '') ?></textarea>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Meta Description (RU)</label>
                <textarea name="meta_description_ru" rows="3"
                          placeholder="Leave empty to use page default"><?= e($rotation['meta_description_ru'] ?? '') ?></textarea>
            </div>
            
            <div class="form-group">
                <label>Meta Description (UZ)</label>
                <textarea name="meta_description_uz" rows="3"
                          placeholder="Leave empty to use page default"><?= e($rotation['meta_description_uz'] ?? '') ?></textarea>
            </div>
        </div>
    </div>

    <!-- ADVANCED SEO TAB -->
    <div id="tab-advanced" class="tab-content">
        <p class="help-text">Advanced SEO for social media and structured data.</p>

        <div class="form-row">
            <div class="form-group">
                <label>OG Title (RU) - For Facebook/Social</label>
                <input type="text" name="og_title_ru" 
                       value="<?= e($rotation['og_title_ru'] ?? '') ?>"
                       placeholder="Leave empty to use page default">
            </div>
            
            <div class="form-group">
                <label>OG Title (UZ)</label>
                <input type="text" name="og_title_uz" 
                       value="<?= e($rotation['og_title_uz'] ?? '') ?>"
                       placeholder="Leave empty to use page default">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>OG Description (RU)</label>
                <textarea name="og_description_ru" rows="2"
                          placeholder="Leave empty to use page default"><?= e($rotation['og_description_ru'] ?? '') ?></textarea>
            </div>
            
            <div class="form-group">
                <label>OG Description (UZ)</label>
                <textarea name="og_description_uz" rows="2"
                          placeholder="Leave empty to use page default"><?= e($rotation['og_description_uz'] ?? '') ?></textarea>
            </div>
        </div>

        <div class="form-group">
            <label>OG Image URL (Full URL)</label>
            <input type="text" name="og_image" 
                   value="<?= e($rotation['og_image'] ?? '') ?>"
                   placeholder="Leave empty to use page default">
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>JSON-LD Schema (RU)</label>
                <textarea name="jsonld_ru" rows="8" class="code"
                          placeholder="Leave empty to use page default"><?= e($rotation['jsonld_ru'] ?? '') ?></textarea>
            </div>
            
            <div class="form-group">
                <label>JSON-LD Schema (UZ)</label>
                <textarea name="jsonld_uz" rows="8" class="code"
                          placeholder="Leave empty to use page default"><?= e($rotation['jsonld_uz'] ?? '') ?></textarea>
            </div>
        </div>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">
            <?= $rotation ? 'Update Rotation' : 'Create Rotation' ?>
        </button>
        <a href="<?= BASE_URL ?>/admin/rotations/manage/<?= $page['id'] ?>" class="btn btn-secondary">Cancel</a>
        
        <?php if (!$rotation): ?>
        <button type="submit" name="default_from_page" value="1" class="btn" 
                style="background: #3b82f6; color: white;">
            Create with Page Defaults
        </button>
        <?php endif; ?>
    </div>
</form>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.7.0/tinymce.min.js"></script>
<script>
tinymce.init({
    selector: '.tinymce',
    height: 300,
    menubar: false,
    plugins: 'fullscreen code',
    toolbar: 'fullscreen code',
    content_css: '<?= BASE_URL ?>/css/pages.css'
});
</script>

<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>

================================================================================

# manage.php
# path: .\views\admin\rotations\manage.php

<?php 
// path: ./views/admin/rotations/manage.php
$pageName = 'rotations/manage';
require BASE_PATH . '/views/admin/layout/header.php'; 
?>

<div class="page-header">
    <h1>Content Rotations: <?= e($page['title_ru']) ?></h1>
    <div class="btn-group">
        <button onclick="showPreviewModal()" class="btn btn-primary">
            <i data-feather="eye"></i> Preview Page
        </button>
        <a href="<?= BASE_URL ?>/admin/rotations/overview" class="btn btn-secondary">
            <i data-feather="list"></i> Overview
        </a>
        <a href="<?= BASE_URL ?>/admin/pages/edit/<?= $page['id'] ?>" class="btn btn-secondary">
            <i data-feather="edit"></i> Edit Page
        </a>
    </div>
</div>
<div class="bulk-actions-bar" style="margin-bottom: 20px; justify-content: flex-end;">
    <div class="bulk-buttons">
        <button onclick="showUploadModal()" class="btn">
            <i data-feather="upload"></i> Bulk Upload
        </button>
        <a href="<?= BASE_URL ?>/admin/rotations/download-template" class="btn btn-secondary">
            <i data-feather="download"></i> Download CSV Template
        </a>
    </div>
</div>
<div class="rotation-stats-bar">
    <div class="stat-item">
        <span class="stat-label"><i data-feather="pie-chart"></i> Coverage:</span>
        <span class="stat-value"><?= $stats['covered_months'] ?>/12 months</span>
    </div>
    <div class="stat-item">
        <span class="stat-label"><i data-feather="clock"></i> Current Month:</span>
        <span class="stat-value current-month"><?= $months[date('n')] ?></span>
    </div>
    <div class="stat-item">
        <span class="stat-label"><i data-feather="check-circle"></i> Active:</span>
        <span class="stat-value"><?= count($stats['active_months']) ?></span>
    </div>
</div>

<?php if (!empty($stats['missing_months'])): ?>
<div class="alert alert-error">
    <strong>Missing months:</strong> 
    <?php 
    $missingNames = array_map(function($m) use ($months) {
        return $months[$m];
    }, $stats['missing_months']);
    echo implode(', ', $missingNames);
    ?>
    <a href="<?= BASE_URL ?>/admin/rotations/new/<?= $page['id'] ?>" class="btn btn-sm" style="margin-left: 15px;">
        <i data-feather="plus-square"></i> Add Content
    </a>
</div>
<?php endif; ?>

<form id="bulk-form" method="POST" action="<?= BASE_URL ?>/admin/rotations/bulk-action">
    <input type="hidden" name="page_id" value="<?= $page['id'] ?>">
    
    <div class="bulk-actions-bar">
        <div>
            <input type="checkbox" id="select-all" onchange="toggleAll(this)">
            <label for="select-all" style="margin-left: 8px;">Select All</label>
        </div>
        
        <div class="bulk-buttons">
            <button type="submit" name="action" value="activate" class="btn btn-sm" onclick="return confirmBulk('activate')">
                <i data-feather="check"></i> Activate Selected
            </button>
            <button type="submit" name="action" value="deactivate" class="btn btn-sm" onclick="return confirmBulk('deactivate')">
                <i data-feather="x"></i> Deactivate Selected
            </button>
            <button type="submit" name="action" value="delete" class="btn btn-sm btn-danger" onclick="return confirmBulk('delete')">
                <i data-feather="trash-2"></i> Delete Selected
            </button>
        </div>
    </div>


    <table class="data-table rotation-table">
        <thead>
            <tr>
                <th style="width: 40px;">
                    <input type="checkbox" disabled>
                </th>
                <th>Month</th>
                <th>Title (RU)</th>
                <th>Content Preview (RU)</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <?php 
            $hasContent = [];
            foreach ($rotations as $r) {
                $hasContent[$r['active_month']] = $r;
            }
            
            $currentMonth = date('n');
            
            foreach ($months as $num => $name): 
                $rotation = $hasContent[$num] ?? null;
                $isCurrent = ($num == $currentMonth);
            ?>
            <tr class="<?= $isCurrent ? 'current-month-row' : '' ?> <?= $rotation && !$rotation['is_active'] ? 'inactive-row' : '' ?>">
                <td>
                    <?php if ($rotation): ?>
                    <input type="checkbox" name="ids[]" value="<?= $rotation['id'] ?>" class="row-checkbox">
                    <?php endif; ?>
                </td>
                
                <td>
                    <strong><?= $name ?></strong>
                    <?php if ($isCurrent): ?>
                    <span class="badge" style="background: #3b82f6; margin-left: 8px;">
                        <i data-feather="clock"></i> ACTIVE NOW
                    </span>
                    <?php endif; ?>
                </td>
                
                <td>
                    <?php if ($rotation && $rotation['title_ru']): ?>
                        <strong><?= e(substr($rotation['title_ru'], 0, 50)) ?><?php if (strlen($rotation['title_ru']) > 50): ?>...<?php endif; ?></strong>
                        <?php if ($rotation['description_ru']): ?>
                            <br><small style="color: #6b7280;"><?= e(substr($rotation['description_ru'], 0, 60)) ?></small>
                        <?php endif; ?>
                    <?php else: ?>
                        <em class="no-content">No title</em>
                    <?php endif; ?>
                </td>
                
                <td>
                    <?php if ($rotation): ?>
                        <div class="content-preview">
                            <?= e(substr(strip_tags($rotation['content_ru']), 0, 100)) ?>
                            <?php if (strlen(strip_tags($rotation['content_ru'])) > 100): ?>...<?php endif; ?>
                        </div>
                    <?php else: ?>
                        <em class="no-content">No content</em>
                    <?php endif; ?>
                </td>
                
                <td>
                    <?php if ($rotation): ?>
                        <span class="badge <?= $rotation['is_active'] ? 'badge-success' : 'badge-danger' ?>">
                            <?= $rotation['is_active'] ? '<i data-feather="check-circle"></i> Active' : '<i data-feather="x-circle"></i> Inactive' ?>
                        </span>
                    <?php else: ?>
                        <span class="badge" style="background: #e5e7eb; color: #6b7280;">
                            <i data-feather="minus-circle"></i> Empty
                        </span>
                    <?php endif; ?>
                </td>
                
                <td>
                    <div class="action-buttons">
                        <?php if ($rotation): ?>
                            <a href="<?= BASE_URL ?>/admin/rotations/edit/<?= $rotation['id'] ?>" 
                               class="btn btn-sm" title="Edit">
                                <i data-feather="edit"></i> Edit
                            </a>
                            
                            <button type="button" onclick="showCloneModal(<?= $rotation['id'] ?>, '<?= e($name) ?>')" 
                                    class="btn btn-sm" title="Clone to other months">
                                <i data-feather="copy"></i> Clone
                            </button>
                            
                            <form method="POST" action="<?= BASE_URL ?>/admin/rotations/delete" 
                                  style="display:inline;" onsubmit="return confirm('Delete this rotation?')">
                                <input type="hidden" name="id" value="<?= $rotation['id'] ?>">
                                <input type="hidden" name="page_id" value="<?= $page['id'] ?>">
                                <button type="submit" class="btn btn-sm btn-danger" title="Delete">
                                    <i data-feather="trash-2"></i>
                                </button>
                            </form>
                        <?php else: ?>
                            <a href="<?= BASE_URL ?>/admin/rotations/new/<?= $page['id'] ?>?month=<?= $num ?>" 
                               class="btn btn-sm btn-primary">
                                <i data-feather="plus-square"></i> Add Content
                            </a>
                        <?php endif; ?>
                    </div>
                </td>
            </tr>
            <?php endforeach; ?>
        </tbody>
    </table>
</form>

<!-- Clone Modal -->
<div id="clone-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Clone Content to Other Months</h2>
            <button onclick="closeCloneModal()" class="close-btn"><i data-feather="x"></i></button>
        </div>
        
        <form method="POST" action="<?= BASE_URL ?>/admin/rotations/clone">
            <input type="hidden" name="source_id" id="clone-source-id">
            
            <p>Clone content from <strong id="clone-source-name"></strong> to:</p>
            
            <div class="form-group">
                <label>Target Month:</label>
                <select name="target_month" required>
                    <option value="">Select month...</option>
                    <?php foreach ($months as $num => $name): ?>
                    <option value="<?= $num ?>"><?= $name ?></option>
                    <?php endforeach; ?>
                </select>
            </div>
            
            <div class="modal-actions">
                <button type="submit" class="btn btn-primary"><i data-feather="copy"></i> Clone Content</button>
                <button type="button" onclick="closeCloneModal()" class="btn btn-secondary"><i data-feather="x-circle"></i> Cancel</button>
            </div>

        </form>
    </div>
</div>


<div id="upload-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i data-feather="upload"></i> Bulk Upload Rotations</h2>
            <button onclick="closeUploadModal()" class="close-btn"><i data-feather="x"></i></button>
        </div>
        
        <form method="POST" action="<?= BASE_URL ?>/admin/rotations/bulk-upload" enctype="multipart/form-data">
            <input type="hidden" name="page_id" value="<?= $page['id'] ?>">
            
            <div class="help-text" style="margin-bottom: 20px;">
                <strong>Supported formats:</strong> CSV, JSON<br>
                <strong>Required fields:</strong> page_id, active_month, content_ru, content_uz<br>
                <strong>Optional fields:</strong> is_active, meta_title_ru, meta_title_uz, meta_description_ru, meta_description_uz, etc.
            </div>
            
            <div class="form-group">
                <label>Select File (CSV or JSON):</label>
                <input type="file" name="file" accept=".csv,.json" required>
            </div>
            
            <details style="margin: 20px 0;">
                <summary style="cursor: pointer; font-weight: 600; margin-bottom: 10px;">
                    JSON Format Example
                </summary>
                <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 12px;">[
  {
    "page_id": 1,
    "active_month": 1,
    "content_ru": "Январский контент",
    "content_uz": "Yanvar matni",
    "is_active": 1,
    "meta_title_ru": "Заголовок"
  }
]</pre>
            </details>
            
            <div class="modal-actions">
                <button type="submit" class="btn btn-primary">
                    <i data-feather="upload"></i> Upload
                </button>
                <button type="button" onclick="closeUploadModal()" class="btn btn-secondary">
                    <i data-feather="x-circle"></i> Cancel
                </button>
            </div>
        </form>
    </div>
</div>

<div id="preview-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
            <h2><i data-feather="eye"></i> Preview Page with Rotation</h2>
            <button onclick="closePreviewModal()" class="close-btn"><i data-feather="x"></i></button>
        </div>
        
        <div style="padding: 20px;">
            <div class="form-row" style="margin-bottom: 20px;">
                <div class="form-group">
                    <label><strong>Select Month:</strong></label>
                    <select id="preview-month" class="btn" style="width: 100%;">
                        <?php foreach ($months as $num => $name): ?>
                        <option value="<?= $num ?>" <?= $num == date('n') ? 'selected' : '' ?>>
                            <?= $name ?> <?= $num == date('n') ? '(Current)' : '' ?>
                        </option>
                        <?php endforeach; ?>
                    </select>
                </div>
                
                <div class="form-group">
                    <label><strong>Language:</strong></label>
                    <select id="preview-lang" class="btn" style="width: 100%;">
                        <option value="ru">Русский</option>
                        <option value="uz">O'zbekcha</option>
                    </select>
                </div>
            </div>
            
            <div class="modal-actions">
                <button onclick="openPreview()" class="btn btn-primary" style="width: 100%;">
                    <i data-feather="external-link"></i> Open Preview in New Tab
                </button>
            </div>
        </div>
    </div>
</div>

<script>
function showPreviewModal() {
    document.getElementById('preview-modal').style.display = 'flex';
    feather.replace();
}

function closePreviewModal() {
    document.getElementById('preview-modal').style.display = 'none';
}

function openPreview() {
    const month = document.getElementById('preview-month').value;
    const lang = document.getElementById('preview-lang').value;
    const url = '<?= BASE_URL ?>/admin/preview/<?= $page['id'] ?>?month=' + month + '&lang=' + lang;
    window.open(url, '_blank', 'width=1200,height=800');
    closePreviewModal();
}

// Close modal on outside click
document.getElementById('preview-modal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closePreviewModal();
    }
});
function toggleAll(checkbox) {
    document.querySelectorAll('.row-checkbox').forEach(cb => {
        cb.checked = checkbox.checked;
    });
}

function showUploadModal() {
    document.getElementById('upload-modal').style.display = 'flex';
    feather.replace();
}

function closeUploadModal() {
    document.getElementById('upload-modal').style.display = 'none';
}

function confirmBulk(action) {
    const checked = document.querySelectorAll('.row-checkbox:checked').length;
    if (checked === 0) {
        alert('Please select at least one item');
        return false;
    }
    
    const messages = {
        'activate': `Activate ${checked} rotation(s)?`,
        'deactivate': `Deactivate ${checked} rotation(s)?`,
        'delete': `Delete ${checked} rotation(s)? This cannot be undone!`
    };
    
    return confirm(messages[action] || 'Continue?');
}

function showCloneModal(sourceId, sourceName) {
    document.getElementById('clone-source-id').value = sourceId;
    document.getElementById('clone-source-name').textContent = sourceName;
    document.getElementById('clone-modal').style.display = 'flex';
}

function closeCloneModal() {
    document.getElementById('clone-modal').style.display = 'none';
}
</script>

<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>


================================================================================

# overview.php
# path: .\views\admin\rotations\overview.php

<?php 
// path: ./views/admin/rotations/overview.php
$pageName = 'rotations/overview';
require BASE_PATH . '/views/admin/layout/header.php'; 
?>

<div class="page-header">
    <h1>Content Rotation Overview</h1>
    <a href="<?= BASE_URL ?>/admin/pages" class="btn btn-secondary">Back to Pages</a>
</div>

<?php if (!empty($incompletePages)): ?>
<div class="alert alert-error">
    <strong><i data-feather="alert-triangle"></i> Attention:</strong> <?= count($incompletePages) ?> page(s) with rotation enabled have incomplete month coverage.
</div>
<?php endif; ?>

<div class="rotation-summary">
    <h2>Pages with Content Rotation</h2>
    
    <?php if (empty($rotationStatus)): ?>
        <p>No pages have content rotation enabled.</p>
    <?php else: ?>
        
        <?php foreach ($rotationStatus as $item): 
            $page = $item['page'];
            $stats = $item['stats'];
            $completionPercent = round(($stats['covered_months'] / 12) * 100);
            $statusClass = $completionPercent == 100 ? 'status-complete' : 'status-incomplete';
        ?>
        
        <div class="rotation-card <?= $statusClass ?>">
            <div class="rotation-header">
                <div>
                    <h3>
                        <a href="<?= BASE_URL ?>/admin/rotations/manage/<?= $page['id'] ?>">
                            <?= e($page['title_ru']) ?>
                        </a>
                    </h3>
                    <p class="slug"><?= e($page['slug']) ?></p>
                </div>
                <div class="rotation-stats">
                    <div class="stat-badge">
                        <span class="stat-number"><?= $stats['covered_months'] ?>/12</span>
                        <span class="stat-label">Months</span>
                    </div>
                </div>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" style="width: <?= $completionPercent ?>%"></div>
            </div>
            
            <div class="rotation-details">
                <div class="detail-row">
                    <span class="label">Active:</span>
                    <span class="value"><?= count($stats['active_months']) ?> months</span>
                </div>
                
                <?php if (!empty($stats['missing_months'])): ?>
                <div class="detail-row">
                    <span class="label">Missing:</span>
                    <span class="value missing">
                        <?php 
                        $missingNames = array_map(function($m) {
                            return date('M', mktime(0, 0, 0, $m, 1));
                        }, $stats['missing_months']);
                        echo implode(', ', $missingNames);
                        ?>
                    </span>
                </div>
                <?php endif; ?>
                
                <?php if (!empty($stats['inactive_months'])): ?>
                <div class="detail-row">
                    <span class="label">Inactive:</span>
                    <span class="value inactive"><?= count($stats['inactive_months']) ?> months</span>
                </div>
                <?php endif; ?>
            </div>
            
            <div class="rotation-actions">
                <a href="<?= BASE_URL ?>/admin/rotations/manage/<?= $page['id'] ?>" class="btn btn-sm btn-primary">
                    Manage Rotations
                </a>
                <?php if ($completionPercent < 100): ?>
                <a href="<?= BASE_URL ?>/admin/rotations/new/<?= $page['id'] ?>" class="btn btn-sm">
                    Add Missing Months
                </a>
                <?php endif; ?>
            </div>
        </div>
        
        <?php endforeach; ?>
        
    <?php endif; ?>
</div>

<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>

================================================================================

# settings.php
# path: .\views\admin\seo\settings.php

<?php require BASE_PATH . '/views/admin/layout/header.php'; ?>

<h1>Global SEO Settings</h1>

<form method="POST" action="<?= BASE_URL ?>/admin/seo/save" class="admin-form">
    <div class="form-section">
        <h3>Site Information</h3>
        
        <div class="form-row">
            <div class="form-group">
                <label>Site Name (RU)*</label>
                <input type="text" name="site_name_ru" value="<?= $settings['site_name_ru'] ?? '' ?>" required>
            </div>
            
            <div class="form-group">
                <label>Site Name (UZ)*</label>
                <input type="text" name="site_name_uz" value="<?= $settings['site_name_uz'] ?? '' ?>" required>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>Phone</label>
                <input type="text" name="phone" value="<?= $settings['phone'] ?? '' ?>">
            </div>
            
            <div class="form-group">
                <label>Email</label>
                <input type="email" name="email" value="<?= $settings['email'] ?? '' ?>">
            </div>
        </div>
    </div>
    
    <div class="form-section">
        <h3>Default Meta Tags</h3>
        
        <div class="form-row">
            <div class="form-group">
                <label>Meta Keywords (RU)</label>
                <textarea name="meta_keywords_ru" rows="3"><?= $settings['meta_keywords_ru'] ?? '' ?></textarea>
            </div>
            
            <div class="form-group">
                <label>Meta Keywords (UZ)</label>
                <textarea name="meta_keywords_uz" rows="3"><?= $settings['meta_keywords_uz'] ?? '' ?></textarea>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>Meta Description (RU)</label>
                <textarea name="meta_description_ru" rows="3"><?= $settings['meta_description_ru'] ?? '' ?></textarea>
            </div>
            
            <div class="form-group">
                <label>Meta Description (UZ)</label>
                <textarea name="meta_description_uz" rows="3"><?= $settings['meta_description_uz'] ?? '' ?></textarea>
            </div>
        </div>
    </div>
    
    <div class="form-section">
        <h3>Contact Information</h3>
        
        <div class="form-row">
            <div class="form-group">
                <label>Address (RU)</label>
                <textarea name="address_ru" rows="2"><?= $settings['address_ru'] ?? '' ?></textarea>
            </div>
            
            <div class="form-group">
                <label>Address (UZ)</label>
                <textarea name="address_uz" rows="2"><?= $settings['address_uz'] ?? '' ?></textarea>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>Working Hours (RU)</label>
                <input type="text" name="working_hours_ru" value="<?= $settings['working_hours_ru'] ?? '' ?>">
            </div>
            
            <div class="form-group">
                <label>Working Hours (UZ)</label>
                <input type="text" name="working_hours_uz" value="<?= $settings['working_hours_uz'] ?? '' ?>">
            </div>
        </div>
    </div>
    
    <div class="form-actions">
        <button type="submit" class="btn btn-primary">Save Settings</button>
    </div>
</form>

<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>

================================================================================

# sitemap.php
# path: .\views\admin\seo\sitemap.php

<?php 
// path: ./views/admin/seo/sitemap.php
// IMPLEMENTATION: Place in views/admin/seo/sitemap.php

require BASE_PATH . '/views/admin/layout/header.php'; 
?>

<div class="page-header">
    <h1><i data-feather="map"></i> Sitemap & Robots.txt</h1>
    <div class="btn-group">
        <a href="<?= $sitemapUrl ?>" target="_blank" class="btn">
            <i data-feather="eye"></i> View Sitemap
        </a>
        <a href="<?= $robotsUrl ?>" target="_blank" class="btn">
            <i data-feather="file-text"></i> View Robots.txt
        </a>
        <?php if ($isProduction): ?>
        <form method="POST" action="<?= BASE_URL ?>/admin/seo/sitemap/ping" style="display: inline;">
            <button type="submit" class="btn btn-primary" 
                    onclick="return confirm('Ping Google and Bing about sitemap updates?')">
                <i data-feather="zap"></i> Ping Search Engines
            </button>
        </form>
        <?php endif; ?>
    </div>
</div>

<!-- Overview Stats -->
<div class="stats-grid">
    <div class="stat-card">
        <h3>Published Pages</h3>
        <p class="stat-number"><?= $totalPages ?></p>
    </div>
    
    <div class="stat-card">
        <h3>Total URLs</h3>
        <p class="stat-number"><?= $totalUrls ?></p>
        <p style="font-size: 0.85em; color: #6b7280; margin-top: 5px;">
            (<?= $totalPages ?> pages × 2 languages)
        </p>
    </div>
    
    <div class="stat-card">
        <h3>Environment</h3>
        <p class="stat-number" style="font-size: 1.5em;">
            <?= $isProduction ? '🌐 Production' : '🔧 Development' ?>
        </p>
    </div>
</div>

<!-- Sitemap Info -->
<div class="form-section">
    <h3><i data-feather="map"></i> Sitemap.xml</h3>
    
    <div class="help-text" style="margin-bottom: 15px;">
        <strong>URL:</strong> <a href="<?= $sitemapUrl ?>" target="_blank"><?= $sitemapUrl ?></a>
    </div>
    
    <p style="margin-bottom: 15px; line-height: 1.6;">
        The sitemap is automatically generated from your published pages and includes:
    </p>
    
    <ul style="margin-bottom: 15px; padding-left: 25px; line-height: 1.8;">
        <li>✓ All published pages in both Russian and Uzbek</li>
        <li>✓ Alternate language links (hreflang tags)</li>
        <li>✓ Last modification dates</li>
        <li>✓ Priority and change frequency hints</li>
        <li>✓ Pages with rotation = monthly update frequency</li>
        <li>✓ Pages without rotation = yearly update frequency</li>
    </ul>
    
    <div style="background: #f9fafb; padding: 15px; border-radius: 6px; border-left: 3px solid #3b82f6;">
        <strong>📋 Submit to Search Engines:</strong>
        <ul style="margin-top: 10px; padding-left: 20px;">
            <li><a href="https://search.google.com/search-console" target="_blank">Google Search Console</a></li>
            <li><a href="https://www.bing.com/webmasters" target="_blank">Bing Webmaster Tools</a></li>
            <li><a href="https://webmaster.yandex.com" target="_blank">Yandex Webmaster</a></li>
        </ul>
    </div>
</div>

<!-- Robots.txt Info -->
<div class="form-section">
    <h3><i data-feather="file-text"></i> Robots.txt</h3>
    
    <div class="help-text" style="margin-bottom: 15px;">
        <strong>URL:</strong> <a href="<?= $robotsUrl ?>" target="_blank"><?= $robotsUrl ?></a>
    </div>
    
    <?php if ($isProduction): ?>
        <div style="background: #d1f4e0; padding: 15px; border-radius: 6px; border-left: 3px solid #059669; margin-bottom: 15px;">
            <strong>✅ Production Mode:</strong> All pages are crawlable
        </div>
        
        <p style="margin-bottom: 10px;"><strong>Current Configuration:</strong></p>
        <pre style="background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 6px; overflow-x: auto; font-family: monospace; font-size: 13px;">User-agent: *
Allow: /

Disallow: /admin/
Disallow: /config/
Disallow: /logs/
Disallow: /database/

Sitemap: <?= $sitemapUrl ?></pre>
    <?php else: ?>
        <div style="background: #fef3c7; padding: 15px; border-radius: 6px; border-left: 3px solid #f59e0b; margin-bottom: 15px;">
            <strong>⚠️ Development Mode:</strong> All crawlers are blocked
        </div>
        
        <p style="margin-bottom: 10px;"><strong>Current Configuration:</strong></p>
        <pre style="background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 6px; overflow-x: auto; font-family: monospace; font-size: 13px;">User-agent: *
Disallow: /</pre>
    <?php endif; ?>
</div>

<!-- Pages in Sitemap -->
<div class="form-section">
    <h3><i data-feather="list"></i> Pages in Sitemap</h3>
    
    <table class="data-table">
        <thead>
            <tr>
                <th>Page</th>
                <th>Slug</th>
                <th>Rotation</th>
                <th>Change Freq</th>
                <th>Priority</th>
                <th>URLs</th>
            </tr>
        </thead>
        <tbody>
            <?php foreach ($pages as $page): ?>
            <tr>
                <td><?= e($page['title_ru']) ?></td>
                <td><code><?= e($page['slug']) ?></code></td>
                <td>
                    <?php if ($page['enable_rotation']): ?>
                        <span class="badge badge-success">Enabled</span>
                    <?php else: ?>
                        <span class="badge">Disabled</span>
                    <?php endif; ?>
                </td>
                <td>
                    <code><?= $page['enable_rotation'] ? 'monthly' : 'yearly' ?></code>
                </td>
                <td>
                    <code><?= $page['slug'] === 'home' ? '1.0' : '0.8' ?></code>
                </td>
                <td style="font-size: 0.85em;">
                    <a href="<?= BASE_URL ?>/<?= e($page['slug']) ?>" target="_blank">
                        <i data-feather="external-link"></i> RU
                    </a>
                    <span style="margin: 0 5px;">•</span>
                    <a href="<?= BASE_URL ?>/<?= e($page['slug']) ?>/uz" target="_blank">
                        <i data-feather="external-link"></i> UZ
                    </a>
                </td>
            </tr>
            <?php endforeach; ?>
        </tbody>
    </table>
</div>

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.stat-card h3 {
    font-size: 0.9em;
    color: #6b7280;
    margin-bottom: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.stat-number {
    font-size: 2.5em;
    font-weight: bold;
    color: #303034;
    line-height: 1;
    margin: 0;
}

pre {
    white-space: pre-wrap;
    word-wrap: break-word;
}
</style>

<?php require BASE_PATH . '/views/admin/layout/footer.php'; ?>

================================================================================

# footer.php
# path: .\views\templates\footer.php

<footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3><?= e($seo["site_name_$lang"]) ?></h3>
                    <p><?= $lang === 'ru' ? 'Покупаем бытовую технику, новую и б/у. Быстрая оценка, честная цена, моментальная оплата.' : 'Maishiy texnikani, yangi va ishlatilganni sotib olamiz. Tez baholash, adolatli narx, oniy to\'lov.' ?></p>
                </div>
                
                <div class="footer-section">
                    <h3><?= $lang === 'ru' ? 'Контакты' : 'Aloqa' ?></h3>
                    <?php if ($seo['phone']): ?>
                    <div class="contact-item">
                        <svg fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                        </svg>
                        <a href="tel:<?= preg_replace('/[^0-9+]/', '', $seo['phone']) ?>"><?= e($seo['phone']) ?></a>
                    </div>
                    <?php endif; ?>
                    
                    <?php if ($seo['email']): ?>
                    <div class="contact-item">
                        <svg fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                        </svg>
                        <a href="mailto:<?= e($seo['email']) ?>"><?= e($seo['email']) ?></a>
                    </div>
                    <?php endif; ?>
                </div>
                
                <div class="footer-section">
                    <h3><?= $lang === 'ru' ? 'Информация' : 'Ma\'lumot' ?></h3>
                    <?php if ($seo["address_$lang"]): ?>
                    <div class="contact-item">
                        <svg fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                        </svg>
                        <span><?= e($seo["address_$lang"]) ?></span>
                    </div>
                    <?php endif; ?>
                    
                    <?php if ($seo["working_hours_$lang"]): ?>
                    <div class="contact-item">
                        <svg fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                        </svg>
                        <span><?= e($seo["working_hours_$lang"]) ?></span>
                    </div>
                    <?php endif; ?>
                </div>
            </div>
            
            <div class="copyright">
                <p>© <?= date('Y') ?> <?= e($seo["site_name_$lang"]) ?>. <?= $lang === 'ru' ? 'Все права защищены.' : 'Barcha huquqlar himoyalangan.' ?></p>
            </div>
        </div>
    </footer>

    <script>
        window.baseUrl = "<?= rtrim(BASE_URL, '/') ?>";
    </script>
    <script src="<?= BASE_URL ?>/js/link-tracking.js" defer></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script>feather.replace();</script>
</body>
</html>

================================================================================

# header.php
# path: .\views\templates\header.php

<?php
// path: ./views/templates/header.php
$lang = $lang ?? getCurrentLanguage();

// Meta tags
$metaTitle = $page["meta_title_$lang"] ?? $page["title_$lang"] ?? $seo["site_name_$lang"];
$metaKeywords = $page["meta_keywords_$lang"] ?? $seo["meta_keywords_$lang"] ?? '';
$metaDescription = $page["meta_description_$lang"] ?? $seo["meta_description_$lang"] ?? '';

// Open Graph tags
$ogTitle = $page["og_title_$lang"] ?? $metaTitle;
$ogDescription = $page["og_description_$lang"] ?? $metaDescription;
$ogImage = $page['og_image'] ?? (BASE_URL . '/css/logo.png');

// Canonical URL
$canonicalUrl = $page['canonical_url'] ?? (BASE_URL . '/' . e($page['slug']) . ($lang !== DEFAULT_LANGUAGE ? '/' . $lang : ''));

// Process placeholders in all meta content
$metaTitle = renderTemplate($metaTitle, $templateData);
$metaKeywords = renderTemplate($metaKeywords, $templateData);
$metaDescription = renderTemplate($metaDescription, $templateData);
$ogTitle = renderTemplate($ogTitle, $templateData);
$ogDescription = renderTemplate($ogDescription, $templateData);

// Process JSON-LD
$jsonld = $page["jsonld_$lang"] ?? '';
if ($jsonld) {
    $jsonld = renderTemplate($jsonld, $templateData);
}

// Generate FAQ Schema if FAQs exist
$faqSchema = '';
if (!empty($faqs)) {
    $faqSchema = generateFAQSchema($faqs, $lang);
}

// Check if user is logged in as admin
$isAdmin = isset($_SESSION['user_id']);
?>
<!DOCTYPE html>
<html lang="<?= $lang ?>">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?= e($metaTitle) ?></title>
    
    <!-- Basic Meta Tags -->
    <?php if ($metaKeywords): ?>
    <meta name="keywords" content="<?= e($metaKeywords) ?>">
    <?php endif; ?>
    
    <?php if ($metaDescription): ?>
    <meta name="description" content="<?= e($metaDescription) ?>">
    <?php endif; ?>
    
    <meta name="robots" content="index, follow">
    <meta name="author" content="<?= e($seo["site_name_$lang"]) ?>">
    
    <!-- Canonical & Alternate URLs -->
    <link rel="canonical" href="<?= $canonicalUrl ?>">
    <link rel="alternate" hreflang="ru" href="<?= BASE_URL ?>/<?= e($page['slug']) ?>">
    <link rel="alternate" hreflang="uz" href="<?= BASE_URL ?>/<?= e($page['slug']) ?>/uz">
    <link rel="alternate" hreflang="x-default" href="<?= BASE_URL ?>/<?= e($page['slug']) ?>">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="<?= $canonicalUrl ?>">
    <meta property="og:title" content="<?= e($ogTitle) ?>">
    <meta property="og:description" content="<?= e($ogDescription) ?>">
    <meta property="og:image" content="<?= e($ogImage) ?>">
    <meta property="og:locale" content="<?= $lang === 'ru' ? 'ru_RU' : 'uz_UZ' ?>">
    <meta property="og:site_name" content="<?= e($seo["site_name_$lang"]) ?>">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="<?= $canonicalUrl ?>">
    <meta name="twitter:title" content="<?= e($ogTitle) ?>">
    <meta name="twitter:description" content="<?= e($ogDescription) ?>">
    <meta name="twitter:image" content="<?= e($ogImage) ?>">
    
    <link rel="icon" type="image/x-icon" href="<?= BASE_URL ?>/css/favicon.ico">
    
    <link rel="stylesheet" href="<?= BASE_URL ?>/css/pages.css">
    
    <?php if ($jsonld): ?>
        <script type="application/ld+json">
            <?= $jsonld ?>
        </script>
    <?php endif; ?>
    
    <?php if ($faqSchema): ?>
        <script type="application/ld+json">
            <?= $faqSchema ?>
        </script>
    <?php endif; ?>
    
    <?php if ($seo['phone'] || $seo['email']): ?>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "LocalBusiness",
        "name": "<?= e($seo["site_name_$lang"]) ?>",
        <?php if ($seo['phone']): ?>"telephone": "<?= e($seo['phone']) ?>",<?php endif; ?>
        <?php if ($seo['email']): ?>"email": "<?= e($seo['email']) ?>",<?php endif; ?>
        <?php if ($seo["address_$lang"]): ?>"address": {
            "@type": "PostalAddress",
            "streetAddress": "<?= e($seo["address_$lang"]) ?>",
            "addressLocality": "Tashkent",
            "addressCountry": "UZ"
        },<?php endif; ?>
        "url": "<?= BASE_URL ?>",
        "priceRange": "$$"
    }
    </script>
    <?php endif; ?>
    
    <?php if ($isAdmin): ?>
    <!-- Admin Toolbar Styles -->
    <style>
    .admin-toolbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        color: white;
        padding: 8px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 9999;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        font-size: 13px;
        flex-wrap: wrap;
        gap: 10px;
    }
    .admin-toolbar-left,
    .admin-toolbar-right {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
    }
    .admin-toolbar a,
    .admin-toolbar button {
        color: white;
        text-decoration: none;
        padding: 6px 12px;
        background: rgba(255,255,255,0.15);
        border-radius: 4px;
        border: 1px solid rgba(255,255,255,0.2);
        font-size: 13px;
        font-weight: 500;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        white-space: nowrap;
    }
    .admin-toolbar a:hover,
    .admin-toolbar button:hover {
        background: rgba(255,255,255,0.25);
        transform: translateY(-1px);
    }
    .admin-toolbar-badge {
        background: rgba(255,255,255,0.3);
        padding: 4px 8px;
        border-radius: 3px;
        font-weight: 600;
        font-size: 12px;
    }
    body.admin-mode {
        padding-top: 50px;
    }
    @media (max-width: 768px) {
        .admin-toolbar {
            padding: 6px 10px;
            font-size: 12px;
        }
        .admin-toolbar a,
        .admin-toolbar button {
            padding: 5px 10px;
            font-size: 12px;
        }
        body.admin-mode {
            padding-top: 55px;
        }
    }
    </style>
    <?php endif; ?>
</head>
<body<?= $isAdmin ? ' class="admin-mode"' : '' ?>>
    
    <?php if ($isAdmin): ?>
    <!-- Admin Toolbar -->
    <div class="admin-toolbar">
        <div class="admin-toolbar-left">
            <span class="admin-toolbar-badge">
                <svg width="14" height="14" fill="currentColor" viewBox="0 0 20 20" style="vertical-align: middle;">
                    <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                ADMIN
            </span>
            <span style="opacity: 0.9; font-size: 12px;">
                <?= htmlspecialchars($_SESSION['username'] ?? 'Admin') ?>
            </span>
        </div>
        
        <div class="admin-toolbar-right">
            <a href="<?= BASE_URL ?>/admin/pages/edit/<?= $page['id'] ?>">
                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="vertical-align: middle;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
                Edit
            </a>
            
            <?php if ($page['enable_rotation']): ?>
            <a href="<?= BASE_URL ?>/admin/rotations/manage/<?= $page['id'] ?>">
                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="vertical-align: middle;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
                Rotate
            </a>
            <?php endif; ?>
            
            <a href="<?= BASE_URL ?>/admin/analytics/page/<?= e($page['slug']) ?>">
                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="vertical-align: middle;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
                Stats
            </a>
            
            <a href="<?= BASE_URL ?>/admin/dashboard">
                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="vertical-align: middle;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                </svg>
                Dashboard
            </a>
            
            <button onclick="if(confirm('Logout?')) window.location='<?= BASE_URL ?>/admin/logout'" style="background: rgba(255,255,255,0.2);">
                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="vertical-align: middle;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                </svg>
                Logout
            </button>
        </div>
    </div>
    <?php endif; ?>
    
    <header>
        <div class="container">
            <nav>
                <a href="<?= BASE_URL ?>" class="logo-link">
                    <img src="<?= BASE_URL ?>/css/logo.png" class="logo" alt="<?= e($seo["site_name_$lang"]) ?>">
                    <span class="site-name"><?= e($seo["site_name_$lang"]) ?></span>
                </a>
                
                <div class="nav-links">
                    <?php
                    $pageModel = new Page();
                    $allPages = $pageModel->getAll();
                    foreach ($allPages as $navPage):
                        if ($navPage['slug'] === 'about' || $navPage['slug'] === 'o-nas'):
                    ?>
                    <a href="<?= BASE_URL ?>/<?= e($navPage['slug']) ?><?= $lang !== DEFAULT_LANGUAGE ? '/' . $lang : '' ?>">
                        <?= e($navPage["title_$lang"]) ?>
                    </a>
                    <?php 
                        endif;
                    endforeach; 
                    ?>
                    
                    <div class="lang-switch">
                        <a href="<?= BASE_URL ?>/<?= e($page['slug']) ?>" <?= $lang === 'ru' ? 'class="active"' : '' ?>>RU</a>
                        <a href="<?= BASE_URL ?>/<?= e($page['slug']) ?>/uz" <?= $lang === 'uz' ? 'class="active"' : '' ?>>UZ</a>
                    </div>
                </div>
            </nav>
        </div>
    </header>
    
    <?php if ($seo['phone']): ?>
    <!-- Floating Call Button -->
    <a href="tel:<?= preg_replace('/[^0-9+]/', '', $seo['phone']) ?>" 
       class="floating-call" 
       title="<?= $lang === 'ru' ? 'Позвонить' : 'Qo\'ng\'iroq qilish' ?>" 
       aria-label="<?= $lang === 'ru' ? 'Позвонить' : 'Qo\'ng\'iroq qilish' ?>"
       onclick="trackClick('<?= e($page['slug']) ?>', '<?= $lang ?>')">
        <svg fill="currentColor" viewBox="0 0 20 20">
            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
        </svg>
    </a>
    <?php endif; ?>
    
    <script>
    function trackClick(slug, lang) {
        fetch('<?= BASE_URL ?>/track-click', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: 'slug=' + slug + '&lang=' + lang
        });
    }
    </script>

================================================================================

# page.php
# path: .\views\templates\page.php

<?php 
// path: ./views/templates/page.php
require 'header.php'; 
?>

<main>
    <div class="container">
        <?php
        $content = $page["content_$lang"];
        $content = renderTemplate($content, $templateData);
        echo $content;
        ?>
        
        <?php if (!empty($faqs)): ?>
        <section class="faq-section">
            <h2><?= $lang === 'ru' ? 'Часто задаваемые вопросы' : 'Ko\'p beriladigan savollar' ?></h2>
            
            <div class="faq-list">
                <?php foreach ($faqs as $faq): ?>
                <div class="faq-item">
                    <h3><?= e($faq["question_$lang"]) ?></h3>
                    <p><?= nl2br(e($faq["answer_$lang"])) ?></p>
                </div>
                <?php endforeach; ?>
            </div>
        </section>
        <?php endif; ?>
    </div>
</main>

<?php require 'footer.php'; ?>

================================================================================

# preview.php
# path: .\views\templates\preview.php

<?php 
// path: ./views/templates/preview.php

$lang = $lang ?? getCurrentLanguage();
$seo = $seo ?? [];
?>
<!DOCTYPE html>
<html lang="<?= $lang ?>">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PREVIEW: <?= e($page["title_$lang"]) ?></title>
    <link rel="stylesheet" href="<?= BASE_URL ?>/css/pages.css">
    <style>
        .preview-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            font-size: 14px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .preview-banner-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .preview-badge {
            background: rgba(255,255,255,0.3);
            padding: 4px 10px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 12px;
            letter-spacing: 0.5px;
        }
        .preview-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .preview-controls {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        /* Styled Select Dropdowns */
        .preview-controls select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding: 8px 32px 8px 12px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='white' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            min-width: 140px;
        }
        
        .preview-controls select:hover {
            background-color: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }
        
        .preview-controls select:focus {
            outline: none;
            background-color: rgba(255,255,255,0.35);
            box-shadow: 0 0 0 3px rgba(255,255,255,0.2);
        }
        
        .preview-controls select option {
            background: #303034;
            color: white;
            padding: 8px;
        }
        
        .preview-controls a,
        .preview-controls button {
            padding: 8px 14px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }
        
        .preview-controls a:hover,
        .preview-controls button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }
        
        .preview-controls button.close-btn {
            background: rgba(220, 38, 38, 0.3);
            border-color: rgba(220, 38, 38, 0.5);
        }
        
        .preview-controls button.close-btn:hover {
            background: rgba(220, 38, 38, 0.5);
        }
        
        body.preview-mode {
            padding-top: 120px;
        }
        body.preview-mode header {
            top: 60px;
        }
        
        @media (max-width: 768px) {
            .preview-banner {
                font-size: 12px;
                padding: 10px 15px;
            }
            .preview-controls {
                width: 100%;
            }
            .preview-controls select,
            .preview-controls a,
            .preview-controls button {
                padding: 7px 12px;
                font-size: 12px;
                flex: 1;
                min-width: auto;
            }
            .preview-controls select {
                padding-right: 28px;
            }
            body.preview-mode {
                padding-top: 140px;
            }
        }
    </style>
</head>
<body class="preview-mode">
    
    <!-- Preview Banner -->
    <div class="preview-banner">
        <div class="preview-banner-left">
            <span class="preview-badge">⚠️ PREVIEW MODE</span>
            <div class="preview-info">
                <strong>Month:</strong> <?= date('F', mktime(0, 0, 0, $previewMonth, 1)) ?>
                <?php if ($hasRotation): ?>
                    <span style="background: rgba(255,255,255,0.3); padding: 3px 8px; border-radius: 3px; font-size: 11px; font-weight: 600;">
                        ✓ Rotation Active
                    </span>
                <?php else: ?>
                    <span style="background: rgba(0,0,0,0.3); padding: 3px 8px; border-radius: 3px; font-size: 11px;">
                        Base Content
                    </span>
                <?php endif; ?>
            </div>
        </div>
        
        <div class="preview-controls">
            <select id="month-selector" onchange="changeMonth()" aria-label="Select month">
                <?php
                $months = [
                    1 => 'January', 2 => 'February', 3 => 'March', 4 => 'April',
                    5 => 'May', 6 => 'June', 7 => 'July', 8 => 'August',
                    9 => 'September', 10 => 'October', 11 => 'November', 12 => 'December'
                ];
                foreach ($months as $num => $name):
                ?>
                <option value="<?= $num ?>" <?= $num == $previewMonth ? 'selected' : '' ?>>
                    <?= $name ?><?= $num == date('n') ? ' (Now)' : '' ?>
                </option>
                <?php endforeach; ?>
            </select>
            
            <select id="lang-selector" onchange="changeLang()" aria-label="Select language">
                <option value="ru" <?= $lang === 'ru' ? 'selected' : '' ?>>Русский</option>
                <option value="uz" <?= $lang === 'uz' ? 'selected' : '' ?>>O'zbekcha</option>
            </select>
            
            <a href="<?= BASE_URL ?>/admin/rotations/manage/<?= $page['id'] ?>" title="Edit rotations">
                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
                Edit
            </a>
            
            <button onclick="window.close()" class="close-btn" title="Close preview">
                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
                Close
            </button>
        </div>
    </div>
    
    <!-- Regular Page Header -->
    <header>
        <div class="container">
            <nav>
                <a href="<?= BASE_URL ?>" class="logo-link">
                    <img src="<?= BASE_URL ?>/css/logo.png" class="logo" alt="<?= e($seo["site_name_$lang"]) ?>">
                    <span class="site-name"><?= e($seo["site_name_$lang"]) ?></span>
                </a>
                
                <div class="nav-links">
                    <div class="lang-switch">
                        <a href="#" class="<?= $lang === 'ru' ? 'active' : '' ?>">RU</a>
                        <a href="#" class="<?= $lang === 'uz' ? 'active' : '' ?>">UZ</a>
                    </div>
                </div>
            </nav>
        </div>
    </header>
    
    <!-- Page Content -->
    <main>
        <div class="container">
            <?php
            echo $page["content_$lang"];
            ?>
            
            <?php if (!empty($faqs)): ?>
            <section class="faq-section">
                <h2><?= $lang === 'ru' ? 'Часто задаваемые вопросы' : 'Ko\'p beriladigan savollar' ?></h2>
                
                <div class="faq-list">
                    <?php foreach ($faqs as $faq): ?>
                    <div class="faq-item">
                        <h3><?= e($faq["question_$lang"]) ?></h3>
                        <p><?= nl2br(e($faq["answer_$lang"])) ?></p>
                    </div>
                    <?php endforeach; ?>
                </div>
            </section>
            <?php endif; ?>
        </div>
    </main>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3><?= e($seo["site_name_$lang"]) ?></h3>
                    <p><?= $lang === 'ru' ? 'Покупаем бытовую технику' : 'Maishiy texnikani sotib olamiz' ?></p>
                </div>
            </div>
            <div class="copyright">
                <p>© <?= date('Y') ?> <?= e($seo["site_name_$lang"]) ?></p>
            </div>
        </div>
    </footer>
    
    <script>
        const pageId = <?= $page['id'] ?>;
        
        function changeMonth() {
            const month = document.getElementById('month-selector').value;
            const lang = document.getElementById('lang-selector').value;
            window.location.href = `<?= BASE_URL ?>/admin/preview/${pageId}?month=${month}&lang=${lang}`;
        }
        
        function changeLang() {
            const month = document.getElementById('month-selector').value;
            const lang = document.getElementById('lang-selector').value;
            window.location.href = `<?= BASE_URL ?>/admin/preview/${pageId}?month=${month}&lang=${lang}`;
        }
    </script>
    
    <script src="https://unpkg.com/feather-icons"></script>
    <script>feather.replace();</script>
</body>
</html>

================================================================================

